<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parkexpert - Otopark Fizibilite Hesaplama</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #1e3c72;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --header-bg: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        [data-theme="dark"] {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eaeaea;
            --text-secondary: #a0a0a0;
            --border-color: #2d3748;
            --success-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ed8936;
            --header-bg: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--header-bg);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-container img {
            max-height: 80px;
            max-width: 200px;
            object-fit: contain;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px 24px;
            background: white;
            color: #1e3c72;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .logo-upload {
            display: none;
        }

        .upload-logo-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-logo-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .save-load-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-load-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .close-modal {
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            transition: transform 0.2s;
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .saved-calculation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .saved-calculation:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .saved-calculation h3 {
            margin: 0 0 10px 0;
            color: #1e3c72;
            font-size: 18px;
        }

        .saved-calculation-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
            color: #6c757d;
        }

        .saved-calculation-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-load, .btn-delete {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-load {
            background: #667eea;
            color: white;
        }

        .btn-load:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Scenario Comparison Styles */
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .scenario-tab {
            padding: 12px 30px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            color: #667eea;
        }

        .scenario-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .scenario-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .scenario-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-btn.save {
            background: #28a745;
            color: white;
        }

        .scenario-btn.compare {
            background: #667eea;
            color: white;
        }

        .scenario-btn.clear {
            background: #dc3545;
            color: white;
        }

        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .comparison-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .comparison-header h2 {
            color: #1e3c72;
            margin: 0 0 10px 0;
        }

        .winner-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table .metric-name {
            text-align: left;
            font-weight: 600;
            color: #1e3c72;
        }

        .comparison-table .better {
            background: #d4edda;
            font-weight: 700;
            color: #155724;
        }

        .comparison-table .worse {
            background: #f8d7da;
            color: #721c24;
        }

        .scenario-info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .scenario-info-box h3 {
            margin: 0 0 10px 0;
            color: #1e3c72;
        }

        .scenario-info-box p {
            margin: 5px 0;
            color: #6c757d;
        }

        /* Theme Switcher */
        .theme-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .theme-btn.active {
            background: white;
            color: #667eea;
        }

        .color-picker-container {
            position: relative;
        }

        .color-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .color-picker-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .color-picker-menu.active {
            display: block;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            margin: 5px;
            display: inline-block;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.2);
            border-color: #667eea;
        }

        .color-option.active {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        /* Smart Recommendations */
        .recommendations-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .recommendations-container {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .recommendations-header {
            text-align: center;
            color: white;
            margin-bottom: 25px;
        }

        .recommendations-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .recommendation-card.positive {
            border-left: 5px solid #28a745;
        }

        .recommendation-card.warning {
            border-left: 5px solid #ffc107;
        }

        .recommendation-card.critical {
            border-left: 5px solid #dc3545;
        }

        .recommendation-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .recommendation-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .recommendation-desc {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .recommendation-impact {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }

        .recommendation-impact.positive {
            color: #28a745;
        }

        .recommendation-impact.negative {
            color: #dc3545;
        }

        .ai-score {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .ai-score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .ai-score-value {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
        }

        .ai-score-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Share Buttons */
        .share-section {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .share-btn.whatsapp {
            background: #25D366;
            color: white;
        }

        .share-btn.email {
            background: #EA4335;
            color: white;
        }

        .share-btn.copy {
            background: #667eea;
            color: white;
        }

        .share-btn.telegram {
            background: #0088cc;
            color: white;
        }

        /* Template System */
        .template-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .template-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .template-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .template-title {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 12px;
            color: #6c757d;
        }

        /* Notes System */
        .notes-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }

        .notes-textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        /* Currency Selector */
        .currency-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            background: white;
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .currency-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
        }

        .currency-menu {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 998;
        }

        .currency-menu.active {
            display: block;
        }

        .currency-option-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin: 5px 0;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .currency-option-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .currency-option-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .animate-in {
            animation: slideInUp 0.5s ease-out;
        }

        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Gamification */
        .achievement-popup {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideInUp 0.5s ease-out;
            max-width: 300px;
        }

        .achievement-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 5px;
            text-align: center;
        }

        .achievement-desc {
            font-size: 14px;
            opacity: 0.9;
            text-align: center;
        }

        .achievements-badge {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .achievements-badge:hover {
            transform: scale(1.1) rotate(15deg);
        }

        .achievements-panel {
            display: none;
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 998;
            overflow-y: auto;
            padding: 20px;
        }

        .achievements-panel.active {
            display: block;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }

        .achievement-item.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        /* Chatbot */
        .chatbot-button {
            position: fixed;
            bottom: 160px;
            left: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .chatbot-window {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 998;
            flex-direction: column;
            overflow: hidden;
        }

        .chatbot-window.active {
            display: flex;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
            animation: slideInUp 0.3s ease-out;
        }

        .chat-message.bot {
            background: white;
            border: 2px solid #667eea;
            margin-right: auto;
        }

        .chat-message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .chat-quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .quick-reply-btn {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Screenshot & Tools */
        .tools-menu {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: white;
            border-radius: 10px 0 0 10px;
            box-shadow: -4px 0 20px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 997;
        }

        .tool-btn {
            display: block;
            width: 50px;
            height: 50px;
            margin: 10px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .tool-btn:hover {
            transform: scale(1.1);
            background: #764ba2;
        }

        /* Financing Modal */
        .financing-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            z-index: 10000;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .financing-modal.active {
            display: block;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
        }

        .modal-overlay.active {
            display: block;
        }

        /* Multi-User System */
        .user-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 60px;
            left: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            min-width: 250px;
            padding: 15px;
            z-index: 999;
        }

        .user-dropdown.active {
            display: block;
            animation: slideInUp 0.3s ease-out;
        }

        .user-info {
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 15px;
        }

        .user-name {
            font-weight: 700;
            color: #1e3c72;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-role {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .user-role.admin {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .user-role.manager {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .user-role.viewer {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            color: #1e3c72;
            margin: 5px 0;
        }

        .user-menu-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }

        .login-modal.hidden {
            display: none;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideInUp 0.5s ease-out;
        }

        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .login-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .guest-btn {
            width: 100%;
            padding: 12px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .guest-btn:hover {
            background: #f8f9fa;
        }

        /* Live Dashboard */
        .dashboard-container {
            display: none;
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .dashboard-container.active {
            display: block;
        }

        .dashboard-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .dashboard-header h2 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }

        .dashboard-kpis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .kpi-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 5px;
            animation: countUp 1s ease-out;
        }

        .kpi-label {
            font-size: 14px;
            color: #6c757d;
            font-weight: 600;
        }

        .kpi-trend {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .kpi-trend.up {
            background: #d4edda;
            color: #155724;
        }

        .kpi-trend.down {
            background: #f8d7da;
            color: #721c24;
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 1s ease-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* Chart Styles */
        .charts-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .chart-container h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .chart-wrapper canvas {
            max-height: 300px;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section h2 {
            color: #1e3c72;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input[readonly] {
            background-color: #e9ecef !important;
            cursor: not-allowed;
            color: #495057;
            font-weight: 600;
        }

        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
        }

        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 25px;
            top: -10px;
            background: #2d3748;
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            white-space: normal;
            width: 280px;
            font-size: 13px;
            font-weight: normal;
            line-height: 1.5;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .info-icon:hover::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 4px;
            border: 6px solid transparent;
            border-right-color: #2d3748;
            z-index: 1001;
        }

        .manager-report-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 15px;
            display: none;
        }

        .manager-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
        }

        .export-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            flex: 1;
            max-width: 300px;
        }

        .excel-btn {
            background: linear-gradient(135deg, #1d6f42 0%, #26a65b 100%);
        }

        .excel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(38, 166, 91, 0.3);
        }

        .pdf-btn {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }

        .pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .manager-report {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            color: white;
            margin-top: 30px;
            display: none;
        }

        .manager-report h2 {
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .manager-report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .manager-report-card {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            color: #1e3c72;
        }

        .manager-report-card h4 {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .manager-report-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #1e3c72;
        }

        .manager-summary {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            color: #1e3c72;
        }

        .manager-summary h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .manager-summary p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .highlight {
            font-weight: 700;
            color: #667eea;
        }

            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .staff-category h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .staff-total-display {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .staff-total-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .staff-total-label {
            font-weight: 600;
            color: #495057;
        }

        .staff-total-value {
            font-weight: 700;
            font-size: 18px;
            color: #1e3c72;
            text-align: right;
        }

        .staff-total-value.final {
            color: #28a745;
            font-size: 20px;
        }

        .time-slot {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .time-slot label {
            font-weight: 600;
            color: #495057;
        }

        .time-slot input {
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #667eea;
        }

        .results h2 {
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-card .value {
            font-size: 28px;
            font-weight: 700;
            color: #1e3c72;
        }

        .result-card.positive {
            border-left-color: #28a745;
        }

        .result-card.positive .value {
            color: #28a745;
        }

        .result-card.negative {
            border-left-color: #dc3545;
        }

        .result-card.negative .value {
            color: #dc3545;
        }

        .result-card.warning {
            border-left-color: #ffc107;
        }

        .result-card.warning .value {
            color: #ffc107;
        }

        .result-card-large {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border-left: 6px solid #667eea;
            grid-column: span 1;
        }

        .result-card-large h3 {
            font-size: 18px;
            color: #6c757d;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-card-large .value {
            font-size: 42px;
            font-weight: 800;
            color: #1e3c72;
        }

        .result-card-large.rent-card {
            border-left-color: #dc3545;
        }

        .result-card-large.rent-card .value {
            color: #dc3545;
        }

        .result-card-large.profit-card.positive {
            border-left-color: #28a745;
        }

        .result-card-large.profit-card.positive .value {
            color: #28a745;
        }

        .result-card-large.profit-card.negative {
            border-left-color: #dc3545;
        }

        .result-card-large.profit-card.negative .value {
            color: #dc3545;
        }

        .result-card-large .small-text {
            font-size: 14px;
            color: #6c757d;
            margin-top: 10px;
            font-weight: 500;
        }

        .comparison-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 3px solid #667eea;
        }

        .period-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .period-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .small-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 12px;
            }

            .theme-controls {
                position: static;
                margin-top: 15px;
                justify-content: center;
            }

            .scenario-tabs {
                flex-direction: column;
            }

            .scenario-tab {
                width: 100%;
                padding: 10px;
            }

            .scenario-actions {
                flex-direction: column;
            }

            .scenario-btn {
                width: 100%;
            }

            .save-load-btn {
                font-size: 12px;
                padding: 8px 15px;
            }

            .content {
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 20px;
            }

            .section {
                padding: 20px;
            }

            .section h2 {
                font-size: 18px;
            }

            .form-group label {
                font-size: 13px;
            }

            .form-group input,
            .form-group select {
                font-size: 14px;
            }

            .time-slot {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .time-slot input {
                font-size: 14px;
            }

            .calculate-btn {
                padding: 12px;
                font-size: 14px;
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .result-card {
                padding: 15px;
            }

            .result-card h3 {
                font-size: 14px;
            }

            .result-card .value {
                font-size: 24px;
            }

            .result-card-large .value {
                font-size: 28px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                padding: 15px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .recommendation-card {
                padding: 15px;
            }

            .comparison-table {
                font-size: 12px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px 5px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .modal-body {
                padding: 20px;
            }

            .manager-report-grid {
                grid-template-columns: 1fr;
            }

            .logo-container {
                flex-direction: column;
                gap: 10px;
            }

            .logo-container img {
                max-height: 60px;
            }

            #exportButtons {
                flex-direction: column;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .header {
                background: #1e3c72 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-after: avoid;
            }

            .logo-container {
                page-break-inside: avoid;
            }

            .section {
                page-break-inside: avoid;
                margin-bottom: 20px;
            }

            .results {
                page-break-before: always;
            }

            .calculate-btn, .action-buttons, .upload-logo-btn {
                display: none !important;
            }

            .result-card {
                page-break-inside: avoid;
            }

            .form-group input, .form-group select, .time-slot input {
                border: 1px solid #dee2e6;
                background: white;
            }

            @page {
                margin: 1cm;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- User Menu -->
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleUserDropdown()" id="userAvatar">
                    <span id="userInitials">?</span>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-info">
                        <div class="user-name" id="currentUserName">Misafir</div>
                        <span class="user-role viewer" id="currentUserRole">Viewer</span>
                    </div>
                    <div class="user-menu-item" onclick="showUserProfile()">
                        👤 Profil
                    </div>
                    <div class="user-menu-item" id="adminPanelBtn" style="display: none;" onclick="openAdminPanel()">
                        👑 Admin Paneli
                    </div>
                    <div class="user-menu-item" onclick="showTeamMembers()">
                        👥 Ekip Üyeleri
                    </div>
                    <div class="user-menu-item" onclick="showSettings()">
                        ⚙️ Ayarlar
                    </div>
                    <div class="user-menu-item" onclick="logout()" style="color: #dc3545;">
                        🚪 Çıkış Yap
                    </div>
                </div>
            </div>

            <!-- Tema Kontrolleri -->
            <div class="theme-controls">
                <button class="theme-btn active" id="lightThemeBtn" onclick="setTheme('light')" title="Aydınlık Tema">
                    ☀️
                </button>
                <button class="theme-btn" id="darkThemeBtn" onclick="setTheme('dark')" title="Karanlık Tema">
                    🌙
                </button>
                <div class="color-picker-container">
                    <button class="color-btn" onclick="toggleColorPicker()">
                        🎨 <span data-i18n="color">Renk</span>
                    </button>
                    <div class="color-picker-menu" id="colorPickerMenu">
                        <div style="margin-bottom: 10px; font-weight: 600; color: #1e3c72;" data-i18n="selectColor">Tema Rengi Seç:</div>
                        <div class="color-option active" style="background: linear-gradient(135deg, #667eea, #764ba2);" onclick="setColor('#667eea', '#764ba2')" data-primary="#667eea" data-secondary="#764ba2"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #f093fb, #f5576c);" onclick="setColor('#f093fb', '#f5576c')" data-primary="#f093fb" data-secondary="#f5576c"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #4facfe, #00f2fe);" onclick="setColor('#4facfe', '#00f2fe')" data-primary="#4facfe" data-secondary="#00f2fe"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #43e97b, #38f9d7);" onclick="setColor('#43e97b', '#38f9d7')" data-primary="#43e97b" data-secondary="#38f9d7"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #fa709a, #fee140);" onclick="setColor('#fa709a', '#fee140')" data-primary="#fa709a" data-secondary="#fee140"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #30cfd0, #330867);" onclick="setColor('#30cfd0', '#330867')" data-primary="#30cfd0" data-secondary="#330867"></div>
                    </div>
                </div>
                <select id="languageSelector" onchange="changeLanguage(this.value)" style="padding: 8px 12px; border-radius: 8px; border: 2px solid white; background: rgba(255,255,255,0.2); color: white; cursor: pointer; font-weight: 600;">
                    <option value="tr">🇹🇷 TR</option>
                    <option value="en">🇬🇧 EN</option>
                </select>
            </div>

            <div class="logo-container">
                <img id="companyLogo" src="" alt="Logo" style="display: none;">
                <div>
                    <h1>🅿️ <span data-i18n="title">PARKEXPERT FİZİBİLİTE HESAPLAMA</span></h1>
                    <p data-i18n="subtitle">Otopark Lokasyonu Karlılık Analizi</p>
                </div>
            </div>
            <input type="file" id="logoUpload" class="logo-upload" accept="image/*">
            <button class="upload-logo-btn" onclick="document.getElementById('logoUpload').click()">
                📸 <span data-i18n="uploadLogo">Logo Yükle</span>
            </button>
            
            <!-- Kaydet/Yükle Butonları -->
            <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                <button class="save-load-btn" onclick="saveCalculation()">
                    💾 Hesaplamayı Kaydet
                </button>
                <button class="save-load-btn" onclick="showLoadModal()">
                    📂 Kayıtlı Hesaplamalar
                </button>
            </div>

            <!-- Senaryo Karşılaştırma -->
            <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid rgba(255,255,255,0.2);">
                <div class="scenario-tabs">
                    <div class="scenario-tab active" onclick="switchScenario('A')" id="tabA">
                        📊 <span data-i18n="scenarioA">Senaryo A</span>
                    </div>
                    <div class="scenario-tab" onclick="switchScenario('B')" id="tabB">
                        📊 <span data-i18n="scenarioB">Senaryo B</span>
                    </div>
                </div>
                <div class="scenario-actions">
                    <button class="scenario-btn save" onclick="saveCurrentScenario()">
                        💾 <span data-i18n="saveScenario">Bu Senaryoyu Kaydet</span>
                    </button>
                    <button class="scenario-btn compare" onclick="compareScenarios()">
                        ⚖️ <span data-i18n="compareScenarios">Senaryoları Karşılaştır</span>
                    </button>
                    <button class="scenario-btn clear" onclick="clearScenario()">
                        🗑️ <span data-i18n="clearScenario">Senaryoyu Temizle</span>
                    </button>
                </div>
                <div id="scenarioIndicator" style="text-align: center; margin-top: 10px; color: white; font-weight: 600;">
                    📊 <span data-i18n="activeScenario">Aktif: Senaryo</span> A
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Template Seçimi -->
            <div class="section" style="grid-column: 1 / -1;">
                <div class="template-section">
                    <h2 style="text-align: center; color: white; margin: 0 0 10px 0;">💼 HIZLI ŞABLON SEÇİMİ</h2>
                    <p style="text-align: center; color: rgba(255,255,255,0.8); margin: 0 0 20px 0; font-size: 14px;">
                        <span data-i18n="templateDesc">Sektörünüze uygun hazır şablonları kullanarak hızlıca başlayın</span>
                    </p>
                    <div class="template-grid">
                        <div class="template-card" onclick="applyTemplate('avm')">
                            <div class="template-icon">🏬</div>
                            <div class="template-title">AVM</div>
                            <div class="template-desc">Alışveriş Merkezi<br>Yoğun Trafik</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('plaza')">
                            <div class="template-icon">🏢</div>
                            <div class="template-title">Plaza / Ofis</div>
                            <div class="template-desc">İş Merkezi<br>Hafta İçi Yoğun</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('hastane')">
                            <div class="template-icon">🏥</div>
                            <div class="template-title">Hastane</div>
                            <div class="template-desc">Sağlık Tesisi<br>7/24 Aktif</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('otel')">
                            <div class="template-icon">🏨</div>
                            <div class="template-title">Otel</div>
                            <div class="template-desc">Konaklama<br>Turist Ağırlıklı</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('stadyum')">
                            <div class="template-icon">🏟️</div>
                            <div class="template-title">Stadyum / Salon</div>
                            <div class="template-desc">Etkinlik Alanı<br>Yüksek Kapasite</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('custom')">
                            <div class="template-icon">⚙️</div>
                            <div class="template-title">Özel</div>
                            <div class="template-desc">Manuel Giriş<br>Sıfırdan Başla</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Genel Bilgiler -->
            <div class="section">
                <h2>📊 Genel Bilgiler</h2>
                <div class="form-group">
                    <label>Lokasyon Adı <span class="info-icon" data-tooltip="Otopark lokasyonunun adı. Örnek: Olivium AVM, Zorlu Center, Metropol İstanbul vb.">i</span></label>
                    <input type="text" id="locationName" placeholder="Örn: Olivium AVM">
                </div>
                <div class="form-group">
                    <label>Devinim <span class="info-icon" data-tooltip="Bir park yerinin günde kaç kez kullanıldığını gösteren oran. Örnek: 1.5 = Her park yeri günde ortalama 1.5 kez kullanılıyor. Yüksek devinim = Daha fazla kazanç.">i</span></label>
                    <input type="number" id="devinim" value="1.5" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Çalışılan Ay (Yıllık) <span class="info-icon" data-tooltip="Yıl içinde kaç ay otopark çalışacak. Genellikle 12 ay (tüm yıl) seçilir. Mevsimlik otoparklar için daha az olabilir.">i</span></label>
                    <input type="number" id="workingMonths" value="12" min="1" max="12">
                </div>
            </div>

            <!-- Operasyonel Giderler -->
            <div class="section">
                <h2>👥 PERSONEL</h2>
                
                <div class="form-group">
                    <label>Asgari Ücretli Personel Sayısı <span class="info-icon" data-tooltip="Asgari ücretle çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staffMinWage" value="2" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>
                
                <div class="form-group">
                    <label>25.000₺ Ücretli Personel Sayısı <span class="info-icon" data-tooltip="25.000₺ maaşla çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staff25k" value="0" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>
                
                <div class="form-group">
                    <label>Yönetici Sayısı <span class="info-icon" data-tooltip="Yönetici kadrosunda çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staffManager" value="0" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>

                <!-- Toggle Butonu -->
                <button type="button" onclick="toggleStaffDetails()" style="width: 100%; padding: 10px; margin: 20px 0 10px 0; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer; font-weight: 600; color: #495057; transition: all 0.3s;">
                    📋 Maliyet Detaylarını Göster/Gizle
                </button>

                <!-- Detay Bölümü (Gizli) -->
                <div id="staffDetailsSection" style="display: none; margin-top: 15px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #dee2e6;">
                    <h3 style="color: #495057; font-size: 15px; margin-bottom: 15px; text-align: center;">💰 PERSONEL MALİYET DETAYLARI</h3>
                    
                    <!-- Asgari Ücretli Detay -->
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">Asgari Ücretli Personel</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staffMinWageCost" readonly value="39.486,68" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staffMinWageCoef" readonly value="43.435,35" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staffMinWageFinal" readonly value="52.122,42" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>

                    <!-- 25k Detay -->
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">25.000₺ Ücretli Personel</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staff25kCost" readonly value="44.082,00" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staff25kCoef" readonly value="48.490,20" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staff25kFinal" readonly value="58.188,24" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>

                    <!-- Yönetici Detay -->
                    <div>
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">Yönetici</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staffManagerCost" readonly value="70.435,00" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staffManagerCoef" readonly value="77.478,50" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staffManagerFinal" readonly value="92.974,20" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 25px; padding-top: 20px; border-top: 3px solid #667eea;">
                    <label style="color: #667eea; font-size: 16px;">Toplam Personel Sayısı</label>
                    <input type="text" id="staffCountTotal" readonly value="2" 
                           style="background-color: #f0f4ff; cursor: not-allowed; font-weight: 700; font-size: 18px; color: #1e3c72; border: 2px solid #667eea;">
                </div>
                <div class="form-group">
                    <label style="color: #28a745; font-size: 16px;">Toplam Aylık Personel Maliyeti (KDV'li + Katsayılı)</label>
                    <input type="text" id="staffCostTotal" readonly value="104.244,84" 
                           style="background-color: #f0fff4; cursor: not-allowed; font-weight: 700; font-size: 18px; color: #28a745; border: 2px solid #28a745;">
                </div>
            </div>

            <!-- Maliyet ve Giderler -->
            <div class="section">
                <h2>💰 Maliyet ve Giderler</h2>
                <div class="form-group">
                    <label>Yatırım Maliyeti KDV'li (₺) <span class="info-icon" data-tooltip="Otopark sisteminin kurulum maliyeti. Yazılım, donanım, montaj dahil toplam yatırım tutarı (KDV dahil).">i</span></label>
                    <input type="text" id="investmentCost" value="1.074.165" 
                           onkeyup="formatNumberInput(this)" 
                           onblur="formatNumberInput(this)">
                </div>
                <div class="form-group">
                    <label>Amortisman Süresi (Ay) <span class="info-icon" data-tooltip="Yatırımın kaç ayda itfa edileceği. Örnek: 36 ay = 3 yıl. Bu sürede yatırım maliyeti aylık gider olarak dağıtılır.">i</span></label>
                    <input type="number" id="amortizationMonths" value="36" min="1" max="120">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Yatırımın kaç ayda itfa edileceği</div>
                </div>
                <div class="form-group">
                    <label>Operasyonel Gider Oranı (%) <span class="info-icon" data-tooltip="Hasılat üzerinden hesaplanan işletme giderleri. Elektrik, su, bakım-onarım, temizlik vb. masraflar için ayrılan oran.">i</span></label>
                    <input type="number" id="operationalRate" value="10" min="0" max="100" step="0.1">
                </div>
                <div class="form-group">
                    <label>Kira Oranı (%) <span class="info-icon" data-tooltip="İşletmeye (AVM/Plaza) ödenen kira oranı. Hasılat üzerinden hesaplanır. Örnek: %35 = Hasılatın %35'i işletmeye ödenir.">i</span></label>
                    <input type="number" id="rentRate" value="35" min="0" max="100" step="0.1">
                </div>
            </div>

            <!-- Abonelikler -->
            <div class="section">
                <h2>👥 ABONELİKLER</h2>
                
                <div class="form-group">
                    <label>Personel Abone Sayısı <span class="info-icon" data-tooltip="İşletmede çalışan personele özel abonelik sayısı. Genellikle indirimli fiyatla verilir.">i</span></label>
                    <input type="number" id="personelSubs" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Personel Abone Fiyatı (Aylık) (₺) <span class="info-icon" data-tooltip="Personel aboneliği aylık ücreti. İşletme personeline verilen özel fiyat.">i</span></label>
                    <input type="number" id="personelPrice" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>Dış Abonelik Sayısı <span class="info-icon" data-tooltip="İşletme dışından (harici müşteriler) alınan aylık abonelik sayısı. Normal fiyattan satılır.">i</span></label>
                    <input type="number" id="externalSubs" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Dış Abonelik Fiyatı (Aylık) (₺) <span class="info-icon" data-tooltip="Harici müşterilere verilen aylık abonelik ücreti. Market fiyatıdır.">i</span></label>
                    <input type="number" id="externalPrice" value="0" min="0">
                </div>
            </div>

            <!-- Hafta İçi Tarifeleri -->
            <div class="section">
                <h2>📅 HAFTAİÇİ TARİFELERİ</h2>

                <div class="form-group">
                    <label>Hafta İçi Satılabilir Kapasite <span class="info-icon" data-tooltip="Hafta içi günlerde satılabilir toplam araç kapasitesi. Fiziksel kapasiteden rezerv ve abonelik alanları düşüldükten sonra kalan sayı.">i</span></label>
                    <input type="number" id="weekdayCapacity" value="1670" min="0" onchange="calculateWeekendCapacity()" onkeyup="calculateWeekendCapacity()">
                </div>
                <div class="form-group">
                    <label>Çalışılan Gün (Aylık) <span class="info-icon" data-tooltip="Bir ayda kaç gün hafta içi çalışıldığı. Genelde 22-23 gün kullanılır (Pzt-Cum toplam).">i</span></label>
                    <input type="number" id="workingDays" value="22" min="1" max="31">
                </div>

                <div class="time-slot">
                    <label>Saat Dilimi</label>
                    <label>Tarife (₺)</label>
                    <label>Kullanım %</label>
                    <label>Park/Gün</label>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot1_hours" value="0-3" placeholder="0-3">
                    <input type="number" id="wd_slot1_tariff" value="0" min="0">
                    <input type="number" id="wd_slot1_usage" value="90" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot1_parking" value="1503" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot2_hours" value="3-4" placeholder="3-4">
                    <input type="number" id="wd_slot2_tariff" value="150" min="0">
                    <input type="number" id="wd_slot2_usage" value="7" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot2_parking" value="117" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot3_hours" value="4-5" placeholder="4-5">
                    <input type="number" id="wd_slot3_tariff" value="175" min="0">
                    <input type="number" id="wd_slot3_usage" value="2.19" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot3_parking" value="37" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot4_hours" value="5-6" placeholder="5-6">
                    <input type="number" id="wd_slot4_tariff" value="200" min="0">
                    <input type="number" id="wd_slot4_usage" value="0.77" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot4_parking" value="13" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot5_hours" value="6-12" placeholder="6-12">
                    <input type="number" id="wd_slot5_tariff" value="250" min="0">
                    <input type="number" id="wd_slot5_usage" value="0.02" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot5_parking" value="0" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot6_hours" value="12-24" placeholder="12-24">
                    <input type="number" id="wd_slot6_tariff" value="500" min="0">
                    <input type="number" id="wd_slot6_usage" value="0.02" min="0" max="100" step="0.01">
                    <input type="number" id="wd_slot6_parking" value="0" min="0">
                </div>
            </div>

            <!-- Hafta Sonu Tarifeleri -->
            <div class="section">
                <h2>📅 HAFTASONU TARİFELERİ</h2>
                
                <div class="form-group">
                    <label>Hafta Sonu Satılabilir Kapasite <span class="info-icon" data-tooltip="Hafta sonu günlerde satılabilir araç kapasitesi. Otomatik olarak hafta içi kapasitenin 1.5 katı olarak hesaplanır.">i</span></label>
                    <input type="number" id="weekendCapacity" value="2505" min="0" readonly 
                           style="background-color: #f0f4ff; cursor: not-allowed; font-weight: 600; color: #667eea;">
                </div>
                <div class="form-group">
                    <label>Çalışılan Gün (Aylık) <span class="info-icon" data-tooltip="Bir ayda kaç gün hafta sonu çalışıldığı. Genelde 8-9 gün kullanılır (Cmt+Paz toplam).">i</span></label>
                    <input type="number" id="weekendDays" value="8" min="0" max="31">
                </div>

                <div class="time-slot">
                    <label>Saat Dilimi</label>
                    <label>Tarife (₺)</label>
                    <label>Kullanım %</label>
                    <label>Park/Gün</label>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot1_hours" value="0-3" placeholder="0-3">
                    <input type="number" id="we_slot1_tariff" value="0" min="0">
                    <input type="number" id="we_slot1_usage" value="85" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot1_parking" value="1828" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot2_hours" value="3-4" placeholder="3-4">
                    <input type="number" id="we_slot2_tariff" value="150" min="0">
                    <input type="number" id="we_slot2_usage" value="9" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot2_parking" value="194" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot3_hours" value="4-5" placeholder="4-5">
                    <input type="number" id="we_slot3_tariff" value="175" min="0">
                    <input type="number" id="we_slot3_usage" value="3" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot3_parking" value="65" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot4_hours" value="5-6" placeholder="5-6">
                    <input type="number" id="we_slot4_tariff" value="200" min="0">
                    <input type="number" id="we_slot4_usage" value="2" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot4_parking" value="43" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot5_hours" value="6-12" placeholder="6-12">
                    <input type="number" id="we_slot5_tariff" value="250" min="0">
                    <input type="number" id="we_slot5_usage" value="0.5" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot5_parking" value="11" min="0">
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot6_hours" value="12-24" placeholder="12-24">
                    <input type="number" id="we_slot6_tariff" value="500" min="0">
                    <input type="number" id="we_slot6_usage" value="0.5" min="0" max="100" step="0.01">
                    <input type="number" id="we_slot6_parking" value="11" min="0">
                </div>
            </div>

            <!-- Hesapla Butonu -->
            <button class="calculate-btn" onclick="calculate()">📊 <span data-i18n="calculate">FİZİBİLİTE HESAPLA</span></button>

            <!-- Yazdır ve PDF Butonları -->
            <div class="action-buttons">
                <button class="action-btn" onclick="printReport()">
                    🖨️ Yazdır
                </button>
                <button class="action-btn" onclick="downloadPDF()">
                    📥 PDF İndir
                </button>
            </div>

            <!-- Yönetici Raporu Butonu -->
            <button class="manager-report-btn" id="managerReportBtn" onclick="generateManagerReport()">
                📊 Yönetici Özet Raporu Oluştur
            </button>

            <!-- Export Butonları -->
            <div id="exportButtons" style="display: none; margin-top: 15px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="export-btn excel-btn" onclick="exportToExcel()">
                    📊 <span data-i18n="exportExcel">Excel'e Aktar</span>
                </button>
                <button class="export-btn pdf-btn" onclick="exportToPDF()">
                    📄 <span data-i18n="exportPDFCharts">PDF İndir (Grafiklerle)</span>
                </button>
            </div>

            <!-- Paylaşım Butonları -->
            <div id="shareButtons" class="share-section" style="display: none;">
                <button class="share-btn whatsapp" onclick="shareViaWhatsApp()">
                    📱 WhatsApp
                </button>
                <button class="share-btn email" onclick="shareViaEmail()">
                    📧 Email
                </button>
                <button class="share-btn telegram" onclick="shareViaTelegram()">
                    ✈️ Telegram
                </button>
                <button class="share-btn copy" onclick="copyReportLink()">
                    📋 Linki Kopyala
                </button>
            </div>

            <!-- Senaryo Karşılaştırma Sonuçları -->
            <div class="comparison-container" id="comparisonResults" style="display: none; grid-column: 1 / -1;">
                <div class="comparison-header">
                    <h2>⚖️ SENARYO KARŞILAŞTIRMASI</h2>
                    <div id="winnerBadge"></div>
                </div>
                <div id="comparisonContent"></div>
            </div>

            <!-- Notlar & Varsayımlar -->
            <div class="section" style="grid-column: 1 / -1;">
                <div class="notes-section">
                    <div class="notes-header">
                        <h3 style="margin: 0; color: #1e3c72;">📝 Notlar & Varsayımlar</h3>
                        <button onclick="saveNotes()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            💾 Notu Kaydet
                        </button>
                    </div>
                    <textarea id="calculationNotes" class="notes-textarea" placeholder="Hesaplama hakkında notlarınızı, varsayımlarınızı veya özel açıklamalarınızı buraya yazabilirsiniz..."></textarea>
                    <div style="margin-top: 10px; font-size: 12px; color: #6c757d;">
                        💡 Bu notlar hesaplama ile birlikte kaydedilir ve raporlara eklenir.
                    </div>
                </div>
            </div>

            <!-- Live Dashboard -->
            <div class="dashboard-container" id="liveDashboard">
                <div class="dashboard-header">
                    <h2>📊 CANLI DASHBOARD</h2>
                    <p style="margin: 0; opacity: 0.9;">Gerçek Zamanlı Performans Göstergeleri</p>
                </div>
                <div class="dashboard-kpis" id="dashboardKPIs">
                    <!-- KPI'lar buraya gelecek -->
                </div>
            </div>

            <!-- Sonuçlar -->
            <div class="results" id="results" style="display: none;">
                <h2>📈 FİZİBİLİTE SONUÇLARI</h2>
                <div class="result-grid" id="resultGrid"></div>
            </div>

            <!-- Grafikler Bölümü -->
            <div class="charts-section" id="chartsSection" style="display: none;">
                <h2 style="text-align: center; color: #1e3c72; margin-bottom: 10px;">📊 GRAFİK ANALİZLER</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>📊 Hafta İçi vs Hafta Sonu Hasılat</h3>
                        <div class="chart-wrapper">
                            <canvas id="revenueComparisonChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>🥧 Gider Dağılımı</h3>
                        <div class="chart-wrapper">
                            <canvas id="expenseDistributionChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>📈 Aylık Gelir vs Gider</h3>
                        <div class="chart-wrapper">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>💰 12 Aylık Kar/Zarar Projeksiyonu</h3>
                        <div class="chart-wrapper">
                            <canvas id="yearlyProjectionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Akıllı Öneriler -->
            <div class="recommendations-section" id="recommendationsSection" style="display: none;">
                <div class="recommendations-container">
                    <div class="recommendations-header">
                        <h2>🤖 AKILLI ÖNERİLER & ANALİZ</h2>
                        <p style="margin: 0; opacity: 0.9;">Yapay Zeka Destekli Kar Optimizasyonu</p>
                    </div>
                    <div class="ai-score">
                        <div class="ai-score-circle" id="profitabilityScore">
                            <div class="ai-score-value" id="scoreValue">-</div>
                            <div class="ai-score-label">Karlılık Skoru</div>
                        </div>
                    </div>
                    <div class="recommendations-grid" id="recommendationsGrid">
                        <!-- Öneriler buraya gelecek -->
                    </div>
                </div>
            </div>

            <!-- Yönetici Raporu -->
            <div class="manager-report" id="managerReport">
                <h2>📊 YÖNETİCİ ÖZET RAPORU</h2>
                <div id="managerReportContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Binlik ayraç formatı
        function formatNumberInput(input) {
            let value = input.value.replace(/\./g, '').replace(/,/g, '');
            if (value && !isNaN(value)) {
                input.value = parseInt(value).toLocaleString('tr-TR');
            }
        }


        // Personel detaylarını göster/gizle
        function toggleStaffDetails() {
            const detailsSection = document.getElementById('staffDetailsSection');
            if (detailsSection.style.display === 'none') {
                detailsSection.style.display = 'block';
            } else {
                detailsSection.style.display = 'none';
            }
        }

        // Hafta sonu kapasitesini otomatik hesapla
        function calculateWeekendCapacity() {
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = Math.round(weekdayCapacity * 1.5);
            document.getElementById('weekendCapacity').value = weekendCapacity;
        }

        // TEMA YÖNETİMİ FONKSİYONLARI
        
        // Çeviri Veritabanı
        const translations = {
            tr: {
                // Header
                title: "PARKEXPERT FİZİBİLİTE HESAPLAMA",
                subtitle: "Otopark Lokasyonu Karlılık Analizi",
                uploadLogo: "Logo Yükle",
                saveCalculation: "Hesaplamayı Kaydet",
                savedCalculations: "Kayıtlı Hesaplamalar",
                color: "Renk",
                selectColor: "Tema Rengi Seç:",
                
                // Scenarios
                scenarioA: "Senaryo A",
                scenarioB: "Senaryo B",
                saveScenario: "Bu Senaryoyu Kaydet",
                compareScenarios: "Senaryoları Karşılaştır",
                clearScenario: "Senaryoyu Temizle",
                activeScenario: "Aktif: Senaryo",
                
                // Buttons
                calculate: "Fizibilite Hesapla",
                print: "Yazdır",
                downloadPDF: "PDF İndir",
                exportExcel: "Excel'e Aktar",
                exportPDFCharts: "PDF İndir (Grafiklerle)",
                generateReport: "Yönetici Özet Raporu Oluştur",
                
                // Sections
                generalInfo: "Genel Bilgiler",
                personnel: "PERSONEL",
                costsExpenses: "Maliyet ve Giderler",
                subscriptions: "ABONELİKLER",
                weekdayRates: "HAFTAİÇİ TARİFELERİ",
                weekendRates: "HAFTASONU TARİFELERİ",
                results: "FİZİBİLİTE SONUÇLARI",
                charts: "GRAFİK ANALİZLER",
                smartRecommendations: "AKILLI ÖNERİLER & ANALİZ",
                aiAnalysis: "Yapay Zeka Destekli Kar Optimizasyonu",
                profitabilityScore: "Karlılık Skoru",
                managerReport: "YÖNETİCİ ÖZET RAPORU"
            },
            en: {
                // Header
                title: "PARKEXPERT FEASIBILITY CALCULATOR",
                subtitle: "Parking Location Profitability Analysis",
                uploadLogo: "Upload Logo",
                saveCalculation: "Save Calculation",
                savedCalculations: "Saved Calculations",
                color: "Color",
                selectColor: "Select Theme Color:",
                
                // Scenarios
                scenarioA: "Scenario A",
                scenarioB: "Scenario B",
                saveScenario: "Save This Scenario",
                compareScenarios: "Compare Scenarios",
                clearScenario: "Clear Scenario",
                activeScenario: "Active: Scenario",
                
                // Buttons
                calculate: "Calculate Feasibility",
                print: "Print",
                downloadPDF: "Download PDF",
                exportExcel: "Export to Excel",
                exportPDFCharts: "Download PDF (with Charts)",
                generateReport: "Generate Manager Summary",
                
                // Sections
                generalInfo: "General Information",
                personnel: "PERSONNEL",
                costsExpenses: "Costs and Expenses",
                subscriptions: "SUBSCRIPTIONS",
                weekdayRates: "WEEKDAY RATES",
                weekendRates: "WEEKEND RATES",
                results: "FEASIBILITY RESULTS",
                charts: "CHART ANALYSIS",
                smartRecommendations: "SMART RECOMMENDATIONS & ANALYSIS",
                aiAnalysis: "AI-Powered Profit Optimization",
                profitabilityScore: "Profitability Score",
                managerReport: "MANAGER SUMMARY REPORT"
            }
        };

        let currentLanguage = 'tr';

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('parkexpert-language', lang);
            
            // Tüm data-i18n attribute'larını güncelle
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    // Input placeholder'lar için
                    if (element.tagName === 'INPUT' && element.placeholder) {
                        element.placeholder = translations[lang][key];
                    } 
                    // Button ve text içerikler için
                    else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Sayfa başlığını güncelle
            document.title = lang === 'tr' ? 
                'Parkexpert - Otopark Fizibilite Hesaplama' : 
                'Parkexpert - Parking Feasibility Calculator';
            
            // Başarım
            unlockAchievement('multilingual');
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('parkexpert-theme', theme);
            
            // Buton durumlarını güncelle
            document.getElementById('lightThemeBtn').classList.toggle('active', theme === 'light');
            document.getElementById('darkThemeBtn').classList.toggle('active', theme === 'dark');
            
            // Başarım
            unlockAchievement('theme_changer');
        }

        function setColor(primary, secondary) {
            document.documentElement.style.setProperty('--primary-color', primary);
            document.documentElement.style.setProperty('--secondary-color', secondary);
            
            // Rengi localStorage'a kaydet
            localStorage.setItem('parkexpert-primary-color', primary);
            localStorage.setItem('parkexpert-secondary-color', secondary);
            
            // Aktif renk seçeneğini işaretle
            document.querySelectorAll('.color-option').forEach(option => {
                const isActive = option.getAttribute('data-primary') === primary;
                option.classList.toggle('active', isActive);
            });
            
            // Menüyü kapat
            setTimeout(() => {
                document.getElementById('colorPickerMenu').classList.remove('active');
            }, 300);
        }

        function toggleColorPicker() {
            document.getElementById('colorPickerMenu').classList.toggle('active');
        }

        // Sayfa dışına tıklayınca renk seçiciyi kapat
        document.addEventListener('click', function(e) {
            const colorPicker = document.querySelector('.color-picker-container');
            if (colorPicker && !colorPicker.contains(e.target)) {
                document.getElementById('colorPickerMenu').classList.remove('active');
            }
        });

        // Personel maliyeti otomatik hesaplama (kategori bazlı)
        function calculateTotalStaffCost() {
            const minWageCount = parseFloat(document.getElementById('staffMinWage').value) || 0;
            const minWageCostFinal = 52122.42; // KDV'li + Katsayılı
            
            const staff25kCount = parseFloat(document.getElementById('staff25k').value) || 0;
            const staff25kCostFinal = 58188.24; // KDV'li + Katsayılı
            
            const managerCount = parseFloat(document.getElementById('staffManager').value) || 0;
            const managerCostFinal = 92974.20; // KDV'li + Katsayılı
            
            const totalCount = minWageCount + staff25kCount + managerCount;
            const totalCost = (minWageCount * minWageCostFinal) + (staff25kCount * staff25kCostFinal) + (managerCount * managerCostFinal);
            
            const totalCostFormatted = totalCost.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            document.getElementById('staffCountTotal').value = totalCount;
            document.getElementById('staffCostTotal').value = totalCostFormatted;
        }

        // Logo yükleme
        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const logoImg = document.getElementById('companyLogo');
                    logoImg.src = event.target.result;
                    logoImg.style.display = 'block';
                    // Logo'yu localStorage'a kaydet
                    localStorage.setItem('parkexpertLogo', event.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Sayfa yüklendiğinde logo'yu kontrol et
        window.addEventListener('load', function() {
            // Tema ve renk tercihlerini yükle
            const savedTheme = localStorage.getItem('parkexpert-theme') || 'light';
            const savedPrimary = localStorage.getItem('parkexpert-primary-color');
            const savedSecondary = localStorage.getItem('parkexpert-secondary-color');
            const savedLanguage = localStorage.getItem('parkexpert-language') || 'tr';
            
            setTheme(savedTheme);
            
            if (savedPrimary && savedSecondary) {
                setColor(savedPrimary, savedSecondary);
            }
            
            // Dil tercihini yükle
            document.getElementById('languageSelector').value = savedLanguage;
            changeLanguage(savedLanguage);
            
            // Logo kontrol
            const savedLogo = localStorage.getItem('parkexpertLogo');
            if (savedLogo) {
                const logoImg = document.getElementById('companyLogo');
                logoImg.src = savedLogo;
                logoImg.style.display = 'block';
            }
            
            // Personel maliyeti hesaplamasını başlat
            calculateTotalStaffCost();
            
            // Hafta sonu kapasitesini hesapla
            calculateWeekendCapacity();
            
            // Başarımları yükle
            loadAchievements();
            
            // Currency'yi yükle
            const savedCurrency = localStorage.getItem('parkexpert-currency');
            if (savedCurrency && savedCurrency !== 'TRY') {
                const symbols = { USD: '$', EUR: '€', GBP: '£' };
                changeCurrency(savedCurrency, symbols[savedCurrency]);
            }
            
            // Hatırlatıcıları kontrol et
            checkReminders();
            setInterval(checkReminders, 60000); // Her dakika kontrol et
            
            // Multi-user sistem başlat
            initUserSystem();
            
            console.log('✅ Parkexpert Fizibilite Aracı hazır!');
        });

        function printReport() {
            // Önce hesaplama yapılmış mı kontrol et
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                alert('Lütfen önce fizibilite hesaplaması yapın.');
                return;
            }
            window.print();
        }

        function downloadPDF() {
            // Önce hesaplama yapılmış mı kontrol et
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                alert('Lütfen önce fizibilite hesaplaması yapın.');
                return;
            }
            
            // Kullanıcıya PDF olarak kaydetme talimatı
            alert('PDF indirmek için açılacak yazdırma penceresinden "PDF olarak kaydet" seçeneğini seçin.');
            window.print();
        }

        function calculate() {
            // Genel Bilgiler
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = parseFloat(document.getElementById('weekendCapacity').value) || 0;
            const devinim = parseFloat(document.getElementById('devinim').value) || 1;
            const workingDays = parseFloat(document.getElementById('workingDays').value) || 22;
            const workingMonths = parseFloat(document.getElementById('workingMonths').value) || 12;

            // Maliyetler - Yatırım maliyetini formatlanmış halinden parse et
            const investmentCostValue = document.getElementById('investmentCost').value.replace(/\./g, '').replace(/,/g, '.');
            const investmentCost = parseFloat(investmentCostValue) || 0;
            
            const operationalRate = parseFloat(document.getElementById('operationalRate').value) || 10;
            const rentRate = parseFloat(document.getElementById('rentRate').value) || 35;
            
            // Personel maliyeti - Toplam değerleri kullan
            const staffCount = parseFloat(document.getElementById('staffCountTotal').value) || 0;
            const staffCostTotalValue = document.getElementById('staffCostTotal').value.replace(/\./g, '').replace(/,/g, '.');
            const monthlyStaffCost = parseFloat(staffCostTotalValue) || 0;

            // Abonelik Hesaplamaları (Sadece Personel ve Dış)
            const personelSubs = parseFloat(document.getElementById('personelSubs').value) || 0;
            const personelPrice = parseFloat(document.getElementById('personelPrice').value) || 0;
            const externalSubs = parseFloat(document.getElementById('externalSubs').value) || 0;
            const externalPrice = parseFloat(document.getElementById('externalPrice').value) || 0;

            const monthlySubRevenue = (personelSubs * personelPrice) + (externalSubs * externalPrice);

            // Hafta İçi Saat Dilimi Hesaplamaları
            let weekdayDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`wd_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`wd_slot${i}_parking`).value) || 0;
                weekdayDailyRevenue += tariff * parking;
            }

            // Hafta Sonu Hesaplamaları
            const weekendDays = parseFloat(document.getElementById('weekendDays').value) || 8;

            // Hafta Sonu Saat Dilimi Hesaplamaları
            let weekendDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`we_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`we_slot${i}_parking`).value) || 0;
                weekendDailyRevenue += tariff * parking;
            }

            // Günlük ve Aylık Toplam Hesaplamaları
            const dailyTotalRevenue = weekdayDailyRevenue + weekendDailyRevenue;
            
            const weekdayMonthlyRevenue = (weekdayDailyRevenue * workingDays);
            const weekdayYearlyRevenue = weekdayMonthlyRevenue * workingMonths;

            const weekendMonthlyRevenue = (weekendDailyRevenue * weekendDays);
            const weekendYearlyRevenue = weekendMonthlyRevenue * workingMonths;

            const totalMonthlyRevenue = weekdayMonthlyRevenue + weekendMonthlyRevenue + monthlySubRevenue;
            const totalYearlyRevenue = totalMonthlyRevenue * workingMonths;

            // Amortisman hesaplaması
            const amortizationMonths = parseFloat(document.getElementById('amortizationMonths').value) || 36;
            const monthlyAmortization = investmentCost / amortizationMonths;
            const amortizationPercentage = totalMonthlyRevenue > 0 ? (monthlyAmortization / totalMonthlyRevenue) * 100 : 0;

            // Gider Hesaplamaları
            // monthlyStaffCost zaten toplam maliyet (kategorilerin toplamı)
            const yearlyStaffCost = monthlyStaffCost * 12;
            const staffCostPercentage = (monthlyStaffCost / totalMonthlyRevenue) * 100;

            const monthlyOperationalCost = (totalMonthlyRevenue * operationalRate) / 100;
            const yearlyOperationalCost = monthlyOperationalCost * 12;

            const monthlyRent = (totalMonthlyRevenue * rentRate) / 100;
            const yearlyRent = monthlyRent * 12;

            const totalMonthlyExpenses = monthlyStaffCost + monthlyOperationalCost + monthlyRent;
            const totalYearlyExpenses = yearlyStaffCost + yearlyOperationalCost + yearlyRent;
            const totalExpensesPercentage = (totalMonthlyExpenses / totalMonthlyRevenue) * 100;

            // Net Kar/Zarar
            const monthlyNetProfit = totalMonthlyRevenue - totalMonthlyExpenses;
            const yearlyNetProfit = totalYearlyRevenue - totalYearlyExpenses;
            const netProfitPercentage = (monthlyNetProfit / totalMonthlyRevenue) * 100;

            // Yatırım Geri Dönüş Süresi (Ay)
            const paybackPeriod = monthlyNetProfit > 0 ? investmentCost / monthlyNetProfit : 0;

            // Sonuçları Göster
            const resultsDiv = document.getElementById('results');
            const resultGrid = document.getElementById('resultGrid');
            
            resultsDiv.style.display = 'block';
            
            const profitClass = monthlyNetProfit > 0 ? 'positive' : 'negative';
            const yearlyProfitClass = yearlyNetProfit > 0 ? 'positive' : 'negative';

            resultGrid.innerHTML = `
                <div class="result-card">
                    <h3>Hafta İçi Günlük Hasılat</h3>
                    <div class="value">${formatCurrency(weekdayDailyRevenue)}</div>
                    <div class="small-text">Hafta İçi Aylık: ${formatCurrency(weekdayMonthlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Hafta Sonu Günlük Hasılat</h3>
                    <div class="value">${formatCurrency(weekendDailyRevenue)}</div>
                    <div class="small-text">Hafta Sonu Aylık: ${formatCurrency(weekendMonthlyRevenue)}</div>
                </div>
                <div class="result-card warning">
                    <h3>Günlük Toplam Hasılat</h3>
                    <div class="value">${formatCurrency(dailyTotalRevenue)}</div>
                    <div class="small-text">Aylık Toplam: ${formatCurrency(weekdayMonthlyRevenue + weekendMonthlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Abonelik Hasılatı</h3>
                    <div class="value">${formatCurrency(monthlySubRevenue)}</div>
                    <div class="small-text">Personel + Dış Abonelik</div>
                </div>
                <div class="result-card warning">
                    <h3>Aylık Toplam Hasılat</h3>
                    <div class="value">${formatCurrency(totalMonthlyRevenue)}</div>
                    <div class="small-text">Yıllık: ${formatCurrency(totalYearlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Personel Maliyeti</h3>
                    <div class="value">${formatCurrency(monthlyStaffCost)}</div>
                    <div class="small-text">${staffCount} Personel (İşverene Toplam) • %${staffCostPercentage.toFixed(1)} Oran</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Operasyonel Gider</h3>
                    <div class="value">${formatCurrency(monthlyOperationalCost)}</div>
                    <div class="small-text">%${operationalRate} Oranında</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Toplam Gider</h3>
                    <div class="value">${formatCurrency(totalMonthlyExpenses)}</div>
                    <div class="small-text">%${totalExpensesPercentage.toFixed(1)} Oran • Yıllık: ${formatCurrency(totalYearlyExpenses)}</div>
                </div>
                <div class="result-card ${paybackPeriod < 24 ? 'positive' : paybackPeriod < 48 ? 'warning' : 'negative'}">
                    <h3>Yatırım Geri Dönüş</h3>
                    <div class="value">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay' : 'Belirsiz'}</div>
                    <div class="small-text">${paybackPeriod > 0 ? (paybackPeriod/12).toFixed(1) + ' yıl' : ''}</div>
                </div>
                <div class="result-card">
                    <h3>Yatırım Maliyeti</h3>
                    <div class="value">${formatCurrency(investmentCost)}</div>
                    <div class="small-text">KDV Dahil</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Amortisman Payı</h3>
                    <div class="value">${formatCurrency(monthlyAmortization)}</div>
                    <div class="small-text">${amortizationMonths} Ay • %${amortizationPercentage.toFixed(1)} Oran</div>
                </div>
                <div class="result-card">
                    <h3>Hafta İçi Kapasite</h3>
                    <div class="value">${weekdayCapacity}</div>
                    <div class="small-text">Satılabilir Park Yeri</div>
                </div>
                <div class="result-card">
                    <h3>Hafta Sonu Kapasite</h3>
                    <div class="value">${weekendCapacity}</div>
                    <div class="small-text">x1.5 Otomatik</div>
                </div>
                <div class="result-card">
                    <h3>Devinim</h3>
                    <div class="value">${devinim.toFixed(2)}</div>
                    <div class="small-text">Park Dönüş Oranı</div>
                </div>
                <div class="result-card">
                    <h3>Toplam Abone</h3>
                    <div class="value">${personelSubs + externalSubs}</div>
                    <div class="small-text">Personel + Dış Abonelik</div>
                </div>
                
                <div class="comparison-section">
                    <div class="result-card-large rent-card">
                        <h3>🏢 İşletmeye Ödenen Kira</h3>
                        <div class="value">${formatCurrency(monthlyRent)}</div>
                        <div class="small-text">%${rentRate} Oranı • Yıllık: ${formatCurrency(yearlyRent)}</div>
                    </div>
                    <div class="result-card-large profit-card ${profitClass}">
                        <h3>💼 Bize Kalan Net Kar</h3>
                        <div class="value">${formatCurrency(monthlyNetProfit)}</div>
                        <div class="small-text">${monthlyNetProfit > 0 ? '✅ Karlı' : '❌ Zararlı'} • %${Math.abs(netProfitPercentage).toFixed(1)} Oran • Yıllık: ${formatCurrency(yearlyNetProfit)}</div>
                    </div>
                </div>
            `;

            // Yönetici raporu butonunu göster
            document.getElementById('managerReportBtn').style.display = 'block';
            
            // Export butonlarını göster
            document.getElementById('exportButtons').style.display = 'flex';
            
            // Paylaşım butonlarını göster
            document.getElementById('shareButtons').style.display = 'flex';
            
            // Grafikleri göster ve oluştur
            document.getElementById('chartsSection').style.display = 'block';
            createCharts(weekdayDailyRevenue, weekdayMonthlyRevenue, weekendDailyRevenue, weekendMonthlyRevenue, 
                        monthlySubRevenue, totalMonthlyRevenue, monthlyStaffCost, monthlyOperationalCost, 
                        monthlyRent, totalMonthlyExpenses, monthlyNetProfit);

            // Akıllı öneriler oluştur
            document.getElementById('recommendationsSection').style.display = 'block';
            generateSmartRecommendations({
                totalRevenue: totalMonthlyRevenue,
                totalExpenses: totalMonthlyExpenses,
                netProfit: monthlyNetProfit,
                staffCost: monthlyStaffCost,
                staffCount: staffCount,
                opCost: monthlyOperationalCost,
                rent: monthlyRent,
                weekdayCapacity: weekdayCapacity,
                weekendCapacity: weekendCapacity,
                devinim: devinim,
                rentRate: rentRate,
                operationalRate: operationalRate
            });

            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Dashboard'u güncelle
            updateLiveDashboard({
                totalRevenue: totalMonthlyRevenue,
                netProfit: monthlyNetProfit,
                profitMargin: (monthlyNetProfit / totalMonthlyRevenue) * 100,
                capacity: weekdayCapacity,
                devinim: devinim,
                staffCount: staffCount
            });
            
            // Başarımları kontrol et
            checkAchievements(monthlyNetProfit, profitabilityScore);
        }

        // CANLI DASHBOARD
        function updateLiveDashboard(data) {
            document.getElementById('liveDashboard').classList.add('active');
            
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-icon">💰</div>
                    <div class="kpi-value">${formatCurrency(data.netProfit)}</div>
                    <div class="kpi-label">Net Kar</div>
                    <div class="kpi-trend ${data.netProfit > 0 ? 'up' : 'down'}">
                        ${data.netProfit > 0 ? '↗️' : '↘️'} ${data.profitMargin.toFixed(1)}%
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">📈</div>
                    <div class="kpi-value">${formatCurrency(data.totalRevenue)}</div>
                    <div class="kpi-label">Toplam Gelir</div>
                    <div class="kpi-trend up">↗️ Aylık</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">🅿️</div>
                    <div class="kpi-value">${data.capacity}</div>
                    <div class="kpi-label">Kapasite</div>
                    <div class="kpi-trend up">🔄 x${data.devinim}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">👥</div>
                    <div class="kpi-value">${data.staffCount}</div>
                    <div class="kpi-label">Personel</div>
                    <div class="kpi-trend ${data.staffCount < 5 ? 'up' : 'down'}">
                        ${data.staffCount < 5 ? '✅ Optimal' : '⚠️ Yüksek'}
                    </div>
                </div>
            `;
            
            document.getElementById('dashboardKPIs').innerHTML = kpisHTML;
        }

        // AKILLI ÖNERİLER FONKSİYONU
        function generateSmartRecommendations(data) {
            const recommendations = [];
            
            // Karlılık skorunu hesapla (0-100)
            const profitMargin = (data.netProfit / data.totalRevenue) * 100;
            let profitabilityScore = 0;
            
            if (profitMargin > 30) profitabilityScore = 95;
            else if (profitMargin > 20) profitabilityScore = 85;
            else if (profitMargin > 15) profitabilityScore = 75;
            else if (profitMargin > 10) profitabilityScore = 65;
            else if (profitMargin > 5) profitabilityScore = 50;
            else if (profitMargin > 0) profitabilityScore = 35;
            else profitabilityScore = 15;
            
            // Skoru göster
            const scoreElement = document.getElementById('scoreValue');
            scoreElement.textContent = profitabilityScore;
            scoreElement.style.color = profitabilityScore >= 70 ? '#28a745' : profitabilityScore >= 50 ? '#ffc107' : '#dc3545';
            
            // 1. Personel Optimizasyonu
            const staffCostPercentage = (data.staffCost / data.totalRevenue) * 100;
            if (staffCostPercentage > 30) {
                const savings = data.staffCost * 0.1; // %10 azaltma
                const newProfit = data.netProfit + savings;
                const improvement = ((newProfit - data.netProfit) / data.netProfit * 100).toFixed(1);
                
                recommendations.push({
                    type: 'warning',
                    icon: '👥',
                    title: 'Personel Maliyeti Yüksek',
                    desc: `Personel maliyetiniz hasılatın %${staffCostPercentage.toFixed(1)}'ini oluşturuyor. Sektör ortalaması %20-25 arasıdır.`,
                    impact: `1 personeli azaltarak aylık ${formatCurrency(savings)} tasarruf edebilir, net karı %${improvement} artırabilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (staffCostPercentage < 15 && data.staffCount < 3) {
                recommendations.push({
                    type: 'positive',
                    icon: '✅',
                    title: 'Personel Maliyeti Optimal',
                    desc: `Personel maliyetiniz hasılatın %${staffCostPercentage.toFixed(1)}'i ile ideal seviyede.`,
                    impact: 'Mevcut personel yapınızı koruyun.',
                    impactType: 'positive'
                });
            }
            
            // 2. Kira Optimizasyonu
            const rentPercentage = (data.rent / data.totalRevenue) * 100;
            if (data.rentRate > 40) {
                const newRent = data.totalRevenue * 0.35;
                const savings = data.rent - newRent;
                const improvement = ((savings / data.netProfit) * 100).toFixed(1);
                
                recommendations.push({
                    type: 'critical',
                    icon: '🏢',
                    title: 'Kira Oranı Çok Yüksek',
                    desc: `%${data.rentRate} kira oranı sürdürülebilir değil. Sektör standardı %30-35 arasıdır.`,
                    impact: `Kira oranını %35'e düşürerek aylık ${formatCurrency(savings)} tasarruf edip net karı %${improvement} artırabilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (rentPercentage < 30) {
                recommendations.push({
                    type: 'positive',
                    icon: '✨',
                    title: 'Kira Maliyeti Mükemmel',
                    desc: `%${data.rentRate} kira oranı rekabetçi ve sürdürülebilir.`,
                    impact: 'Mevcut anlaşmanızı korumaya devam edin.',
                    impactType: 'positive'
                });
            }
            
            // 3. Kapasite Kullanımı
            if (data.devinim < 1.2) {
                const potentialRevenue = data.totalRevenue * 1.25;
                const improvement = potentialRevenue - data.totalRevenue;
                
                recommendations.push({
                    type: 'warning',
                    icon: '📊',
                    title: 'Düşük Kapasite Kullanımı',
                    desc: `Devinim oranınız ${data.devinim} ile düşük. Her park yeri günde daha fazla kullanılmalı.`,
                    impact: `Devrinimi 1.5'e çıkararak aylık ${formatCurrency(improvement)} ek gelir elde edebilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (data.devinim > 1.8) {
                recommendations.push({
                    type: 'positive',
                    icon: '🎯',
                    title: 'Yüksek Kapasite Kullanımı',
                    desc: `Devinim oranınız ${data.devinim} ile mükemmel! Kapasiteyi verimli kullanıyorsunuz.`,
                    impact: 'Kapasite genişletme düşünebilirsiniz.',
                    impactType: 'positive'
                });
            }
            
            // 4. Karlılık Analizi
            if (data.netProfit < 0) {
                const breakeven = data.totalExpenses;
                const needed = breakeven - data.totalRevenue;
                
                recommendations.push({
                    type: 'critical',
                    icon: '⚠️',
                    title: 'Zarar Durumu - Acil Önlem Gerekli',
                    desc: `Aylık ${formatCurrency(Math.abs(data.netProfit))} zarar ediyorsunuz. İşletme sürdürülebilir değil.`,
                    impact: `Başa baş noktası için aylık ${formatCurrency(needed)} ek hasılat gerekiyor veya giderleri azaltın.`,
                    impactType: 'negative'
                });
            } else if (profitMargin > 25) {
                recommendations.push({
                    type: 'positive',
                    icon: '🚀',
                    title: 'Mükemmel Karlılık',
                    desc: `%${profitMargin.toFixed(1)} kar marjı ile sektörün üzerinde performans gösteriyorsunuz.`,
                    impact: 'Yeni lokasyon yatırımları değerlendirin!',
                    impactType: 'positive'
                });
            }
            
            // 5. Operasyonel Verimlilik
            const opPercentage = (data.opCost / data.totalRevenue) * 100;
            if (opPercentage > 15) {
                const savings = data.opCost * 0.2;
                
                recommendations.push({
                    type: 'warning',
                    icon: '⚙️',
                    title: 'Operasyonel Giderler Yüksek',
                    desc: `%${data.operationalRate} operasyonel gider oranı yüksek. Optimizasyon fırsatları var.`,
                    impact: `Enerji tasarrufu ve bakım optimizasyonu ile aylık ${formatCurrency(savings)} tasarruf potansiyeli.`,
                    impactType: 'positive'
                });
            }
            
            // 6. Hafta Sonu Potansiyeli
            const weekendPotential = data.weekendCapacity * 1.1; // %10 artış
            if (data.weekendCapacity > data.weekdayCapacity * 1.3) {
                recommendations.push({
                    type: 'positive',
                    icon: '📅',
                    title: 'Hafta Sonu Avantajı',
                    desc: `Hafta sonu kapasitesi yüksek! Bu büyük bir fırsat.`,
                    impact: 'Hafta sonu özel tarifeleri ve kampanyaları değerlendirin.',
                    impactType: 'positive'
                });
            }
            
            // Önerileri ekle
            const grid = document.getElementById('recommendationsGrid');
            grid.innerHTML = recommendations.map(rec => `
                <div class="recommendation-card ${rec.type}">
                    <div class="recommendation-icon">${rec.icon}</div>
                    <div class="recommendation-title">${rec.title}</div>
                    <div class="recommendation-desc">${rec.desc}</div>
                    <div class="recommendation-impact ${rec.impactType}">
                        ${rec.impactType === 'positive' ? '💡 ' : '⚠️ '}${rec.impact}
                    </div>
                </div>
            `).join('');
        }

        // Grafik Oluşturma Fonksiyonu
        let chartInstances = {};

        // Senaryo Yönetimi
        let currentScenario = 'A';
        let scenarioA = null;
        let scenarioB = null;
        let scenarioAResults = null;
        let scenarioBResults = null;

        // Para Birimi Yönetimi
        let currentCurrency = 'TRY';
        let currentCurrencySymbol = '₺';
        const exchangeRates = {
            TRY: 1,
            USD: 35.5,
            EUR: 38.2,
            GBP: 45.1
        };

        function createCharts(weekdayDaily, weekdayMonthly, weekendDaily, weekendMonthly, subRevenue, 
                             totalRevenue, staffCost, opCost, rent, totalExpenses, netProfit) {
            
            // Eski grafikleri temizle
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            chartInstances = {};

            // 1. Hafta İçi vs Hafta Sonu Hasılat Karşılaştırması
            const ctx1 = document.getElementById('revenueComparisonChart');
            if (ctx1) {
                chartInstances.revenueComparison = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['Günlük Hasılat', 'Aylık Hasılat'],
                        datasets: [{
                            label: 'Hafta İçi',
                            data: [weekdayDaily, weekdayMonthly],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Hafta Sonu',
                            data: [weekendDaily, weekendMonthly],
                            backgroundColor: 'rgba(118, 75, 162, 0.8)',
                            borderColor: 'rgba(118, 75, 162, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 2. Gider Dağılımı (Pasta)
            const ctx2 = document.getElementById('expenseDistributionChart');
            if (ctx2) {
                chartInstances.expenseDistribution = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Personel', 'Operasyonel', 'Kira'],
                        datasets: [{
                            data: [staffCost, opCost, rent],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 206, 86, 0.8)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(value) +
                                               ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 3. Gelir vs Gider Karşılaştırması
            const ctx3 = document.getElementById('incomeExpenseChart');
            if (ctx3) {
                chartInstances.incomeExpense = new Chart(ctx3, {
                    type: 'bar',
                    data: {
                        labels: ['Aylık'],
                        datasets: [{
                            label: 'Toplam Gelir',
                            data: [totalRevenue],
                            backgroundColor: 'rgba(75, 192, 192, 0.8)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Toplam Gider',
                            data: [totalExpenses],
                            backgroundColor: 'rgba(255, 99, 132, 0.8)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Net Kar',
                            data: [netProfit],
                            backgroundColor: netProfit > 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            borderColor: netProfit > 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 4. 12 Aylık Projeksiyonu (Çizgi Grafik)
            const ctx4 = document.getElementById('yearlyProjectionChart');
            if (ctx4) {
                const months = ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara'];
                const monthlyData = months.map(() => netProfit);
                const cumulativeData = months.map((_, i) => netProfit * (i + 1));
                
                chartInstances.yearlyProjection = new Chart(ctx4, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Aylık Kar/Zarar',
                            data: monthlyData,
                            borderColor: netProfit > 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            backgroundColor: netProfit > 0 ? 'rgba(40, 167, 69, 0.1)' : 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Kümülatif Kar/Zarar',
                            data: cumulativeData,
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function generateManagerReport() {
            // Tüm değerleri tekrar al
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = parseFloat(document.getElementById('weekendCapacity').value) || 0;
            const workingDays = parseFloat(document.getElementById('workingDays').value) || 22;
            
            // Maliyetler
            const investmentCostValue = document.getElementById('investmentCost').value.replace(/\./g, '').replace(/,/g, '.');
            const investmentCost = parseFloat(investmentCostValue) || 0;
            const amortizationMonths = parseFloat(document.getElementById('amortizationMonths').value) || 36;
            const rentRate = parseFloat(document.getElementById('rentRate').value) || 35;
            
            // Personel
            const staffCount = parseFloat(document.getElementById('staffCountTotal').value) || 0;
            const staffCostTotalValue = document.getElementById('staffCostTotal').value.replace(/\./g, '').replace(/,/g, '.');
            const monthlyStaffCost = parseFloat(staffCostTotalValue) || 0;
            
            // Hesaplamaları yeniden yap
            const personelSubs = parseFloat(document.getElementById('personelSubs').value) || 0;
            const personelPrice = parseFloat(document.getElementById('personelPrice').value) || 0;
            const externalSubs = parseFloat(document.getElementById('externalSubs').value) || 0;
            const externalPrice = parseFloat(document.getElementById('externalPrice').value) || 0;
            const monthlySubRevenue = (personelSubs * personelPrice) + (externalSubs * externalPrice);
            
            let weekdayDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`wd_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`wd_slot${i}_parking`).value) || 0;
                weekdayDailyRevenue += tariff * parking;
            }
            
            const weekendDays = parseFloat(document.getElementById('weekendDays').value) || 8;
            let weekendDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`we_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`we_slot${i}_parking`).value) || 0;
                weekendDailyRevenue += tariff * parking;
            }
            
            const weekdayMonthlyRevenue = weekdayDailyRevenue * workingDays;
            const weekendMonthlyRevenue = weekendDailyRevenue * weekendDays;
            const totalMonthlyRevenue = weekdayMonthlyRevenue + weekendMonthlyRevenue + monthlySubRevenue;
            const totalYearlyRevenue = totalMonthlyRevenue * 12;
            
            const operationalRate = parseFloat(document.getElementById('operationalRate').value) || 10;
            const monthlyOperationalCost = (totalMonthlyRevenue * operationalRate) / 100;
            const monthlyRent = (totalMonthlyRevenue * rentRate) / 100;
            const totalMonthlyExpenses = monthlyStaffCost + monthlyOperationalCost + monthlyRent;
            const monthlyNetProfit = totalMonthlyRevenue - totalMonthlyExpenses;
            const yearlyNetProfit = monthlyNetProfit * 12;
            const netProfitPercentage = totalMonthlyRevenue > 0 ? (monthlyNetProfit / totalMonthlyRevenue) * 100 : 0;
            const paybackPeriod = monthlyNetProfit > 0 ? investmentCost / monthlyNetProfit : 0;
            
            // Rapor içeriğini oluştur
            const profitStatus = monthlyNetProfit > 0 ? '✅ KARLI' : '❌ ZARARLI';
            const profitColor = monthlyNetProfit > 0 ? '#28a745' : '#dc3545';
            
            const reportContent = `
                <div class="manager-summary">
                    <h3>🎯 GENEL DEĞERLENDİRME</h3>
                    <p><strong>${locationName}</strong> lokasyonu için yapılan fizibilite çalışması sonucunda:</p>
                    <p>▪ Aylık Net Kar: <span class="highlight" style="color: ${profitColor}; font-size: 20px;">${formatCurrency(monthlyNetProfit)} (${profitStatus})</span></p>
                    <p>▪ Yıllık Net Kar: <span class="highlight" style="color: ${profitColor}; font-size: 20px;">${formatCurrency(yearlyNetProfit)}</span></p>
                    <p>▪ Kar Marjı: <span class="highlight">${Math.abs(netProfitPercentage).toFixed(1)}%</span></p>
                    <p>▪ Yatırım Geri Dönüş: <span class="highlight">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay (' + (paybackPeriod/12).toFixed(1) + ' yıl)' : 'Belirsiz'}</span></p>
                </div>
                
                <div class="manager-summary">
                    <h3>💰 HASILAT ANALİZİ</h3>
                    <p>▪ Hafta İçi Günlük: ${formatCurrency(weekdayDailyRevenue)} → Aylık: ${formatCurrency(weekdayMonthlyRevenue)}</p>
                    <p>▪ Hafta Sonu Günlük: ${formatCurrency(weekendDailyRevenue)} → Aylık: ${formatCurrency(weekendMonthlyRevenue)}</p>
                    <p>▪ Abonelik Geliri: ${formatCurrency(monthlySubRevenue)}</p>
                    <p>▪ <strong>Toplam Aylık Hasılat: <span class="highlight">${formatCurrency(totalMonthlyRevenue)}</span></strong></p>
                    <p>▪ <strong>Toplam Yıllık Hasılat: <span class="highlight">${formatCurrency(totalYearlyRevenue)}</span></strong></p>
                </div>
                
                <div class="manager-summary">
                    <h3>💸 GİDER ANALİZİ</h3>
                    <p>▪ Personel Maliyeti: ${formatCurrency(monthlyStaffCost)} (${staffCount} Personel - KDV'li + Katsayılı)</p>
                    <p>▪ Operasyonel Gider: ${formatCurrency(monthlyOperationalCost)} (%${operationalRate})</p>
                    <p>▪ İşletmeye Kira: ${formatCurrency(monthlyRent)} (%${rentRate})</p>
                    <p>▪ <strong>Toplam Aylık Gider: <span class="highlight">${formatCurrency(totalMonthlyExpenses)}</span></strong></p>
                </div>
                
                <div class="manager-report-grid">
                    <div class="manager-report-card">
                        <h4>Hafta İçi Kapasite</h4>
                        <div class="value">${weekdayCapacity}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Hafta Sonu Kapasite</h4>
                        <div class="value">${weekendCapacity}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Personel</h4>
                        <div class="value">${staffCount}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Aylık Hasılat</h4>
                        <div class="value">${formatCurrency(totalMonthlyRevenue)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Aylık Gider</h4>
                        <div class="value">${formatCurrency(totalMonthlyExpenses)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Net Kar (Aylık)</h4>
                        <div class="value" style="color: ${profitColor};">${formatCurrency(monthlyNetProfit)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Geri Dönüş</h4>
                        <div class="value">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay' : '-'}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('managerReportContent').innerHTML = reportContent;
            document.getElementById('managerReport').style.display = 'block';
            document.getElementById('managerReport').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // KAYDETME/YÜKLEME FONKSİYONLARI
        function getAllFormData() {
            const data = {
                // Genel bilgiler
                locationName: document.getElementById('locationName').value,
                devinim: document.getElementById('devinim').value,
                workingMonths: document.getElementById('workingMonths').value,
                
                // Kapasite
                weekdayCapacity: document.getElementById('weekdayCapacity').value,
                weekendCapacity: document.getElementById('weekendCapacity').value,
                workingDays: document.getElementById('workingDays').value,
                weekendDays: document.getElementById('weekendDays').value,
                
                // Personel
                staffMinWage: document.getElementById('staffMinWage').value,
                staff25k: document.getElementById('staff25k').value,
                staffManager: document.getElementById('staffManager').value,
                
                // Maliyet
                investmentCost: document.getElementById('investmentCost').value,
                amortizationMonths: document.getElementById('amortizationMonths').value,
                operationalRate: document.getElementById('operationalRate').value,
                rentRate: document.getElementById('rentRate').value,
                
                // Abonelik
                personelSubs: document.getElementById('personelSubs').value,
                personelPrice: document.getElementById('personelPrice').value,
                externalSubs: document.getElementById('externalSubs').value,
                externalPrice: document.getElementById('externalPrice').value,
                
                // Hafta içi tarifeler
                weekdaySlots: [],
                // Hafta sonu tarifeler
                weekendSlots: []
            };
            
            // Hafta içi saat dilimlerini topla
            for (let i = 1; i <= 6; i++) {
                data.weekdaySlots.push({
                    hours: document.getElementById(`wd_slot${i}_hours`).value,
                    tariff: document.getElementById(`wd_slot${i}_tariff`).value,
                    usage: document.getElementById(`wd_slot${i}_usage`).value,
                    parking: document.getElementById(`wd_slot${i}_parking`).value
                });
            }
            
            // Hafta sonu saat dilimlerini topla
            for (let i = 1; i <= 6; i++) {
                data.weekendSlots.push({
                    hours: document.getElementById(`we_slot${i}_hours`).value,
                    tariff: document.getElementById(`we_slot${i}_tariff`).value,
                    usage: document.getElementById(`we_slot${i}_usage`).value,
                    parking: document.getElementById(`we_slot${i}_parking`).value
                });
            }
            
            return data;
        }

        function setAllFormData(data) {
            // Genel bilgiler
            document.getElementById('locationName').value = data.locationName || '';
            document.getElementById('devinim').value = data.devinim || '1.5';
            document.getElementById('workingMonths').value = data.workingMonths || '12';
            
            // Kapasite
            document.getElementById('weekdayCapacity').value = data.weekdayCapacity || '1670';
            document.getElementById('weekendCapacity').value = data.weekendCapacity || '2505';
            document.getElementById('workingDays').value = data.workingDays || '22';
            document.getElementById('weekendDays').value = data.weekendDays || '8';
            
            // Personel
            document.getElementById('staffMinWage').value = data.staffMinWage || '0';
            document.getElementById('staff25k').value = data.staff25k || '0';
            document.getElementById('staffManager').value = data.staffManager || '0';
            
            // Maliyet
            document.getElementById('investmentCost').value = data.investmentCost || '1.074.165';
            document.getElementById('amortizationMonths').value = data.amortizationMonths || '36';
            document.getElementById('operationalRate').value = data.operationalRate || '10';
            document.getElementById('rentRate').value = data.rentRate || '35';
            
            // Abonelik
            document.getElementById('personelSubs').value = data.personelSubs || '0';
            document.getElementById('personelPrice').value = data.personelPrice || '0';
            document.getElementById('externalSubs').value = data.externalSubs || '0';
            document.getElementById('externalPrice').value = data.externalPrice || '0';
            
            // Hafta içi tarifeler
            if (data.weekdaySlots) {
                data.weekdaySlots.forEach((slot, i) => {
                    const index = i + 1;
                    document.getElementById(`wd_slot${index}_hours`).value = slot.hours || '';
                    document.getElementById(`wd_slot${index}_tariff`).value = slot.tariff || '0';
                    document.getElementById(`wd_slot${index}_usage`).value = slot.usage || '0';
                    document.getElementById(`wd_slot${index}_parking`).value = slot.parking || '0';
                });
            }
            
            // Hafta sonu tarifeler
            if (data.weekendSlots) {
                data.weekendSlots.forEach((slot, i) => {
                    const index = i + 1;
                    document.getElementById(`we_slot${index}_hours`).value = slot.hours || '';
                    document.getElementById(`we_slot${index}_tariff`).value = slot.tariff || '0';
                    document.getElementById(`we_slot${index}_usage`).value = slot.usage || '0';
                    document.getElementById(`we_slot${index}_parking`).value = slot.parking || '0';
                });
            }
            
            // Otomatik hesaplamaları tetikle
            calculateTotalStaffCost();
            calculateWeekendCapacity();
        }

        function saveCalculation() {
            document.getElementById('saveModal').style.display = 'block';
            document.getElementById('saveName').value = document.getElementById('locationName').value || '';
        }

        function closeSaveModal() {
            document.getElementById('saveModal').style.display = 'none';
        }

        function confirmSave() {
            const saveName = document.getElementById('saveName').value.trim();
            if (!saveName) {
                alert('Lütfen bir kayıt adı girin!');
                return;
            }
            
            const data = getAllFormData();
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            
            const calculation = {
                id: Date.now(),
                name: saveName,
                data: data,
                savedAt: new Date().toISOString()
            };
            
            savedCalculations.push(calculation);
            localStorage.setItem('parkexpertCalculations', JSON.stringify(savedCalculations));
            
            closeSaveModal();
            alert('✅ Hesaplama başarıyla kaydedildi!');
            
            // Başarımları kontrol et
            if (savedCalculations.length >= 5) {
                unlockAchievement('saver');
            }
        }

        function showLoadModal() {
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            const listContainer = document.getElementById('savedCalculationsList');
            
            if (savedCalculations.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📂</div>
                        <h3>Henüz kayıtlı hesaplama yok</h3>
                        <p>Hesaplamalarınızı kaydetmek için "💾 Hesaplamayı Kaydet" butonunu kullanın.</p>
                    </div>
                `;
            } else {
                listContainer.innerHTML = savedCalculations.reverse().map(calc => {
                    const date = new Date(calc.savedAt);
                    const dateStr = date.toLocaleDateString('tr-TR', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    return `
                        <div class="saved-calculation">
                            <h3>${calc.name}</h3>
                            <div class="saved-calculation-info">
                                <span>📅 ${dateStr}</span>
                                <span>📍 ${calc.data.locationName || 'Belirtilmemiş'}</span>
                                <span>🚗 ${calc.data.weekdayCapacity || 0} Kapasite</span>
                            </div>
                            <div class="saved-calculation-actions">
                                <button class="btn-load" onclick="loadCalculation(${calc.id})">
                                    📂 Yükle
                                </button>
                                <button class="btn-delete" onclick="deleteCalculation(${calc.id})">
                                    🗑️ Sil
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('loadModal').style.display = 'block';
        }

        function closeLoadModal() {
            document.getElementById('loadModal').style.display = 'none';
        }

        function loadCalculation(id) {
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            const calculation = savedCalculations.find(c => c.id === id);
            
            if (calculation) {
                setAllFormData(calculation.data);
                closeLoadModal();
                alert('✅ Hesaplama yüklendi!');
                
                // Sayfayı en üste kaydır
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function deleteCalculation(id) {
            if (!confirm('Bu hesaplamayı silmek istediğinizden emin misiniz?')) {
                return;
            }
            
            let savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            savedCalculations = savedCalculations.filter(c => c.id !== id);
            localStorage.setItem('parkexpertCalculations', JSON.stringify(savedCalculations));
            
            showLoadModal(); // Listeyi yenile
            alert('✅ Hesaplama silindi!');
        }

        // EXPORT FONKSİYONLARI

        function exportToExcel() {
            const data = getAllFormData();
            const locationName = document.getElementById('locationName').value || 'Fizibilite';
            
            // Excel dosyası için worksheetler
            const wb = XLSX.utils.book_new();
            
            // 1. Genel Bilgiler Sayfası
            const generalData = [
                ['PARKEXPERT FİZİBİLİTE RAPORU'],
                [''],
                ['Lokasyon:', data.locationName],
                ['Tarih:', new Date().toLocaleDateString('tr-TR')],
                [''],
                ['KAPASITE BİLGİLERİ'],
                ['Hafta İçi Kapasite:', data.weekdayCapacity],
                ['Hafta Sonu Kapasite:', data.weekendCapacity],
                ['Devinim:', data.devinim],
                [''],
                ['ÇALIŞMA SÜRELERİ'],
                ['Hafta İçi Çalışılan Gün (Aylık):', data.workingDays],
                ['Hafta Sonu Çalışılan Gün (Aylık):', data.weekendDays],
                ['Çalışılan Ay (Yıllık):', data.workingMonths]
            ];
            const ws1 = XLSX.utils.aoa_to_sheet(generalData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Genel Bilgiler');
            
            // 2. Personel Sayfası
            const personnelData = [
                ['PERSONEL BİLGİLERİ'],
                [''],
                ['Kategori', 'Sayı', 'Birim Maliyet', 'Toplam'],
                ['Asgari Ücretli', data.staffMinWage, '52.122,42 ₺', (parseInt(data.staffMinWage) * 52122.42).toFixed(2) + ' ₺'],
                ['25.000₺ Ücretli', data.staff25k, '58.188,24 ₺', (parseInt(data.staff25k) * 58188.24).toFixed(2) + ' ₺'],
                ['Yönetici', data.staffManager, '92.974,20 ₺', (parseInt(data.staffManager) * 92974.20).toFixed(2) + ' ₺'],
                [''],
                ['TOPLAM PERSONEL:', parseInt(data.staffMinWage) + parseInt(data.staff25k) + parseInt(data.staffManager)],
                ['TOPLAM AYLIK MALİYET:', document.getElementById('staffCostTotal').value + ' ₺']
            ];
            const ws2 = XLSX.utils.aoa_to_sheet(personnelData);
            XLSX.utils.book_append_sheet(wb, ws2, 'Personel');
            
            // 3. Maliyet ve Giderler
            const costData = [
                ['MALİYET VE GİDERLER'],
                [''],
                ['Yatırım Maliyeti (KDV Dahil):', data.investmentCost + ' ₺'],
                ['Amortisman Süresi:', data.amortizationMonths + ' Ay'],
                ['Operasyonel Gider Oranı:', '%' + data.operationalRate],
                ['Kira Oranı:', '%' + data.rentRate]
            ];
            const ws3 = XLSX.utils.aoa_to_sheet(costData);
            XLSX.utils.book_append_sheet(wb, ws3, 'Maliyetler');
            
            // 4. Abonelikler
            const subscriptionData = [
                ['ABONELİKLER'],
                [''],
                ['Tip', 'Sayı', 'Fiyat', 'Aylık Toplam'],
                ['Personel Abone', data.personelSubs, data.personelPrice + ' ₺', (parseInt(data.personelSubs) * parseInt(data.personelPrice)) + ' ₺'],
                ['Dış Abonelik', data.externalSubs, data.externalPrice + ' ₺', (parseInt(data.externalSubs) * parseInt(data.externalPrice)) + ' ₺']
            ];
            const ws4 = XLSX.utils.aoa_to_sheet(subscriptionData);
            XLSX.utils.book_append_sheet(wb, ws4, 'Abonelikler');
            
            // 5. Hafta İçi Tarifeler
            const weekdayTariffsData = [
                ['HAFTA İÇİ TARİFELER'],
                [''],
                ['Saat Dilimi', 'Tarife (₺)', 'Kullanım %', 'Park/Gün']
            ];
            data.weekdaySlots.forEach(slot => {
                weekdayTariffsData.push([slot.hours, slot.tariff, slot.usage, slot.parking]);
            });
            const ws5 = XLSX.utils.aoa_to_sheet(weekdayTariffsData);
            XLSX.utils.book_append_sheet(wb, ws5, 'Hafta İçi');
            
            // 6. Hafta Sonu Tarifeler
            const weekendTariffsData = [
                ['HAFTA SONU TARİFELER'],
                [''],
                ['Saat Dilimi', 'Tarife (₺)', 'Kullanım %', 'Park/Gün']
            ];
            data.weekendSlots.forEach(slot => {
                weekendTariffsData.push([slot.hours, slot.tariff, slot.usage, slot.parking]);
            });
            const ws6 = XLSX.utils.aoa_to_sheet(weekendTariffsData);
            XLSX.utils.book_append_sheet(wb, ws6, 'Hafta Sonu');
            
            // Excel dosyasını indir
            const fileName = `Parkexpert_Fizibilite_${locationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('✅ Excel dosyası başarıyla indirildi!');
            
            // Başarım
            unlockAchievement('exporter');
        }

        async function exportToPDF() {
            const locationName = document.getElementById('locationName').value || 'Fizibilite Raporu';
            
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                let yPosition = 20;
                
                // Başlık
                pdf.setFontSize(20);
                pdf.setTextColor(30, 60, 114);
                pdf.text('🅿️ PARKEXPERT FİZİBİLİTE RAPORU', pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 10;
                pdf.setFontSize(16);
                pdf.setTextColor(102, 126, 234);
                pdf.text(locationName, pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 8;
                pdf.setFontSize(10);
                pdf.setTextColor(108, 117, 125);
                pdf.text('Tarih: ' + new Date().toLocaleDateString('tr-TR', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }), pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 15;
                
                // Sonuçlar bölümünü yazdır
                const resultsElement = document.getElementById('results');
                if (resultsElement && resultsElement.style.display !== 'none') {
                    const canvas = await html2canvas(resultsElement, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const imgWidth = pageWidth - 20;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    // Yeni sayfa gerekiyorsa ekle
                    if (yPosition + imgHeight > pageHeight - 20) {
                        pdf.addPage();
                        yPosition = 20;
                    }
                    
                    pdf.addImage(imgData, 'JPEG', 10, yPosition, imgWidth, imgHeight);
                    yPosition += imgHeight + 10;
                }
                
                // Grafikleri ekle
                const chartsSection = document.getElementById('chartsSection');
                if (chartsSection && chartsSection.style.display !== 'none') {
                    pdf.addPage();
                    yPosition = 20;
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(30, 60, 114);
                    pdf.text('📊 Grafik Analizler', pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 15;
                    
                    const chartContainers = chartsSection.querySelectorAll('.chart-container');
                    
                    for (let i = 0; i < chartContainers.length; i++) {
                        const chartContainer = chartContainers[i];
                        
                        const canvas = await html2canvas(chartContainer, {
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff'
                        });
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        const imgWidth = (pageWidth - 30) / 2;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        const xPosition = (i % 2 === 0) ? 10 : pageWidth / 2 + 5;
                        
                        if (i % 2 === 0 && i > 0) {
                            yPosition += imgHeight + 10;
                        }
                        
                        if (yPosition + imgHeight > pageHeight - 20) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        
                        pdf.addImage(imgData, 'JPEG', xPosition, yPosition, imgWidth, imgHeight);
                        
                        if (i === chartContainers.length - 1 && i % 2 === 0) {
                            yPosition += imgHeight + 10;
                        }
                    }
                }
                
                // Yönetici raporunu ekle
                const managerReport = document.getElementById('managerReport');
                if (managerReport && managerReport.style.display !== 'none') {
                    pdf.addPage();
                    yPosition = 20;
                    
                    const canvas = await html2canvas(managerReport, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#667eea'
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const imgWidth = pageWidth - 20;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'JPEG', 10, yPosition, imgWidth, imgHeight);
                }
                
                // PDF'i kaydet
                const fileName = `Parkexpert_Fizibilite_${locationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);
                
                alert('✅ PDF dosyası başarıyla indirildi!');
            } catch (error) {
                console.error('PDF oluşturma hatası:', error);
                alert('❌ PDF oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
            }
        }

        // TEMPLATE SİSTEMİ
        const templates = {
            avm: {
                name: 'AVM - Alışveriş Merkezi',
                locationName: 'Olivium AVM Otopark',
                weekdayCapacity: 2000,
                devinim: 2.5,
                workingDays: 22,
                weekendDays: 8,
                staffMinWage: 4,
                staff25k: 2,
                staffManager: 1,
                investmentCost: 5000000,
                amortizationMonths: 60,
                operationalRate: 12,
                rentRate: 35,
                personelSubs: 150,
                personelPrice: 800,
                externalSubs: 50,
                externalPrice: 1200,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 40, usage: 85, parking: Math.round(2000 * 0.85) },
                    { hours: '12:00-18:00', tariff: 50, usage: 95, parking: Math.round(2000 * 0.95) },
                    { hours: '18:00-22:00', tariff: 45, usage: 90, parking: Math.round(2000 * 0.90) },
                    { hours: '22:00-08:00', tariff: 30, usage: 20, parking: Math.round(2000 * 0.20) }
                ]
            },
            plaza: {
                name: 'Plaza / Ofis Binası',
                locationName: 'Zorlu Plaza Otopark',
                weekdayCapacity: 800,
                devinim: 1.8,
                workingDays: 22,
                weekendDays: 8,
                staffMinWage: 2,
                staff25k: 1,
                staffManager: 1,
                investmentCost: 2000000,
                amortizationMonths: 48,
                operationalRate: 10,
                rentRate: 30,
                personelSubs: 300,
                personelPrice: 600,
                externalSubs: 20,
                externalPrice: 1000,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 35, usage: 95, parking: Math.round(800 * 0.95) },
                    { hours: '12:00-18:00', tariff: 40, usage: 90, parking: Math.round(800 * 0.90) },
                    { hours: '18:00-22:00', tariff: 30, usage: 40, parking: Math.round(800 * 0.40) },
                    { hours: '22:00-08:00', tariff: 20, usage: 10, parking: Math.round(800 * 0.10) }
                ]
            },
            hastane: {
                name: 'Hastane',
                locationName: 'Acıbadem Hastanesi Otopark',
                weekdayCapacity: 1200,
                devinim: 3.0,
                workingDays: 30,
                weekendDays: 0,
                staffMinWage: 6,
                staff25k: 2,
                staffManager: 1,
                investmentCost: 3000000,
                amortizationMonths: 60,
                operationalRate: 15,
                rentRate: 25,
                personelSubs: 200,
                personelPrice: 500,
                externalSubs: 0,
                externalPrice: 0,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 50, usage: 90, parking: Math.round(1200 * 0.90) },
                    { hours: '12:00-18:00', tariff: 55, usage: 85, parking: Math.round(1200 * 0.85) },
                    { hours: '18:00-22:00', tariff: 45, usage: 70, parking: Math.round(1200 * 0.70) },
                    { hours: '22:00-08:00', tariff: 35, usage: 40, parking: Math.round(1200 * 0.40) }
                ]
            },
            otel: {
                name: 'Otel',
                locationName: 'Hilton Otel Otopark',
                weekdayCapacity: 500,
                devinim: 1.2,
                workingDays: 30,
                weekendDays: 0,
                staffMinWage: 2,
                staff25k: 1,
                staffManager: 1,
                investmentCost: 1500000,
                amortizationMonths: 48,
                operationalRate: 12,
                rentRate: 20,
                personelSubs: 50,
                personelPrice: 0,
                externalSubs: 100,
                externalPrice: 1500,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 60, usage: 60, parking: Math.round(500 * 0.60) },
                    { hours: '12:00-18:00', tariff: 70, usage: 75, parking: Math.round(500 * 0.75) },
                    { hours: '18:00-22:00', tariff: 80, usage: 85, parking: Math.round(500 * 0.85) },
                    { hours: '22:00-08:00', tariff: 100, usage: 90, parking: Math.round(500 * 0.90) }
                ]
            },
            stadyum: {
                name: 'Stadyum / Etkinlik Alanı',
                locationName: 'Ülker Stadyumu Otopark',
                weekdayCapacity: 3000,
                devinim: 1.5,
                workingDays: 10,
                weekendDays: 8,
                staffMinWage: 10,
                staff25k: 3,
                staffManager: 2,
                investmentCost: 8000000,
                amortizationMonths: 72,
                operationalRate: 15,
                rentRate: 40,
                personelSubs: 50,
                personelPrice: 1000,
                externalSubs: 200,
                externalPrice: 2000,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 30, usage: 20, parking: Math.round(3000 * 0.20) },
                    { hours: '12:00-18:00', tariff: 100, usage: 95, parking: Math.round(3000 * 0.95) },
                    { hours: '18:00-22:00', tariff: 150, usage: 100, parking: Math.round(3000 * 1.00) },
                    { hours: '22:00-08:00', tariff: 50, usage: 80, parking: Math.round(3000 * 0.80) }
                ]
            }
        };

        function applyTemplate(templateKey) {
            if (templateKey === 'custom') {
                // Sıfırla
                document.getElementById('locationName').value = '';
                document.getElementById('weekdayCapacity').value = '1670';
                document.getElementById('devinim').value = '1.5';
                document.getElementById('workingDays').value = '22';
                document.getElementById('weekendDays').value = '8';
                document.getElementById('staffMinWage').value = '0';
                document.getElementById('staff25k').value = '0';
                document.getElementById('staffManager').value = '0';
                calculateTotalStaffCost();
                calculateWeekendCapacity();
                alert('✅ Form sıfırlandı. Kendi değerlerinizi girebilirsiniz.');
                return;
            }

            const template = templates[templateKey];
            if (!template) return;

            // Form alanlarını doldur
            document.getElementById('locationName').value = template.locationName;
            document.getElementById('weekdayCapacity').value = template.weekdayCapacity;
            document.getElementById('devinim').value = template.devinim;
            document.getElementById('workingDays').value = template.workingDays;
            document.getElementById('weekendDays').value = template.weekendDays;
            
            // Personel
            document.getElementById('staffMinWage').value = template.staffMinWage;
            document.getElementById('staff25k').value = template.staff25k;
            document.getElementById('staffManager').value = template.staffManager;
            
            // Maliyetler
            document.getElementById('investmentCost').value = template.investmentCost;
            document.getElementById('amortizationMonths').value = template.amortizationMonths;
            document.getElementById('operationalRate').value = template.operationalRate;
            document.getElementById('rentRate').value = template.rentRate;
            
            // Abonelikler
            document.getElementById('personelSubs').value = template.personelSubs;
            document.getElementById('personelPrice').value = template.personelPrice;
            document.getElementById('externalSubs').value = template.externalSubs;
            document.getElementById('externalPrice').value = template.externalPrice;
            
            // Hafta içi tarifeler
            template.weekdaySlots.forEach((slot, index) => {
                document.getElementById(`weekdayTariff${index + 1}`).value = slot.tariff;
                document.getElementById(`weekdayUsage${index + 1}`).value = slot.usage;
            });
            
            // Hesaplamaları tetikle
            calculateTotalStaffCost();
            calculateWeekendCapacity();
            
            alert(`✅ ${template.name} şablonu yüklendi!\n\nVerileri inceleyip ihtiyacınıza göre düzenleyebilirsiniz.`);
            
            // Başarım
            unlockAchievement('template_user');
            
            // Scroll to form
            document.querySelector('.section').scrollIntoView({ behavior: 'smooth' });
        }

        // PARA BİRİMİ YÖNETİMİ
        function toggleCurrencyMenu() {
            const menu = document.getElementById('currencyMenu');
            menu.classList.toggle('active');
        }

        function changeCurrency(code, symbol) {
            currentCurrency = code;
            currentCurrencySymbol = symbol;
            
            // UI'ı güncelle
            document.getElementById('currentCurrencyCode').textContent = code;
            document.getElementById('currentCurrencySymbol').textContent = symbol;
            
            // Aktif butonu işaretle
            document.querySelectorAll('.currency-option-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(code)) {
                    btn.classList.add('active');
                }
            });
            
            // Menüyü kapat
            document.getElementById('currencyMenu').classList.remove('active');
            
            // Eğer sonuçlar varsa yeniden formatla
            if (document.getElementById('results').style.display !== 'none') {
                updateCurrencyDisplay();
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem('parkexpert-currency', code);
            
            // Animasyon
            const badge = document.getElementById('currencyBadge');
            badge.style.animation = 'pulse 0.5s ease-out';
            setTimeout(() => {
                badge.style.animation = '';
            }, 500);
        }

        function updateCurrencyDisplay() {
            const rate = exchangeRates[currentCurrency];
            
            // Tüm sonuç kartlarını güncelle
            document.querySelectorAll('.result-card .value').forEach(el => {
                const originalText = el.textContent;
                const numbers = originalText.match(/[\d.,]+/g);
                
                if (numbers) {
                    numbers.forEach(num => {
                        const value = parseFloat(num.replace(/\./g, '').replace(',', '.'));
                        if (!isNaN(value)) {
                            const converted = value / rate;
                            const formatted = new Intl.NumberFormat('tr-TR', {
                                minimumFractionDigits: 0,
                                maximumFractionDigits: 0
                            }).format(converted);
                            el.textContent = originalText.replace(num, formatted).replace('₺', currentCurrencySymbol);
                        }
                    });
                }
            });
        }

        // NOTLAR YÖNETİMİ
        function saveNotes() {
            const notes = document.getElementById('calculationNotes').value;
            const locationName = document.getElementById('locationName').value || 'Genel';
            
            // LocalStorage'a kaydet
            const notesData = JSON.parse(localStorage.getItem('parkexpert-notes') || '{}');
            notesData[locationName] = {
                notes: notes,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };
            localStorage.setItem('parkexpert-notes', JSON.stringify(notesData));
            
            // Başarı mesajı
            showToast('✅ Notlar kaydedildi!', 'success');
        }

        function loadNotes(locationName) {
            const notesData = JSON.parse(localStorage.getItem('parkexpert-notes') || '{}');
            if (notesData[locationName]) {
                document.getElementById('calculationNotes').value = notesData[locationName].notes;
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 9999;
                animation: slideInUp 0.3s ease-out;
                font-weight: 600;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInUp 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // MULTI-USER SYSTEM
        let currentUser = null;

        function initUserSystem() {
            // Kullanıcıları yükle veya default oluştur
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            
            // Eğer hiç kullanıcı yoksa, demo admin ekle
            if (users.length === 0) {
                const demoAdmin = {
                    id: 'admin-' + Date.now(),
                    name: 'Demo Admin',
                    email: 'admin@parkexpert.com',
                    password: hashPassword('admin123'),
                    role: 'admin',
                    company: 'Parkexpert Demo',
                    createdAt: new Date().toISOString()
                };
                users.push(demoAdmin);
                localStorage.setItem('parkexpert-users', JSON.stringify(users));
            }
            
            // Session'ı kontrol et
            const sessionUser = localStorage.getItem('parkexpert-session');
            if (sessionUser) {
                currentUser = JSON.parse(sessionUser);
                updateUserUI();
                document.getElementById('loginModal').classList.add('hidden');
            } else {
                // Login modal'ı göster
                document.getElementById('loginModal').classList.remove('hidden');
            }
        }

        function hashPassword(password) {
            // Basit hash (production'da bcrypt kullanılmalı)
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        function switchLoginTab(tab) {
            return; // Artık sadece login
        }

        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('⚠️ Email ve şifre gerekli!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const user = users.find(u => u.email === email && u.password === hashPassword(password));
            
            if (user) {
                currentUser = {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role,
                    company: user.company
                };
                
                localStorage.setItem('parkexpert-session', JSON.stringify(currentUser));
                document.getElementById('loginModal').classList.add('hidden');
                updateUserUI();
                showToast(`✅ Hoşgeldin ${user.name}!`, 'success');
                
                if (user.role === 'admin') {
                    document.getElementById('adminPanelBtn').style.display = 'flex';
                }
            } else {
                showToast('❌ Email veya şifre hatalı!', 'error');
            }
        }

        // ADMIN PANEL
        function openAdminPanel() {
            if (currentUser.role !== 'admin') {
                showToast('⚠️ Sadece admin!', 'error');
                return;
            }
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('adminPanelOverlay').classList.add('active');
            toggleUserDropdown();
            loadUsersList();
            updateAdminStats();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('adminPanelOverlay').classList.remove('active');
        }

        function switchAdminTab(tab) {
            document.getElementById('adminUsersTab').classList.toggle('active', tab === 'users');
            document.getElementById('adminAddTab').classList.toggle('active', tab === 'add');
            document.getElementById('adminSettingsTab').classList.toggle('active', tab === 'settings');
            document.getElementById('adminUsersSection').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('adminAddSection').style.display = tab === 'add' ? 'block' : 'none';
            document.getElementById('adminSettingsSection').style.display = tab === 'settings' ? 'block' : 'none';
        }

        function loadUsersList() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const listHTML = users.map(user => `
                <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <div style="font-weight: 700;">${user.role === 'admin' ? '👑' : user.role === 'manager' ? '👨‍💼' : '👁️'} ${user.name}</div>
                            <div style="font-size: 12px; color: #6c757d;">📧 ${user.email} | 🏢 ${user.company}</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editUser('${user.id}')" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">✏️</button>
                            ${user.id !== currentUser.id ? `<button onclick="deleteUser('${user.id}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">🗑️</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('usersList').innerHTML = listHTML;
        }

        function generatePassword() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789!@#$%&*';
            let pwd = '';
            for (let i = 0; i < 12; i++) pwd += chars.charAt(Math.floor(Math.random() * chars.length));
            document.getElementById('newUserPassword').value = pwd;
            showToast('🎲 Şifre: ' + pwd, 'success');
        }

        function createUser() {
            const name = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const company = document.getElementById('newUserCompany').value.trim() || 'Parkexpert';
            const role = document.getElementById('newUserRole').value;
            
            if (!name || !email || !password) {
                showToast('⚠️ Tüm alanlar gerekli!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            if (users.some(u => u.email === email)) {
                showToast('⚠️ Email kayıtlı!', 'error');
                return;
            }
            
            users.push({
                id: 'user-' + Date.now(),
                name, email,
                password: hashPassword(password),
                role, company,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('parkexpert-users', JSON.stringify(users));
            
            alert(`✅ KULLANICI OLUŞTURULDU!\n\n👤 ${name}\n📧 ${email}\n🔒 ${password}\n👔 ${role}\n\nBu bilgileri kullanıcıya ilet!`);
            
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserEmail').value = '';
            document.getElementById('newUserPassword').value = '';
            switchAdminTab('users');
            loadUsersList();
        }

        function editUser(userId) {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const user = users.find(u => u.id === userId);
            const newRole = prompt(`Yeni rol? (viewer/manager/admin)\nŞu an: ${user.role}`, user.role);
            if (newRole && ['viewer', 'manager', 'admin'].includes(newRole)) {
                user.role = newRole;
                localStorage.setItem('parkexpert-users', JSON.stringify(users));
                loadUsersList();
                showToast('✅ Rol güncellendi!', 'success');
            }
        }

        function deleteUser(userId) {
            if (!confirm('Silmek emin misin?')) return;
            let users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            users = users.filter(u => u.id !== userId);
            localStorage.setItem('parkexpert-users', JSON.stringify(users));
            loadUsersList();
            showToast('✅ Silindi!', 'success');
        }

        function toggleGuestMode() {
            localStorage.setItem('parkexpert-guest-mode', document.getElementById('allowGuestMode').checked);
        }

        function toggleApproval() {
            localStorage.setItem('parkexpert-require-approval', document.getElementById('requireApproval').checked);
        }

        function updateAdminStats() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const calcs = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            document.getElementById('adminStats').innerHTML = `
                Kullanıcı: ${users.length} (Admin: ${users.filter(u => u.role === 'admin').length}, Manager: ${users.filter(u => u.role === 'manager').length}, Viewer: ${users.filter(u => u.role === 'viewer').length})<br>
                Hesaplama: ${calcs.length}<br>
                Son Giriş: ${new Date().toLocaleString('tr-TR')}
            `;
        }

        function continueAsGuest() {
            currentUser = {
                id: 'guest-' + Date.now(),
                name: 'Misafir',
                email: 'guest@parkexpert.com',
                role: 'viewer',
                company: 'Misafir'
            };
            
            localStorage.setItem('parkexpert-session', JSON.stringify(currentUser));
            document.getElementById('loginModal').classList.add('hidden');
            updateUserUI();
            showToast('👤 Misafir olarak devam ediyorsunuz', 'success');
        }

        function updateUserUI() {
            if (!currentUser) return;
            
            // Avatar initials
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userInitials').textContent = initials;
            
            // User info
            document.getElementById('currentUserName').textContent = currentUser.name;
            
            // Role badge
            const roleBadge = document.getElementById('currentUserRole');
            roleBadge.className = `user-role ${currentUser.role}`;
            roleBadge.textContent = {
                'admin': '👑 Admin',
                'manager': '👨‍💼 Manager',
                'viewer': '👁️ Viewer'
            }[currentUser.role];
            
            // Role-based UI restrictions
            applyRoleRestrictions();
        }

        function applyRoleRestrictions() {
            if (!currentUser) return;
            
            const isViewer = currentUser.role === 'viewer';
            const isGuest = currentUser.id.startsWith('guest-');
            
            if (isViewer || isGuest) {
                // Viewer'lar için kısıtlamalar
                // Kaydetme butonu gizle
                const saveButtons = document.querySelectorAll('.save-load-btn, .scenario-btn.save');
                saveButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.onclick = () => showToast('⚠️ Düzenleme yetkiniz yok!', 'error');
                });
            }
        }

        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('active');
        }

        function showUserProfile() {
            const profile = `
👤 PROFİL BİLGİLERİ

📛 Ad: ${currentUser.name}
📧 Email: ${currentUser.email}
👔 Rol: ${currentUser.role}
🏢 Şirket: ${currentUser.company}
🆔 ID: ${currentUser.id}
            `.trim();
            
            alert(profile);
            toggleUserDropdown();
        }

        function showTeamMembers() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            
            if (currentUser.role !== 'admin') {
                showToast('⚠️ Sadece admin görebilir!', 'error');
                return;
            }
            
            let message = '👥 EKIP ÜYELERİ\n\n';
            users.forEach((user, index) => {
                message += `${index + 1}. ${user.name}\n`;
                message += `   📧 ${user.email}\n`;
                message += `   👔 ${user.role}\n`;
                message += `   🏢 ${user.company}\n\n`;
            });
            
            alert(message);
            toggleUserDropdown();
        }

        function showSettings() {
            alert('⚙️ AYARLAR\n\nYakında eklenecek...');
            toggleUserDropdown();
        }

        function logout() {
            if (confirm('🚪 Çıkış yapmak istediğinizden emin misiniz?')) {
                localStorage.removeItem('parkexpert-session');
                currentUser = null;
                location.reload();
            }
        }

        // Sayfa dışına tıklayınca dropdown'ları kapat
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('active');
            }
        });

        // GAMİFİCATION SİSTEMİ
        const achievements = [
            { id: 'first_calc', icon: '🎯', title: 'İlk Hesaplama', desc: 'İlk fizibilite hesaplamanı yaptın!', unlocked: false },
            { id: 'profitable', icon: '💰', title: 'Karlı İşletme', desc: 'Pozitif karlılık elde ettin!', unlocked: false },
            { id: 'scenario_master', icon: '⚖️', title: 'Senaryo Ustası', desc: '2 senaryoyu karşılaştırdın!', unlocked: false },
            { id: 'saver', icon: '💾', title: 'Kayıtçı', desc: '5 hesaplama kaydettin!', unlocked: false },
            { id: 'template_user', icon: '💼', title: 'Şablon Kullanıcısı', desc: 'Hazır şablon kullandın!', unlocked: false },
            { id: 'exporter', icon: '📊', title: 'Veri Ustası', desc: 'Excel veya PDF export yaptın!', unlocked: false },
            { id: 'theme_changer', icon: '🎨', title: 'Stil Sahibi', desc: 'Temayı değiştirdin!', unlocked: false },
            { id: 'multilingual', icon: '🌍', title: 'Poliglot', desc: 'Dil değiştirdin!', unlocked: false },
            { id: 'power_user', icon: '⚡', title: 'Pro Kullanıcı', desc: '10 hesaplama yaptın!', unlocked: false },
            { id: 'perfect_score', icon: '🏆', title: 'Mükemmellik', desc: '90+ karlılık skoru aldın!', unlocked: false }
        ];

        function loadAchievements() {
            const saved = localStorage.getItem('parkexpert-achievements');
            if (saved) {
                const unlocked = JSON.parse(saved);
                achievements.forEach(ach => {
                    if (unlocked.includes(ach.id)) {
                        ach.unlocked = true;
                    }
                });
            }
            updateAchievementsList();
        }

        function unlockAchievement(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                
                // LocalStorage'a kaydet
                const unlocked = achievements.filter(a => a.unlocked).map(a => a.id);
                localStorage.setItem('parkexpert-achievements', JSON.stringify(unlocked));
                
                // Popup göster
                showAchievementPopup(achievement);
                
                // Konfeti efekti
                createConfetti();
                
                // Listeyi güncelle
                updateAchievementsList();
            }
        }

        function showAchievementPopup(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">${achievement.title}</div>
                <div class="achievement-desc">${achievement.desc}</div>
            `;
            document.body.appendChild(popup);
            
            setTimeout(() => {
                popup.style.animation = 'slideInUp 0.5s ease-out reverse';
                setTimeout(() => popup.remove(), 500);
            }, 4000);
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#FFD700', '#FFA500', '#FF6B6B'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    top: ${Math.random() * 100}%;
                    left: ${Math.random() * 100}%;
                    animation: confetti ${1 + Math.random()}s ease-out forwards;
                    z-index: 10000;
                    border-radius: 50%;
                `;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        function toggleAchievements() {
            document.getElementById('achievementsPanel').classList.toggle('active');
        }

        function updateAchievementsList() {
            const list = document.getElementById('achievementsList');
            list.innerHTML = achievements.map(ach => `
                <div class="achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}">
                    <div style="font-size: 32px;">${ach.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: #1e3c72;">${ach.title}</div>
                        <div style="font-size: 12px; color: #6c757d;">${ach.desc}</div>
                    </div>
                    ${ach.unlocked ? '<div style="color: #28a745; font-size: 24px;">✓</div>' : '<div style="color: #6c757d; font-size: 24px;">🔒</div>'}
                </div>
            `).join('');
        }

        // CHATBOT SİSTEMİ
        function toggleChatbot() {
            document.getElementById('chatbotWindow').classList.toggle('active');
        }

        function askChatbot(question) {
            const messagesDiv = document.getElementById('chatbotMessages');
            
            // Kullanıcı mesajını ekle
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = getQuestionText(question);
            messagesDiv.appendChild(userMsg);
            
            // Bot cevabını ekle
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'chat-message bot';
                botMsg.innerHTML = getBotResponse(question);
                messagesDiv.appendChild(botMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getQuestionText(type) {
            const questions = {
                'nasıl': 'Aracı nasıl kullanırım?',
                'öneri': 'Bana öneri verir misin?',
                'şablon': 'Hangi şablonu kullanmalıyım?',
                'karlılık': 'Karlılığı nasıl artırırım?'
            };
            return questions[type] || type;
        }

        function getBotResponse(question) {
            const responses = {
                'nasıl': `
                    <strong>Kullanım Adımları:</strong><br>
                    1️⃣ Yukarıdan bir şablon seç (AVM, Plaza, vb.)<br>
                    2️⃣ Veya manuel olarak bilgileri gir<br>
                    3️⃣ "Fizibilite Hesapla" butonuna tıkla<br>
                    4️⃣ Sonuçları incele ve export et!<br><br>
                    💡 İpucu: Senaryo karşılaştırması için 2 farklı hesaplama yap!
                `,
                'öneri': `
                    <strong>Akıllı Öneriler:</strong><br>
                    📊 Hesaplama yaptıktan sonra "Akıllı Öneriler" bölümünde:<br>
                    • Personel optimizasyonu<br>
                    • Kira önerileri<br>
                    • Kapasite kullanımı<br>
                    • Karlılık artırma stratejileri bulabilirsin!
                `,
                'şablon': `
                    <strong>Şablon Seçimi:</strong><br>
                    🏬 <strong>AVM:</strong> Yüksek trafik, hafta sonu yoğun<br>
                    🏢 <strong>Plaza:</strong> Hafta içi yoğun, abonelik odaklı<br>
                    🏥 <strong>Hastane:</strong> 7/24 aktif, yüksek devir<br>
                    🏨 <strong>Otel:</strong> Gece saatleri yoğun<br>
                    🏟️ <strong>Stadyum:</strong> Etkinlik bazlı, yüksek kapasite<br><br>
                    💡 İhtiyacına en yakın olanı seç!
                `,
                'karlılık': `
                    <strong>Karlılık Artırma İpuçları:</strong><br>
                    💰 Devrinim oranını artır (günlük park başına daha fazla araç)<br>
                    👥 Personel sayısını optimize et<br>
                    📈 Yoğun saatlerde tarife artır<br>
                    🔄 Abonelik sistemini genişlet<br>
                    ⚙️ Operasyonel giderleri azalt<br>
                    🏢 Kira oranını %35'in altında tut<br><br>
                    📊 Akıllı önerilere bak!
                `
            };
            return responses[question] || 'Size nasıl yardımcı olabilirim? Yukarıdaki hızlı yanıt butonlarından birini seçebilirsiniz.';
        }

        function checkAchievements(netProfit, profitabilityScore) {
            // İlk hesaplama
            const calcCount = parseInt(localStorage.getItem('parkexpert-calc-count') || '0') + 1;
            localStorage.setItem('parkexpert-calc-count', calcCount);
            
            if (calcCount === 1) {
                unlockAchievement('first_calc');
            }
            
            if (calcCount >= 10) {
                unlockAchievement('power_user');
            }
            
            // Karlı işletme
            if (netProfit > 0) {
                unlockAchievement('profitable');
            }
            
            // Mükemmel skor
            if (profitabilityScore >= 90) {
                unlockAchievement('perfect_score');
            }
        }

        // SCREENSHOT FONKSİYONU
        async function takeScreenshot() {
            try {
                showToast('📸 Screenshot alınıyor...', 'success');
                
                const element = document.querySelector('.container');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                // PNG olarak indir
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Parkexpert_Screenshot_${new Date().toISOString().split('T')[0]}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                });
                
                showToast('✅ Screenshot indirildi!', 'success');
                unlockAchievement('exporter');
            } catch (error) {
                showToast('❌ Screenshot alınamadı', 'error');
            }
        }

        // FİNANSMAN HESAPLAYICI
        function openFinancing() {
            document.getElementById('financingModal').classList.add('active');
            document.getElementById('modalOverlay').classList.add('active');
            
            // Yatırım tutarını doldur
            const investCost = document.getElementById('investmentCost').value;
            if (investCost) {
                document.getElementById('loanAmount').value = investCost;
            }
        }

        function calculateLoan() {
            const principal = parseFloat(document.getElementById('loanAmount').value) || 0;
            const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const termMonths = parseInt(document.getElementById('loanTerm').value) || 0;
            
            if (principal === 0 || termMonths === 0) {
                alert('⚠️ Lütfen tüm alanları doldurun!');
                return;
            }
            
            // Aylık faiz oranı
            const monthlyRate = (annualRate / 100) / 12;
            
            // Aylık taksit hesaplama (eşit taksit formülü)
            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, termMonths)) / 
                                   (Math.pow(1 + monthlyRate, termMonths) - 1);
            
            const totalPayment = monthlyPayment * termMonths;
            const totalInterest = totalPayment - principal;
            
            // Sonuçları göster
            const resultsDiv = document.getElementById('loanResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">Aylık Taksit</div>
                    <div style="font-size: 32px; font-weight: 700; color: #667eea;">${formatCurrency(monthlyPayment)}</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #6c757d;">Toplam Ödeme</div>
                        <div style="font-size: 18px; font-weight: 600; color: #1e3c72;">${formatCurrency(totalPayment)}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #6c757d;">Toplam Faiz</div>
                        <div style="font-size: 18px; font-weight: 600; color: #dc3545;">${formatCurrency(totalInterest)}</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #667eea;">
                    <strong>💡 Finansman Önerisi:</strong><br>
                    ${monthlyPayment > 0 && totalPayment > 0 ? `
                        • Aylık ödemeniz hasılatınızın <strong>%${((monthlyPayment / (document.getElementById('results').style.display !== 'none' ? parseFloat(document.querySelector('.result-card-large .value')?.textContent.replace(/[^\d]/g, '') || 1000000) : 1000000)) * 100).toFixed(1)}</strong>'ini oluşturuyor.<br>
                        • ${monthlyPayment < 100000 ? '✅ Makul bir ödeme planı.' : '⚠️ Yüksek ödeme - vadeyi uzatmayı düşünün.'}<br>
                        • Faiz oranı: <strong>%${annualRate}</strong> ${annualRate < 3 ? '(İyi)' : annualRate < 5 ? '(Orta)' : '(Yüksek)'}
                    ` : ''}
                </div>
            `;
        }

        // HEDEF BELIRLEME
        function openGoalSetting() {
            const currentProfit = document.getElementById('results').style.display !== 'none' 
                ? parseFloat(document.querySelector('.result-card-large .value')?.textContent.replace(/[^\d,-]/g, '').replace(',', '.') || 0)
                : 0;
            
            const goal = prompt(`🎯 Aylık Kar Hedefiniz?\n\n${currentProfit > 0 ? `Şu anki karınız: ${formatCurrency(currentProfit)}` : 'Önce hesaplama yapmalısınız!'}\n\nHedef tutarı girin (₺):`);
            
            if (goal) {
                const targetProfit = parseFloat(goal);
                if (currentProfit > 0) {
                    const difference = targetProfit - currentProfit;
                    const percentChange = ((difference / currentProfit) * 100).toFixed(1);
                    
                    let message = `🎯 **HEDEF BELİRLENDİ**\n\n`;
                    message += `📊 Mevcut Kar: ${formatCurrency(currentProfit)}\n`;
                    message += `🎯 Hedef Kar: ${formatCurrency(targetProfit)}\n`;
                    message += `📈 Fark: ${formatCurrency(Math.abs(difference))} (${percentChange}%)\n\n`;
                    
                    if (difference > 0) {
                        message += `💡 **Hedefe Ulaşmak İçin:**\n`;
                        message += `• Devrinimi ${(1.5 * (1 + difference / currentProfit / 2)).toFixed(1)}'e çıkar\n`;
                        message += `• Veya tarifeleri %${(difference / currentProfit * 50).toFixed(0)} artır\n`;
                        message += `• Veya giderleri %${(difference / currentProfit * 30).toFixed(0)} azalt`;
                    } else {
                        message += `✅ Hedefinizi şu an aşıyorsunuz! Tebrikler! 🎉`;
                    }
                    
                    alert(message);
                    
                    // LocalStorage'a kaydet
                    localStorage.setItem('parkexpert-goal', JSON.stringify({
                        target: targetProfit,
                        current: currentProfit,
                        date: new Date().toISOString()
                    }));
                } else {
                    alert('⚠️ Önce bir hesaplama yapmalısınız!');
                }
            }
        }

        // HATIRLATICI SİSTEMİ
        function setReminder() {
            const message = prompt('🔔 Hatırlatıcı Mesajı:\n\nÖrnek: "Aylık raporu kontrol et"');
            
            if (message) {
                const days = prompt('📅 Kaç gün sonra hatırlatsın?\n\n(Örn: 7 = 1 hafta sonra)');
                
                if (days) {
                    const reminderDate = new Date();
                    reminderDate.setDate(reminderDate.getDate() + parseInt(days));
                    
                    const reminder = {
                        message: message,
                        date: reminderDate.toISOString(),
                        created: new Date().toISOString()
                    };
                    
                    // LocalStorage'a kaydet
                    const reminders = JSON.parse(localStorage.getItem('parkexpert-reminders') || '[]');
                    reminders.push(reminder);
                    localStorage.setItem('parkexpert-reminders', JSON.stringify(reminders));
                    
                    alert(`✅ Hatırlatıcı ayarlandı!\n\n📅 ${reminderDate.toLocaleDateString('tr-TR')}\n💬 ${message}`);
                }
            }
        }

        function checkReminders() {
            const reminders = JSON.parse(localStorage.getItem('parkexpert-reminders') || '[]');
            const now = new Date();
            
            reminders.forEach((reminder, index) => {
                const reminderDate = new Date(reminder.date);
                if (reminderDate <= now) {
                    showToast(`🔔 Hatırlatma: ${reminder.message}`, 'success');
                    
                    // Gösterilen hatırlatıcıyı sil
                    reminders.splice(index, 1);
                    localStorage.setItem('parkexpert-reminders', JSON.stringify(reminders));
                }
            });
        }

        function closeAllModals() {
            document.querySelectorAll('.modal, .financing-modal').forEach(modal => {
                modal.classList.remove('active');
            });
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // PAYLAŞIM FONKSİYONLARI
        function generateReportSummary() {
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const resultsDiv = document.getElementById('results');
            
            if (resultsDiv.style.display === 'none') {
                return null;
            }
            
            // Sonuçları çek
            const resultCards = document.querySelectorAll('.result-card');
            let summary = `🅿️ PARKEXPERT FİZİBİLİTE RAPORU\n`;
            summary += `📍 Lokasyon: ${locationName}\n`;
            summary += `📅 Tarih: ${new Date().toLocaleDateString('tr-TR')}\n\n`;
            summary += `📊 SONUÇLAR:\n`;
            
            resultCards.forEach(card => {
                const title = card.querySelector('h3')?.textContent || '';
                const value = card.querySelector('.value')?.textContent || '';
                if (title && value) {
                    summary += `• ${title}: ${value}\n`;
                }
            });
            
            return summary;
        }

        function shareViaWhatsApp() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const text = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            const url = `https://wa.me/?text=${text}`;
            window.open(url, '_blank');
        }

        function shareViaEmail() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const subject = encodeURIComponent(`Parkexpert Fizibilite Raporu - ${locationName}`);
            const body = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function shareViaTelegram() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const text = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            const url = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${text}`;
            window.open(url, '_blank');
        }

        function copyReportLink() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            // Özet metni panoya kopyala
            navigator.clipboard.writeText(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href)
                .then(() => {
                    alert('✅ Rapor özeti panoya kopyalandı!');
                })
                .catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = summary;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('✅ Rapor özeti panoya kopyalandı!');
                });
        }

        // Modal dışına tıklayınca kapat
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // SENARYO YÖNETİMİ FONKSİYONLARI
        function switchScenario(scenario) {
            currentScenario = scenario;
            
            // Tab görünümlerini güncelle
            document.getElementById('tabA').classList.toggle('active', scenario === 'A');
            document.getElementById('tabB').classList.toggle('active', scenario === 'B');
            
            // İndikatörü güncelle
            document.getElementById('scenarioIndicator').textContent = `📊 Aktif: Senaryo ${scenario}`;
            
            // Eğer kaydedilmiş senaryo varsa yükle
            const savedScenario = scenario === 'A' ? scenarioA : scenarioB;
            if (savedScenario) {
                setAllFormData(savedScenario);
                
                // Eğer sonuçlar varsa göster
                const savedResults = scenario === 'A' ? scenarioAResults : scenarioBResults;
                if (savedResults) {
                    // Sonuçları yeniden göster (calculate'i tekrar çağırmadan)
                    document.getElementById('results').style.display = 'block';
                }
            } else {
                // Yeni senaryo için formu temizle
                clearFormForNewScenario();
            }
        }

        function saveCurrentScenario() {
            const data = getAllFormData();
            const locationName = document.getElementById('locationName').value || 'İsimsiz Senaryo';
            
            if (currentScenario === 'A') {
                scenarioA = data;
                alert(`✅ Senaryo A kaydedildi: ${locationName}`);
            } else {
                scenarioB = data;
                alert(`✅ Senaryo B kaydedildi: ${locationName}`);
            }
            
            // Hesaplama yapılmışsa sonuçları da kaydet
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display !== 'none') {
                // Sonuçları kaydet (basitleştirilmiş)
                const results = extractCurrentResults();
                if (currentScenario === 'A') {
                    scenarioAResults = results;
                } else {
                    scenarioBResults = results;
                }
            }
        }

        function clearScenario() {
            if (!confirm(`Senaryo ${currentScenario}'yı temizlemek istediğinizden emin misiniz?`)) {
                return;
            }
            
            if (currentScenario === 'A') {
                scenarioA = null;
                scenarioAResults = null;
            } else {
                scenarioB = null;
                scenarioBResults = null;
            }
            
            clearFormForNewScenario();
            alert(`✅ Senaryo ${currentScenario} temizlendi!`);
        }

        function clearFormForNewScenario() {
            // Formu default değerlere döndür
            document.getElementById('locationName').value = '';
            document.getElementById('weekdayCapacity').value = '1670';
            document.getElementById('weekendCapacity').value = '2505';
            document.getElementById('devinim').value = '1.5';
            document.getElementById('workingDays').value = '22';
            document.getElementById('weekendDays').value = '8';
            document.getElementById('workingMonths').value = '12';
            
            // Personel
            document.getElementById('staffMinWage').value = '0';
            document.getElementById('staff25k').value = '0';
            document.getElementById('staffManager').value = '0';
            
            // Sonuçları gizle
            document.getElementById('results').style.display = 'none';
            document.getElementById('chartsSection').style.display = 'none';
            document.getElementById('managerReport').style.display = 'none';
            
            calculateTotalStaffCost();
            calculateWeekendCapacity();
        }

        function extractCurrentResults() {
            // Mevcut sonuçları çıkar
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            
            // Result grid'den değerleri çek
            const resultCards = document.querySelectorAll('.result-card');
            const results = {
                locationName: locationName,
                values: {}
            };
            
            resultCards.forEach(card => {
                const title = card.querySelector('h3')?.textContent || '';
                const value = card.querySelector('.value')?.textContent || '';
                results.values[title] = value;
            });
            
            return results;
        }

        function compareScenarios() {
            if (!scenarioA || !scenarioB) {
                alert('⚠️ Her iki senaryoyu da kaydetmeniz gerekiyor!\n\n1. Senaryo A\'yı doldurun ve "Bu Senaryoyu Kaydet" tıklayın\n2. Senaryo B\'ye geçin\n3. Senaryo B\'yi doldurun ve kaydedin\n4. Tekrar "Senaryoları Karşılaştır" tıklayın');
                return;
            }
            
            if (!scenarioAResults || !scenarioBResults) {
                alert('⚠️ Her iki senaryo için de hesaplama yapmanız gerekiyor!\n\nHer senaryo için "Fizibilite Hesapla" butonuna tıklayın.');
                return;
            }
            
            // Karşılaştırma tablosu oluştur
            createComparisonTable();
            
            // Karşılaştırma sonuçlarına scroll
            document.getElementById('comparisonResults').style.display = 'block';
            document.getElementById('comparisonResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Başarım
            unlockAchievement('scenario_master');
        }

        function createComparisonTable() {
            const resultsA = scenarioAResults.values;
            const resultsB = scenarioBResults.values;
            
            // Net karı bul (string'den sayıya çevir)
            const netProfitA = parseFloat(resultsA['Net Kar']?.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            const netProfitB = parseFloat(resultsB['Net Kar']?.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            
            const winner = netProfitA > netProfitB ? 'A' : (netProfitB > netProfitA ? 'B' : 'Eşit');
            
            // Winner badge
            const winnerBadge = document.getElementById('winnerBadge');
            if (winner !== 'Eşit') {
                winnerBadge.innerHTML = `<div class="winner-badge">🏆 KAZANAN: SENARYO ${winner}</div>`;
            } else {
                winnerBadge.innerHTML = `<div class="winner-badge" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">⚖️ SENARYOLAR EŞİT</div>`;
            }
            
            // Senaryo bilgileri
            const scenarioInfoHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="scenario-info-box">
                        <h3>📊 Senaryo A</h3>
                        <p><strong>Lokasyon:</strong> ${scenarioAResults.locationName}</p>
                        <p><strong>Hafta İçi Kapasite:</strong> ${scenarioA.weekdayCapacity}</p>
                        <p><strong>Hafta Sonu Kapasite:</strong> ${scenarioA.weekendCapacity}</p>
                    </div>
                    <div class="scenario-info-box">
                        <h3>📊 Senaryo B</h3>
                        <p><strong>Lokasyon:</strong> ${scenarioBResults.locationName}</p>
                        <p><strong>Hafta İçi Kapasite:</strong> ${scenarioB.weekdayCapacity}</p>
                        <p><strong>Hafta Sonu Kapasite:</strong> ${scenarioB.weekendCapacity}</p>
                    </div>
                </div>
            `;
            
            // Karşılaştırma tablosu
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th class="metric-name">Metrik</th>
                            <th>Senaryo A</th>
                            <th>Senaryo B</th>
                            <th>Fark</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Tüm metrikleri karşılaştır
            const allMetrics = new Set([...Object.keys(resultsA), ...Object.keys(resultsB)]);
            
            allMetrics.forEach(metric => {
                const valueA = resultsA[metric] || '-';
                const valueB = resultsB[metric] || '-';
                
                // Sayısal değerleri karşılaştır
                const numA = parseFloat(valueA.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
                const numB = parseFloat(valueB.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
                
                let classA = '';
                let classB = '';
                let diff = '-';
                
                if (numA !== 0 && numB !== 0) {
                    if (metric.includes('Gider') || metric.includes('Maliyet')) {
                        // Giderler için düşük olanı yeşil
                        classA = numA < numB ? 'better' : (numA > numB ? 'worse' : '');
                        classB = numB < numA ? 'better' : (numB > numA ? 'worse' : '');
                    } else {
                        // Gelir/Kar için yüksek olanı yeşil
                        classA = numA > numB ? 'better' : (numA < numB ? 'worse' : '');
                        classB = numB > numA ? 'better' : (numB < numA ? 'worse' : '');
                    }
                    
                    const difference = Math.abs(numA - numB);
                    const percentage = ((difference / Math.max(numA, numB)) * 100).toFixed(1);
                    diff = `${new Intl.NumberFormat('tr-TR').format(difference)} ₺ (${percentage}%)`;
                }
                
                tableHTML += `
                    <tr>
                        <td class="metric-name">${metric}</td>
                        <td class="${classA}">${valueA}</td>
                        <td class="${classB}">${valueB}</td>
                        <td>${diff}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            document.getElementById('comparisonContent').innerHTML = scenarioInfoHTML + tableHTML;
        }

        // Enter tuşu ile hesaplama
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculate();
            }
        });
    </script>

    <!-- Kayıtlı Hesaplamalar Modal -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📂 Kayıtlı Hesaplamalar</h2>
                <button class="close-modal" onclick="closeLoadModal()">&times;</button>
            </div>
            <div class="modal-body" id="savedCalculationsList">
                <!-- Buraya JavaScript ile liste gelecek -->
            </div>
        </div>
    </div>

    <!-- Kaydet Modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💾 Hesaplamayı Kaydet</h2>
                <button class="close-modal" onclick="closeSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block;">Kayıt Adı</label>
                    <input type="text" id="saveName" placeholder="Örn: Olivium AVM - Ocak 2025" 
                           style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-load" onclick="confirmSave()" style="flex: 1;">
                        💾 Kaydet
                    </button>
                    <button class="btn-delete" onclick="closeSaveModal()" style="flex: 1; background: #6c757d;">
                        ❌ İptal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Para Birimi Seçici -->
    <div class="currency-badge" onclick="toggleCurrencyMenu()" id="currencyBadge">
        <span id="currentCurrencySymbol">₺</span>
        <span id="currentCurrencyCode" style="font-weight: 600;">TRY</span>
    </div>
    
    <div class="currency-menu" id="currencyMenu">
        <div style="font-weight: 600; margin-bottom: 10px; color: #1e3c72;">💱 Para Birimi Seç:</div>
        <button class="currency-option-btn active" onclick="changeCurrency('TRY', '₺')">
            🇹🇷 Türk Lirası (₺)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('USD', '$')">
            🇺🇸 US Dollar ($)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('EUR', '€')">
            🇪🇺 Euro (€)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('GBP', '£')">
            🇬🇧 British Pound (£)
        </button>
    </div>

    <!-- Achievements Badge -->
    <div class="achievements-badge" onclick="toggleAchievements()" title="Başarımlar">
        🏆
    </div>

    <div class="achievements-panel" id="achievementsPanel">
        <h3 style="margin: 0 0 20px 0; color: #1e3c72; text-align: center;">🏆 BAŞARIMLAR</h3>
        <div id="achievementsList"></div>
    </div>

    <!-- Chatbot -->
    <div class="chatbot-button" onclick="toggleChatbot()" title="AI Asistan">
        🤖
    </div>

    <div class="chatbot-window" id="chatbotWindow">
        <div class="chatbot-header">
            <div>
                <div style="font-weight: 700;">🤖 Parkexpert Asistan</div>
                <div style="font-size: 12px; opacity: 0.9;">Size nasıl yardımcı olabilirim?</div>
            </div>
            <button onclick="toggleChatbot()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">×</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chat-message bot">
                Merhaba! 👋 Ben Parkexpert AI asistanınızım. Size nasıl yardımcı olabilirim?
            </div>
        </div>
        <div class="chat-quick-replies">
            <button class="quick-reply-btn" onclick="askChatbot('nasıl')">Nasıl kullanırım?</button>
            <button class="quick-reply-btn" onclick="askChatbot('öneri')">Öneri al</button>
            <button class="quick-reply-btn" onclick="askChatbot('şablon')">Şablon öner</button>
            <button class="quick-reply-btn" onclick="askChatbot('karlılık')">Karlılık arttır</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2 style="text-align: center; color: #1e3c72; margin: 0 0 10px 0;">🅿️ Parkexpert</h2>
            <p style="text-align: center; color: #6c757d; margin: 0 0 30px 0; font-size: 14px;">
                Hesabınızla giriş yapın
            </p>
            
            <!-- Login Form Only -->
            <div class="login-form active">
                <input type="email" class="form-input" id="loginEmail" placeholder="📧 Email" autocomplete="email">
                <input type="password" class="form-input" id="loginPassword" placeholder="🔒 Şifre" autocomplete="current-password">
                <button class="login-btn" onclick="handleLogin()">
                    🔓 Giriş Yap
                </button>
                <button class="guest-btn" onclick="continueAsGuest()">
                    👤 Misafir Olarak Devam Et
                </button>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <small style="color: #6c757d;">
                        💡 Hesap oluşturmak için admin ile iletişime geçin<br>
                        <strong>Demo:</strong> admin@parkexpert.com / admin123
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal-overlay" id="adminPanelOverlay" onclick="closeAdminPanel()"></div>
    <div class="financing-modal" id="adminPanel">
        <h2 style="color: #1e3c72; margin: 0 0 20px 0;">👑 ADMİN PANELİ</h2>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #e7f3ff; border-radius: 10px; border-left: 4px solid #667eea;">
            <strong>🎯 Hoşgeldin Admin!</strong><br>
            <small style="color: #6c757d;">Kullanıcıları buradan yönetebilirsin</small>
        </div>

        <!-- Tabs -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e9ecef;">
            <button class="login-tab active" onclick="switchAdminTab('users')" id="adminUsersTab">
                👥 Kullanıcılar
            </button>
            <button class="login-tab" onclick="switchAdminTab('add')" id="adminAddTab">
                ➕ Yeni Kullanıcı
            </button>
            <button class="login-tab" onclick="switchAdminTab('settings')" id="adminSettingsTab">
                ⚙️ Ayarlar
            </button>
        </div>

        <!-- Users List -->
        <div id="adminUsersSection" class="admin-section active">
            <div id="usersList" style="max-height: 400px; overflow-y: auto;">
                <!-- Kullanıcı listesi buraya gelecek -->
            </div>
        </div>

        <!-- Add User -->
        <div id="adminAddSection" class="admin-section" style="display: none;">
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">👤 Ad Soyad</label>
                <input type="text" id="newUserName" class="form-input" placeholder="Örn: Ahmet Yılmaz">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">📧 Email</label>
                <input type="email" id="newUserEmail" class="form-input" placeholder="ahmet@parkexpert.com">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">🔒 Şifre</label>
                <input type="text" id="newUserPassword" class="form-input" placeholder="Güçlü şifre belirleyin">
                <button onclick="generatePassword()" style="margin-top: 5px; padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    🎲 Rastgele Şifre Oluştur
                </button>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">🏢 Şirket</label>
                <input type="text" id="newUserCompany" class="form-input" placeholder="Parkexpert">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">👔 Yetki Seviyesi</label>
                <select id="newUserRole" class="form-select">
                    <option value="viewer">👁️ Viewer - Sadece Görüntüleme</option>
                    <option value="manager">👨‍💼 Manager - Düzenleme İzni</option>
                    <option value="admin">👑 Admin - Tam Yetki (DİKKAT!)</option>
                </select>
            </div>
            <button onclick="createUser()" class="login-btn">
                ✨ Kullanıcı Oluştur
            </button>
        </div>

        <!-- Settings -->
        <div id="adminSettingsSection" class="admin-section" style="display: none;">
            <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3 style="margin: 0 0 15px 0; color: #1e3c72;">⚙️ Sistem Ayarları</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="allowGuestMode" checked onchange="toggleGuestMode()">
                        <span>Misafir girişine izin ver</span>
                    </label>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="requireApproval" onchange="toggleApproval()">
                        <span>Yeni kullanıcılar onay beklesin</span>
                    </label>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                    <strong>📊 İstatistikler:</strong><br>
                    <div id="adminStats" style="margin-top: 10px; color: #6c757d;">
                        <!-- Stats buraya gelecek -->
                    </div>
                </div>
            </div>
        </div>

        <button onclick="closeAdminPanel()" style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
            Kapat
        </button>
    </div>

    <!-- Tools Menu -->
    <div class="tools-menu">
        <button class="tool-btn" onclick="takeScreenshot()" title="📸 Screenshot">📸</button>
        <button class="tool-btn" onclick="window.print()" title="🖨️ Print">🖨️</button>
        <button class="tool-btn" onclick="openFinancing()" title="💳 Finansman">💳</button>
        <button class="tool-btn" onclick="openGoalSetting()" title="🎯 Hedef">🎯</button>
        <button class="tool-btn" onclick="setReminder()" title="🔔 Hatırlatıcı">🔔</button>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeAllModals()"></div>

    <!-- Financing Modal -->
    <div class="financing-modal" id="financingModal">
        <h2 style="color: #1e3c72; margin: 0 0 20px 0;">💳 FİNANSMAN HESAPLAYfour</h2>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Kredi Tutarı (₺)</label>
            <input type="number" id="loanAmount" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;" placeholder="Örn: 5000000">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Faiz Oranı (Yıllık %)</label>
            <input type="number" id="interestRate" value="2.5" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Vade (Ay)</label>
            <input type="number" id="loanTerm" value="60" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
        </div>
        <button onclick="calculateLoan()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 15px;">
            💰 Hesapla
        </button>
        <div id="loanResults" style="display: none; padding: 20px; background: #f8f9fa; border-radius: 12px;">
            <!-- Results will be shown here -->
        </div>
        <button onclick="closeAllModals()" style="width: 100%; padding: 10px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">
            Kapat
        </button>
    </div>

</body>
</html>
