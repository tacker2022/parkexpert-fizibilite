<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>Parkexpert - Otopark Fizibilite Hesaplama</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Otopark fizibilite hesaplama ve analiz aracı. Karlılık analizi, ROI hesaplama ve akıllı öneriler.">
    <meta name="theme-color" content="#1e3c72">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Parkexpert">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23667eea'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='100' fill='white' font-weight='bold'%3EP%3C/text%3E%3C/svg%3E">

    <!-- Analytics Placeholder -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2Z3E96YKGC"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #1e3c72;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --header-bg: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        [data-theme="dark"] {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eaeaea;
            --text-secondary: #a0a0a0;
            --border-color: #2d3748;
            --success-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ed8936;
            --header-bg: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--header-bg);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-container img {
            max-height: 80px;
            max-width: 200px;
            object-fit: contain;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px 24px;
            background: white;
            color: #1e3c72;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .logo-upload {
            display: none;
        }

        .upload-logo-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-logo-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .save-load-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-load-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .close-modal {
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            transition: transform 0.2s;
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .saved-calculation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .saved-calculation:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .saved-calculation h3 {
            margin: 0 0 10px 0;
            color: #1e3c72;
            font-size: 18px;
        }

        .saved-calculation-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
            color: #6c757d;
        }

        .saved-calculation-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-load, .btn-delete {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-load {
            background: #667eea;
            color: white;
        }

        .btn-load:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Scenario Comparison Styles */
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .scenario-tab {
            padding: 12px 30px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            color: #667eea;
        }

        .scenario-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .scenario-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .scenario-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-btn.save {
            background: #28a745;
            color: white;
        }

        .scenario-btn.compare {
            background: #667eea;
            color: white;
        }

        .scenario-btn.clear {
            background: #dc3545;
            color: white;
        }

        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .comparison-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .comparison-header h2 {
            color: #1e3c72;
            margin: 0 0 10px 0;
        }

        .winner-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table .metric-name {
            text-align: left;
            font-weight: 600;
            color: #1e3c72;
        }

        .comparison-table .better {
            background: #d4edda;
            font-weight: 700;
            color: #155724;
        }

        .comparison-table .worse {
            background: #f8d7da;
            color: #721c24;
        }

        .scenario-info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .scenario-info-box h3 {
            margin: 0 0 10px 0;
            color: #1e3c72;
        }

        .scenario-info-box p {
            margin: 5px 0;
            color: #6c757d;
        }

        /* Theme Switcher */
        .theme-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .theme-btn.active {
            background: white;
            color: #667eea;
        }

        .color-picker-container {
            position: relative;
        }

        .color-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .color-picker-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .color-picker-menu.active {
            display: block;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            margin: 5px;
            display: inline-block;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.2);
            border-color: #667eea;
        }

        .color-option.active {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        /* Smart Recommendations */
        .recommendations-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .recommendations-container {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .recommendations-header {
            text-align: center;
            color: white;
            margin-bottom: 25px;
        }

        .recommendations-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .recommendation-card.positive {
            border-left: 5px solid #28a745;
        }

        .recommendation-card.warning {
            border-left: 5px solid #ffc107;
        }

        .recommendation-card.critical {
            border-left: 5px solid #dc3545;
        }

        .recommendation-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .recommendation-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .recommendation-desc {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .recommendation-impact {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }

        .recommendation-impact.positive {
            color: #28a745;
        }

        .recommendation-impact.negative {
            color: #dc3545;
        }

        .ai-score {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .ai-score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .ai-score-value {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
        }

        .ai-score-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Share Buttons */
        .share-section {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .share-btn.whatsapp {
            background: #25D366;
            color: white;
        }

        .share-btn.email {
            background: #EA4335;
            color: white;
        }

        .share-btn.copy {
            background: #667eea;
            color: white;
        }

        .share-btn.telegram {
            background: #0088cc;
            color: white;
        }

        /* Template System */
        .template-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .template-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .template-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .template-title {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 12px;
            color: #6c757d;
        }

        /* Notes System */
        .notes-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }

        .notes-textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        /* Currency Selector */
        .currency-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            background: white;
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .currency-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
        }

        .currency-menu {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 998;
        }

        .currency-menu.active {
            display: block;
        }

        .currency-option-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin: 5px 0;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .currency-option-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .currency-option-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .animate-in {
            animation: slideInUp 0.5s ease-out;
        }

        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Gamification */
        .achievement-popup {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideInUp 0.5s ease-out;
            max-width: 300px;
        }

        .achievement-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 5px;
            text-align: center;
        }

        .achievement-desc {
            font-size: 14px;
            opacity: 0.9;
            text-align: center;
        }

        .achievements-badge {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .achievements-badge:hover {
            transform: scale(1.1) rotate(15deg);
        }

        .achievements-panel {
            display: none;
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 998;
            overflow-y: auto;
            padding: 20px;
        }

        .achievements-panel.active {
            display: block;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }

        .achievement-item.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        /* Chatbot */
        .chatbot-button {
            position: fixed;
            bottom: 160px;
            left: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .chatbot-window {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 998;
            flex-direction: column;
            overflow: hidden;
        }

        .chatbot-window.active {
            display: flex;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            max-width: 80%;
            animation: slideInUp 0.3s ease-out;
        }

        .chat-message.bot {
            background: white;
            border: 2px solid #667eea;
            margin-right: auto;
        }

        .chat-message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .chat-quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .quick-reply-btn {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Screenshot & Tools */
        .tools-menu {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: white;
            border-radius: 10px 0 0 10px;
            box-shadow: -4px 0 20px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 997;
        }

        .tool-btn {
            display: block;
            width: 50px;
            height: 50px;
            margin: 10px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .tool-btn:hover {
            transform: scale(1.1);
            background: #764ba2;
        }

        /* Branding Controls (Issue #4) */
        .branding-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 998;
            min-width: 250px;
        }

        .color-picker-group {
            margin-bottom: 15px;
        }

        .color-picker-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .color-picker-group input[type="color"] {
            width: 100%;
            height: 40px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
        }

        .color-picker-group input[type="color"]:hover {
            border-color: #667eea;
        }

        /* Financing Modal */
        .financing-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            z-index: 10000;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .financing-modal.active {
            display: block;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
        }

        .modal-overlay.active {
            display: block;
        }

        /* Multi-User System */
        .user-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 60px;
            left: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            min-width: 250px;
            padding: 15px;
            z-index: 999;
        }

        .user-dropdown.active {
            display: block;
            animation: slideInUp 0.3s ease-out;
        }

        .user-info {
            padding: 15px;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 15px;
        }

        .user-name {
            font-weight: 700;
            color: #1e3c72;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-role {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .user-role.admin {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .user-role.manager {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .user-role.viewer {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            color: #1e3c72;
            margin: 5px 0;
        }

        .user-menu-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            align-items: center;
            justify-content: center;
        }

        .login-modal.hidden {
            display: none;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideInUp 0.5s ease-out;
        }

        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .login-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Guest mode removed for security */

        /* Live Dashboard */
        .dashboard-container {
            display: none;
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .dashboard-container.active {
            display: block;
        }

        .dashboard-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .dashboard-header h2 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }

        .dashboard-kpis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .kpi-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 5px;
            animation: countUp 1s ease-out;
        }

        .kpi-label {
            font-size: 14px;
            color: #6c757d;
            font-weight: 600;
        }

        .kpi-trend {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .kpi-trend.up {
            background: #d4edda;
            color: #155724;
        }

        .kpi-trend.down {
            background: #f8d7da;
            color: #721c24;
        }

        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }

        .kpi-content {
            flex: 1;
        }

        .kpi-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(108, 117, 125, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .kpi-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #48bb78 100%);
            border-radius: 10px;
            transition: width 1s ease-out;
        }

        .kpi-progress-fill.low {
            background: linear-gradient(90deg, #dc3545 0%, #f56565 100%);
        }

        .kpi-progress-fill.medium {
            background: linear-gradient(90deg, #ffc107 0%, #ed8936 100%);
        }

        .kpi-progress-fill.high {
            background: linear-gradient(90deg, #28a745 0%, #48bb78 100%);
        }

        .kpi-stars {
            font-size: 24px;
            color: #ffc107;
            margin-top: 8px;
            letter-spacing: 4px;
        }

        .kpi-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 6px 14px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
        }

        .kpi-badge.excellent {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .kpi-badge.good {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .kpi-badge.poor {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .trend-icon {
            font-size: 16px;
        }

        .trend-percent {
            margin-left: 5px;
        }

        /* Executive Summary (Issue #6) */
        .executive-summary {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .summary-section {
            margin-bottom: 20px;
        }

        .summary-section.tldr {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }

        .summary-section.tldr h3 {
            color: white;
            margin: 0 0 10px 0;
        }

        .summary-section.tldr p {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-section h3 {
            color: #1e3c72;
            margin: 0 0 15px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .summary-section ul li {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
            font-size: 14px;
            line-height: 1.6;
        }

        .summary-section ul li:last-child {
            margin-bottom: 0;
        }

        /* Goal Tracking Widget (Issue #7) */
        .goal-widget {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .goal-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            border-radius: 10px;
            transition: width 1s ease-out;
            position: relative;
        }

        .goal-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 1s ease-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* Chart Styles */
        .charts-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .chart-container h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .chart-wrapper canvas {
            max-height: 300px;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .section::-webkit-scrollbar {
            height: 8px;
        }

        .section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .section::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .section::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }

        .section h2 {
            color: #1e3c72;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input[readonly] {
            background-color: #e9ecef !important;
            cursor: not-allowed;
            color: #495057;
            font-weight: 600;
        }

        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
        }

        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 25px;
            top: -10px;
            background: #2d3748;
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            white-space: normal;
            width: 280px;
            font-size: 13px;
            font-weight: normal;
            line-height: 1.5;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .info-icon:hover::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 4px;
            border: 6px solid transparent;
            border-right-color: #2d3748;
            z-index: 1001;
        }

        .manager-report-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 15px;
            display: none;
        }

        .manager-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
        }

        .export-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            flex: 1;
            max-width: 300px;
        }

        .excel-btn {
            background: linear-gradient(135deg, #1d6f42 0%, #26a65b 100%);
        }

        .excel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(38, 166, 91, 0.3);
        }

        .pdf-btn {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }

        .pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .manager-report {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            color: white;
            margin-top: 30px;
            display: none;
        }

        .manager-report h2 {
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .manager-report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .manager-report-card {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            color: #1e3c72;
        }

        .manager-report-card h4 {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .manager-report-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #1e3c72;
        }

        .manager-summary {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            color: #1e3c72;
        }

        .manager-summary h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .manager-summary p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .highlight {
            font-weight: 700;
            color: #667eea;
        }

            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .staff-category h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .staff-total-display {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .staff-total-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }

        .staff-total-label {
            font-weight: 600;
            color: #495057;
        }

        .staff-total-value {
            font-weight: 700;
            font-size: 18px;
            color: #1e3c72;
            text-align: right;
        }

        .staff-total-value.final {
            color: #28a745;
            font-size: 20px;
        }

        .time-slot {
            display: grid;
            grid-template-columns: 1fr 0.85fr 0.85fr 0.85fr 1.2fr;
            gap: 6px;
            margin-bottom: 12px;
            align-items: center;
        }

        .time-slot label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
        }

        .time-slot input {
            padding: 10px 8px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .time-slot input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .time-slot .revenue-display {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 6px 8px;
            font-size: 12px;
            line-height: 1.3;
            color: #1e3c72;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.1);
        }

        .time-slot .revenue-display .daily {
            font-size: 13px;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 2px;
        }

        .time-slot .revenue-display .period {
            display: block;
            font-size: 10px;
            color: #6c757d;
            font-weight: 500;
            margin-top: 2px;
            line-height: 1.2;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #667eea;
        }

        .results h2 {
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .result-card h3 {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-card .value {
            font-size: 28px;
            font-weight: 700;
            color: #1e3c72;
        }

        .result-card.positive {
            border-left-color: #28a745;
        }

        .result-card.positive .value {
            color: #28a745;
        }

        .result-card.negative {
            border-left-color: #dc3545;
        }

        .result-card.negative .value {
            color: #dc3545;
        }

        .result-card.warning {
            border-left-color: #ffc107;
        }

        .result-card.warning .value {
            color: #ffc107;
        }

        .result-card-large {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border-left: 6px solid #667eea;
            grid-column: span 1;
        }

        .result-card-large h3 {
            font-size: 18px;
            color: #6c757d;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-card-large .value {
            font-size: 42px;
            font-weight: 800;
            color: #1e3c72;
        }

        .result-card-large.rent-card {
            border-left-color: #dc3545;
        }

        .result-card-large.rent-card .value {
            color: #dc3545;
        }

        .result-card-large.profit-card.positive {
            border-left-color: #28a745;
        }

        .result-card-large.profit-card.positive .value {
            color: #28a745;
        }

        .result-card-large.profit-card.negative {
            border-left-color: #dc3545;
        }

        .result-card-large.profit-card.negative .value {
            color: #dc3545;
        }

        .result-card-large .small-text {
            font-size: 14px;
            color: #6c757d;
            margin-top: 10px;
            font-weight: 500;
        }

        .comparison-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 3px solid #667eea;
        }

        .period-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .period-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .small-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 12px;
            }

            .theme-controls {
                position: static;
                margin-top: 15px;
                justify-content: center;
            }

            .scenario-tabs {
                flex-direction: column;
            }

            .scenario-tab {
                width: 100%;
                padding: 10px;
            }

            .scenario-actions {
                flex-direction: column;
            }

            .scenario-btn {
                width: 100%;
            }

            .save-load-btn {
                font-size: 12px;
                padding: 8px 15px;
            }

            .content {
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 20px;
            }

            .section {
                padding: 20px;
            }

            .section h2 {
                font-size: 18px;
            }

            .form-group label {
                font-size: 13px;
            }

            .form-group input,
            .form-group select {
                font-size: 14px;
            }

            .time-slot {
                grid-template-columns: 1fr;
                gap: 8px;
                background: #f8f9fa;
                padding: 12px;
                border-radius: 10px;
                margin-bottom: 12px;
            }

            .time-slot label {
                display: none;
            }

            .time-slot input {
                font-size: 15px;
                padding: 12px;
            }

            .time-slot input::placeholder {
                font-size: 13px;
            }

            .time-slot .revenue-display {
                padding: 10px;
                font-size: 13px;
            }

            .time-slot .revenue-display .daily {
                font-size: 15px;
            }

            .time-slot .revenue-display .period {
                font-size: 11px;
            }

            .calculate-btn {
                padding: 12px;
                font-size: 14px;
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .result-card {
                padding: 15px;
            }

            .result-card h3 {
                font-size: 14px;
            }

            .result-card .value {
                font-size: 24px;
            }

            .result-card-large .value {
                font-size: 28px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                padding: 15px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .recommendation-card {
                padding: 15px;
            }

            .comparison-table {
                font-size: 12px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px 5px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .modal-body {
                padding: 20px;
            }

            .manager-report-grid {
                grid-template-columns: 1fr;
            }

            .logo-container {
                flex-direction: column;
                gap: 10px;
            }

            .logo-container img {
                max-height: 60px;
            }

            #exportButtons {
                flex-direction: column;
            }

            /* Dashboard Mobile */
            .dashboard-container {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }

            .dashboard-card {
                min-height: auto;
            }

            /* User Menu Mobile */
            .user-menu {
                right: 10px;
                max-width: 280px;
            }

            /* Admin Panel Mobile */
            .financing-modal {
                width: 95% !important;
                max-width: 95% !important;
                margin: 5% auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            /* Executive Summary Mobile */
            .executive-summary {
                padding: 15px;
            }

            /* Goal Widget Mobile */
            .goal-widget {
                padding: 15px;
            }

            /* Toast Mobile */
            .toast {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
            }

            /* Branding Controls Mobile */
            .branding-controls {
                width: 90%;
                max-width: 300px;
            }
        }

        /* Tablet (Portrait) - 481px to 768px */
        @media (min-width: 481px) and (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-slot {
                grid-template-columns: 1fr 0.8fr 0.8fr 0.8fr 1.2fr;
                gap: 6px;
                font-size: 13px;
            }

            .time-slot label {
                display: block;
                font-size: 12px;
            }

            .time-slot input {
                padding: 8px 6px;
                font-size: 13px;
            }

            .time-slot .revenue-display {
                font-size: 11px;
                padding: 5px 6px;
            }

            .time-slot .revenue-display .daily {
                font-size: 12px;
            }

            .time-slot .revenue-display .period {
                font-size: 9px;
            }
        }

        /* Large Mobile - 376px to 480px */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 18px;
            }

            .section h2 {
                font-size: 16px;
            }

            .form-group label {
                font-size: 12px;
            }

            .calculate-btn {
                font-size: 16px;
                padding: 15px;
            }

            /* Touch-Friendly Buttons */
            button, .action-btn, .scenario-tab {
                min-height: 44px; /* iOS recommended touch target */
                padding: 12px 20px;
            }

            /* Larger form inputs for mobile */
            input[type="text"],
            input[type="number"],
            input[type="email"],
            input[type="password"],
            select {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Modal padding */
            .modal-body {
                padding: 15px;
            }

            /* Chart height for mobile */
            .chart-wrapper {
                height: 200px;
            }
        }

        /* Small Mobile - Max 375px */
        @media (max-width: 375px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 16px;
            }

            .section {
                padding: 15px;
            }

            .section h2 {
                font-size: 15px;
            }

            .result-card .value {
                font-size: 20px;
            }

            .time-slot input {
                font-size: 13px;
                padding: 8px;
            }
        }

        /* Touch device improvements */
        @media (hover: none) and (pointer: coarse) {
            /* This targets touch devices */
            button, a, .clickable {
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(102, 126, 234, 0.2);
            }

            /* Larger touch targets */
            .info-icon,
            .close-btn,
            .modal-close {
                min-width: 44px;
                min-height: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            /* Prevent double-tap zoom */
            * {
                touch-action: manipulation;
            }

            /* Smooth scrolling on touch */
            html {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Mobile Bottom Action Bar */
        @media (max-width: 768px) {
            /* Sticky Calculate Button on Mobile */
            .calculate-btn {
                position: sticky;
                bottom: 0;
                z-index: 999;
                margin: 20px 0 0 0;
                border-radius: 0;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            }

            /* Sticky Header on Mobile */
            .header {
                position: sticky;
                top: 0;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            /* User Menu Mobile Position */
            .user-menu {
                position: absolute;
                top: 15px;
                right: 15px;
                z-index: 1001;
            }

            .user-dropdown {
                position: fixed !important;
                top: auto !important;
                right: 10px !important;
                left: 10px !important;
                bottom: 80px !important;
                width: auto !important;
                max-width: none !important;
                border-radius: 15px 15px 0 0;
            }

            /* Theme Controls Mobile - Hidden by default, show in settings */
            .theme-controls {
                display: none;
            }

            /* Mobile Quick Actions Floating Button */
            .mobile-quick-actions {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 998;
            }

            .mobile-fab {
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                color: white;
                border: none;
                font-size: 24px;
                box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }

            .mobile-fab:active {
                transform: scale(0.95);
            }

            /* Mobile Action Sheet */
            .mobile-action-sheet {
                position: fixed;
                bottom: -100%;
                left: 0;
                right: 0;
                background: white;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
                z-index: 1002;
                transition: bottom 0.3s ease;
                max-height: 70vh;
                overflow-y: auto;
            }

            .mobile-action-sheet.active {
                bottom: 0;
            }

            .mobile-action-sheet-header {
                padding: 20px;
                border-bottom: 2px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .mobile-action-sheet-body {
                padding: 20px;
            }

            .mobile-action-item {
                padding: 15px;
                border-bottom: 1px solid #f0f0f0;
                display: flex;
                align-items: center;
                gap: 15px;
                cursor: pointer;
                transition: background 0.2s;
            }

            .mobile-action-item:active {
                background: #f8f9fa;
            }

            .mobile-action-item:last-child {
                border-bottom: none;
            }

            .mobile-action-icon {
                font-size: 24px;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f0f4ff;
                border-radius: 10px;
            }
        }

        /* Landscape mode improvements */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 10px 15px;
            }

            .header h1 {
                font-size: 16px;
            }

            .section {
                padding: 15px;
            }

            .modal-content {
                margin: 2% auto;
                max-height: 96vh;
                overflow-y: auto;
            }
        }

        /* 🎓 ONBOARDING TUTORIAL STYLES */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: 99998;
            display: none;
        }

        .tutorial-overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .tutorial-spotlight {
            position: absolute;
            border: 3px solid #667eea;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75), 0 0 20px rgba(102, 126, 234, 0.8);
            border-radius: 8px;
            z-index: 99999;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .tutorial-tooltip {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 350px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 100000;
            animation: slideInUp 0.3s ease;
        }

        .tutorial-tooltip h3 {
            margin: 0 0 10px 0;
            color: #1e3c72;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tutorial-tooltip p {
            margin: 0 0 15px 0;
            color: #6c757d;
            font-size: 14px;
            line-height: 1.6;
        }

        .tutorial-buttons {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            align-items: center;
        }

        .tutorial-progress {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
        }

        .tutorial-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tutorial-btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tutorial-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .tutorial-btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
        }

        .tutorial-btn-secondary:hover {
            background: #e9ecef;
        }

        .tutorial-welcome {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 100001;
            text-align: center;
            animation: scaleIn 0.4s ease;
        }

        .tutorial-welcome h2 {
            margin: 0 0 15px 0;
            color: #1e3c72;
            font-size: 28px;
        }

        .tutorial-welcome p {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .tutorial-welcome-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Mobile tutorial adjustments */
        @media (max-width: 768px) {
            .tutorial-tooltip {
                max-width: calc(100% - 40px);
                left: 20px !important;
                right: 20px !important;
                bottom: 20px !important;
                top: auto !important;
            }

            .tutorial-welcome {
                padding: 30px 20px;
            }

            .tutorial-welcome h2 {
                font-size: 22px;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .header {
                background: #1e3c72 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-after: avoid;
            }

            .logo-container {
                page-break-inside: avoid;
            }

            .section {
                page-break-inside: avoid;
                margin-bottom: 20px;
            }

            .results {
                page-break-before: always;
            }

            .calculate-btn, .action-buttons, .upload-logo-btn {
                display: none !important;
            }

            .result-card {
                page-break-inside: avoid;
            }

            .form-group input, .form-group select, .time-slot input {
                border: 1px solid #dee2e6;
                background: white;
            }

            @page {
                margin: 1cm;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- User Menu -->
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleUserDropdown()" id="userAvatar">
                    <span id="userInitials">?</span>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-info">
                        <div class="user-name" id="currentUserName">Misafir</div>
                        <span class="user-role viewer" id="currentUserRole">Viewer</span>
                    </div>
                    <div class="user-menu-item" onclick="showUserProfile()">
                        👤 Profil
                    </div>
                    <div class="user-menu-item" id="adminPanelBtn" style="display: none;" onclick="openAdminPanel()">
                        👑 Admin Paneli
                    </div>
                    <div class="user-menu-item" onclick="showTeamMembers()">
                        👥 Ekip Üyeleri
                    </div>
                    <div class="user-menu-item" onclick="showSettings()">
                        ⚙️ Ayarlar
                    </div>
                    <div class="user-menu-item" onclick="logout()" style="color: #dc3545;">
                        🚪 Çıkış Yap
                    </div>
                </div>
            </div>

            <!-- Tema Kontrolleri -->
            <div class="theme-controls">
                <button class="theme-btn active" id="lightThemeBtn" onclick="setTheme('light')" title="Aydınlık Tema">
                    ☀️
                </button>
                <button class="theme-btn" id="darkThemeBtn" onclick="setTheme('dark')" title="Karanlık Tema">
                    🌙
                </button>
                <div class="color-picker-container">
                    <button class="color-btn" onclick="toggleColorPicker()">
                        🎨 <span data-i18n="color">Renk</span>
                    </button>
                    <div class="color-picker-menu" id="colorPickerMenu">
                        <div style="margin-bottom: 10px; font-weight: 600; color: #1e3c72;" data-i18n="selectColor">Tema Rengi Seç:</div>
                        <div class="color-option active" style="background: linear-gradient(135deg, #667eea, #764ba2);" onclick="setColor('#667eea', '#764ba2')" data-primary="#667eea" data-secondary="#764ba2"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #f093fb, #f5576c);" onclick="setColor('#f093fb', '#f5576c')" data-primary="#f093fb" data-secondary="#f5576c"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #4facfe, #00f2fe);" onclick="setColor('#4facfe', '#00f2fe')" data-primary="#4facfe" data-secondary="#00f2fe"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #43e97b, #38f9d7);" onclick="setColor('#43e97b', '#38f9d7')" data-primary="#43e97b" data-secondary="#38f9d7"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #fa709a, #fee140);" onclick="setColor('#fa709a', '#fee140')" data-primary="#fa709a" data-secondary="#fee140"></div>
                        <div class="color-option" style="background: linear-gradient(135deg, #30cfd0, #330867);" onclick="setColor('#30cfd0', '#330867')" data-primary="#30cfd0" data-secondary="#330867"></div>
                    </div>
                </div>
                <select id="languageSelector" onchange="changeLanguage(this.value)" style="padding: 8px 12px; border-radius: 8px; border: 2px solid white; background: rgba(255,255,255,0.2); color: white; cursor: pointer; font-weight: 600;">
                    <option value="tr">🇹🇷 TR</option>
                    <option value="en">🇬🇧 EN</option>
                </select>
            </div>

            <div class="logo-container">
                <img id="companyLogo" src="" alt="Logo" style="display: none;">
                <div>
                    <h1>🅿️ <span data-i18n="title">PARKEXPERT FİZİBİLİTE HESAPLAMA</span></h1>
                    <p data-i18n="subtitle">Otopark Lokasyonu Karlılık Analizi</p>
                </div>
            </div>
            <input type="file" id="logoUpload" class="logo-upload" accept="image/*">
            <button class="upload-logo-btn" onclick="document.getElementById('logoUpload').click()">
                📸 <span data-i18n="uploadLogo">Logo Yükle</span>
            </button>
            
            <!-- Kaydet/Yükle Butonları -->
            <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                <button class="save-load-btn" onclick="saveCalculation()">
                    💾 Hesaplamayı Kaydet
                </button>
                <button class="save-load-btn" onclick="showLoadModal()">
                    📂 Kayıtlı Hesaplamalar
                </button>
            </div>

            <!-- Senaryo Karşılaştırma -->
            <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid rgba(255,255,255,0.2);">
                <div class="scenario-tabs">
                    <div class="scenario-tab active" onclick="switchScenario('A')" id="tabA">
                        📊 <span data-i18n="scenarioA">Senaryo A</span>
                    </div>
                    <div class="scenario-tab" onclick="switchScenario('B')" id="tabB">
                        📊 <span data-i18n="scenarioB">Senaryo B</span>
                    </div>
                </div>
                <div class="scenario-actions">
                    <button class="scenario-btn save" onclick="saveCurrentScenario()">
                        💾 <span data-i18n="saveScenario">Bu Senaryoyu Kaydet</span>
                    </button>
                    <button class="scenario-btn compare" onclick="compareScenarios()">
                        ⚖️ <span data-i18n="compareScenarios">Senaryoları Karşılaştır</span>
                    </button>
                    <button class="scenario-btn clear" onclick="clearScenario()">
                        🗑️ <span data-i18n="clearScenario">Senaryoyu Temizle</span>
                    </button>
                </div>
                <div id="scenarioIndicator" style="text-align: center; margin-top: 10px; color: white; font-weight: 600;">
                    📊 <span data-i18n="activeScenario">Aktif: Senaryo</span> A
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Template Seçimi -->
            <div class="section" style="grid-column: 1 / -1;">
                <div class="template-section">
                    <h2 style="text-align: center; color: white; margin: 0 0 10px 0;">💼 HIZLI ŞABLON SEÇİMİ</h2>
                    <p style="text-align: center; color: rgba(255,255,255,0.8); margin: 0 0 20px 0; font-size: 14px;">
                        <span data-i18n="templateDesc">Sektörünüze uygun hazır şablonları kullanarak hızlıca başlayın</span>
                    </p>
                    <div class="template-grid">
                        <div class="template-card" onclick="applyTemplate('avm')">
                            <div class="template-icon">🏬</div>
                            <div class="template-title">AVM</div>
                            <div class="template-desc">Alışveriş Merkezi<br>Yoğun Trafik</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('plaza')">
                            <div class="template-icon">🏢</div>
                            <div class="template-title">Plaza / Ofis</div>
                            <div class="template-desc">İş Merkezi<br>Hafta İçi Yoğun</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('hastane')">
                            <div class="template-icon">🏥</div>
                            <div class="template-title">Hastane</div>
                            <div class="template-desc">Sağlık Tesisi<br>7/24 Aktif</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('otel')">
                            <div class="template-icon">🏨</div>
                            <div class="template-title">Otel</div>
                            <div class="template-desc">Konaklama<br>Turist Ağırlıklı</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('stadyum')">
                            <div class="template-icon">🏟️</div>
                            <div class="template-title">Stadyum / Salon</div>
                            <div class="template-desc">Etkinlik Alanı<br>Yüksek Kapasite</div>
                        </div>
                        <div class="template-card" onclick="applyTemplate('custom')">
                            <div class="template-icon">⚙️</div>
                            <div class="template-title">Özel</div>
                            <div class="template-desc">Manuel Giriş<br>Sıfırdan Başla</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Genel Bilgiler -->
            <div class="section">
                <h2>📊 Genel Bilgiler</h2>
                <div class="form-group">
                    <label>Lokasyon Adı <span class="info-icon" data-tooltip="Otopark lokasyonunun adı. Örnek: Olivium AVM, Zorlu Center, Metropol İstanbul vb.">i</span></label>
                    <input type="text" id="locationName" placeholder="Örn: Olivium AVM">
                </div>
                <div class="form-group">
                    <label>Devinim <span class="info-icon" data-tooltip="Bir park yerinin günde kaç kez kullanıldığını gösteren oran. Örnek: 1.5 = Her park yeri günde ortalama 1.5 kez kullanılıyor. Yüksek devinim = Daha fazla kazanç.">i</span></label>
                    <input type="number" id="devinim" value="1.5" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Çalışılan Ay (Yıllık) <span class="info-icon" data-tooltip="Yıl içinde kaç ay otopark çalışacak. Genellikle 12 ay (tüm yıl) seçilir. Mevsimlik otoparklar için daha az olabilir.">i</span></label>
                    <input type="number" id="workingMonths" value="12" min="1" max="12" onchange="recalculateAllRevenues()" onkeyup="recalculateAllRevenues()">
                </div>
            </div>

            <!-- Operasyonel Giderler -->
            <div class="section">
                <h2>👥 PERSONEL</h2>
                
                <div class="form-group">
                    <label>Asgari Ücretli Personel Sayısı <span class="info-icon" data-tooltip="Asgari ücretle çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staffMinWage" value="2" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>
                
                <div class="form-group">
                    <label>25.000₺ Ücretli Personel Sayısı <span class="info-icon" data-tooltip="25.000₺ maaşla çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staff25k" value="0" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>
                
                <div class="form-group">
                    <label>Yönetici Sayısı <span class="info-icon" data-tooltip="Yönetici kadrosunda çalışan personel sayısı. İşverene toplam maliyet KDV ve katsayı dahil otomatik hesaplanır.">i</span></label>
                    <input type="number" id="staffManager" value="0" min="0" onchange="calculateTotalStaffCost()" onkeyup="calculateTotalStaffCost()">
                </div>

                <!-- Toggle Butonu -->
                <button type="button" onclick="toggleStaffDetails()" style="width: 100%; padding: 10px; margin: 20px 0 10px 0; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer; font-weight: 600; color: #495057; transition: all 0.3s;">
                    📋 Maliyet Detaylarını Göster/Gizle
                </button>

                <!-- Detay Bölümü (Gizli) -->
                <div id="staffDetailsSection" style="display: none; margin-top: 15px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #dee2e6;">
                    <h3 style="color: #495057; font-size: 15px; margin-bottom: 15px; text-align: center;">💰 PERSONEL MALİYET DETAYLARI</h3>
                    
                    <!-- Asgari Ücretli Detay -->
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">Asgari Ücretli Personel</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staffMinWageCost" readonly value="39.486,68" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staffMinWageCoef" readonly value="43.435,35" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staffMinWageFinal" readonly value="52.122,42" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>

                    <!-- 25k Detay -->
                    <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">25.000₺ Ücretli Personel</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staff25kCost" readonly value="44.082,00" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staff25kCoef" readonly value="48.490,20" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staff25kFinal" readonly value="58.188,24" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>

                    <!-- Yönetici Detay -->
                    <div>
                        <h4 style="color: #6c757d; font-size: 13px; margin-bottom: 10px;">Yönetici</h4>
                        <div class="form-group">
                            <label style="font-size: 12px;">İşverene Maliyet</label>
                            <input type="text" id="staffManagerCost" readonly value="70.435,00" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">Katsayılı (x1.1)</label>
                            <input type="text" id="staffManagerCoef" readonly value="77.478,50" 
                                   style="background-color: #fff; cursor: not-allowed; font-weight: 600; font-size: 13px;">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 12px;">KDV'li + Katsayılı (x1.32)</label>
                            <input type="text" id="staffManagerFinal" readonly value="92.974,20" 
                                   style="background-color: #e7f5e7; cursor: not-allowed; font-weight: 700; color: #28a745; font-size: 13px;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 25px; padding-top: 20px; border-top: 3px solid #667eea;">
                    <label style="color: #667eea; font-size: 16px;">Toplam Personel Sayısı</label>
                    <input type="text" id="staffCountTotal" readonly value="2" 
                           style="background-color: #f0f4ff; cursor: not-allowed; font-weight: 700; font-size: 18px; color: #1e3c72; border: 2px solid #667eea;">
                </div>
                <div class="form-group">
                    <label style="color: #28a745; font-size: 16px;">Toplam Aylık Personel Maliyeti (KDV'li + Katsayılı)</label>
                    <input type="text" id="staffCostTotal" readonly value="104.244,84" 
                           style="background-color: #f0fff4; cursor: not-allowed; font-weight: 700; font-size: 18px; color: #28a745; border: 2px solid #28a745;">
                </div>
            </div>

            <!-- Maliyet ve Giderler -->
            <div class="section">
                <h2>💰 Maliyet ve Giderler</h2>
                <div class="form-group">
                    <label>Yatırım Maliyeti KDV'li (₺) <span class="info-icon" data-tooltip="Otopark sisteminin kurulum maliyeti. Yazılım, donanım, montaj dahil toplam yatırım tutarı (KDV dahil).">i</span></label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="investmentCost" value="1.074.165" 
                               onkeyup="formatNumberInput(this)" 
                               onblur="formatNumberInput(this)"
                               style="flex: 1;">
                        <button type="button" class="action-btn" onclick="openInvestmentBreakdown()" 
                                style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 10px 20px; white-space: nowrap; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            📋 Detaylı Maliyet
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Amortisman Süresi (Ay) <span class="info-icon" data-tooltip="Yatırımın kaç ayda itfa edileceği. Örnek: 36 ay = 3 yıl. Bu sürede yatırım maliyeti aylık gider olarak dağıtılır.">i</span></label>
                    <input type="number" id="amortizationMonths" value="36" min="1" max="120">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Yatırımın kaç ayda itfa edileceği</div>
                </div>
                <div class="form-group">
                    <label>Operasyonel Gider Oranı (%) <span class="info-icon" data-tooltip="Hasılat üzerinden hesaplanan işletme giderleri. Elektrik, su, bakım-onarım, temizlik vb. masraflar için ayrılan oran.">i</span></label>
                    <input type="number" id="operationalRate" value="10" min="0" max="100" step="0.1">
                </div>
                <div class="form-group">
                    <label>Kira Oranı (%) <span class="info-icon" data-tooltip="İşletmeye (AVM/Plaza) ödenen kira oranı. Hasılat üzerinden hesaplanır. Örnek: %35 = Hasılatın %35'i işletmeye ödenir.">i</span></label>
                    <input type="number" id="rentRate" value="35" min="0" max="100" step="0.1">
                </div>
            </div>

            <!-- Abonelikler -->
            <div class="section">
                <h2>👥 ABONELİKLER</h2>
                
                <div class="form-group">
                    <label>Personel Abone Sayısı <span class="info-icon" data-tooltip="İşletmede çalışan personele özel abonelik sayısı. Genellikle indirimli fiyatla verilir.">i</span></label>
                    <input type="number" id="personelSubs" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Personel Abone Fiyatı (Aylık) (₺) <span class="info-icon" data-tooltip="Personel aboneliği aylık ücreti. İşletme personeline verilen özel fiyat.">i</span></label>
                    <input type="number" id="personelPrice" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>Dış Abonelik Sayısı <span class="info-icon" data-tooltip="İşletme dışından (harici müşteriler) alınan aylık abonelik sayısı. Normal fiyattan satılır.">i</span></label>
                    <input type="number" id="externalSubs" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Dış Abonelik Fiyatı (Aylık) (₺) <span class="info-icon" data-tooltip="Harici müşterilere verilen aylık abonelik ücreti. Market fiyatıdır.">i</span></label>
                    <input type="number" id="externalPrice" value="0" min="0">
                </div>
            </div>

            <!-- Hafta İçi Tarifeleri -->
            <div class="section">
                <h2>📅 HAFTAİÇİ TARİFELERİ</h2>

                <div class="form-group">
                    <label>Hafta İçi Satılabilir Kapasite <span class="info-icon" data-tooltip="Hafta içi günlerde satılabilir toplam araç kapasitesi. Fiziksel kapasiteden rezerv ve abonelik alanları düşüldükten sonra kalan sayı.">i</span></label>
                    <input type="number" id="weekdayCapacity" value="1670" min="0" onchange="calculateWeekendCapacity()" onkeyup="calculateWeekendCapacity()">
                </div>
                <div class="form-group">
                    <label>Çalışılan Gün (Aylık) <span class="info-icon" data-tooltip="Bir ayda kaç gün hafta içi çalışıldığı. Genelde 22-23 gün kullanılır (Pzt-Cum toplam).">i</span></label>
                    <input type="number" id="workingDays" value="22" min="1" max="31" onchange="recalculateAllRevenues()" onkeyup="recalculateAllRevenues()">
                </div>

                <div class="time-slot" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 8px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <label style="color: white; font-weight: 700;">⏰ Saat Dilimi</label>
                    <label style="color: white; font-weight: 700;">💰 Tarife</label>
                    <label style="color: white; font-weight: 700;">📊 Kullanım %</label>
                    <label style="color: white; font-weight: 700;">🚗 Park Sayısı</label>
                    <label style="color: white; font-weight: 700;">💵 Hasılat</label>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot1_hours" value="0-3" placeholder="0-3">
                    <input type="number" id="wd_slot1_tariff" value="0" min="0" onchange="calculateParkingCount('wd', 1)" onkeyup="calculateParkingCount('wd', 1)">
                    <input type="number" id="wd_slot1_usage" value="90" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 1)" onkeyup="calculateParkingCount('wd', 1)">
                    <input type="number" id="wd_slot1_parking" value="1503" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot1_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot2_hours" value="3-4" placeholder="3-4">
                    <input type="number" id="wd_slot2_tariff" value="150" min="0" onchange="calculateParkingCount('wd', 2)" onkeyup="calculateParkingCount('wd', 2)">
                    <input type="number" id="wd_slot2_usage" value="7" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 2)" onkeyup="calculateParkingCount('wd', 2)">
                    <input type="number" id="wd_slot2_parking" value="117" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot2_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot3_hours" value="4-5" placeholder="4-5">
                    <input type="number" id="wd_slot3_tariff" value="175" min="0" onchange="calculateParkingCount('wd', 3)" onkeyup="calculateParkingCount('wd', 3)">
                    <input type="number" id="wd_slot3_usage" value="2.19" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 3)" onkeyup="calculateParkingCount('wd', 3)">
                    <input type="number" id="wd_slot3_parking" value="37" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot3_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot4_hours" value="5-6" placeholder="5-6">
                    <input type="number" id="wd_slot4_tariff" value="200" min="0" onchange="calculateParkingCount('wd', 4)" onkeyup="calculateParkingCount('wd', 4)">
                    <input type="number" id="wd_slot4_usage" value="0.77" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 4)" onkeyup="calculateParkingCount('wd', 4)">
                    <input type="number" id="wd_slot4_parking" value="13" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot4_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot5_hours" value="6-12" placeholder="6-12">
                    <input type="number" id="wd_slot5_tariff" value="250" min="0" onchange="calculateParkingCount('wd', 5)" onkeyup="calculateParkingCount('wd', 5)">
                    <input type="number" id="wd_slot5_usage" value="0.02" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 5)" onkeyup="calculateParkingCount('wd', 5)">
                    <input type="number" id="wd_slot5_parking" value="0" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot5_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="wd_slot6_hours" value="12-24" placeholder="12-24">
                    <input type="number" id="wd_slot6_tariff" value="500" min="0" onchange="calculateParkingCount('wd', 6)" onkeyup="calculateParkingCount('wd', 6)">
                    <input type="number" id="wd_slot6_usage" value="0.02" min="0" max="100" step="0.01" onchange="calculateParkingCount('wd', 6)" onkeyup="calculateParkingCount('wd', 6)">
                    <input type="number" id="wd_slot6_parking" value="0" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="wd_slot6_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                
                <!-- Kullanım % Uyarısı (Hafta İçi) -->
                <div id="wd_usage_warning" style="display: none; margin-top: 15px; padding: 15px; border-radius: 8px; font-size: 14px; font-weight: 500;">
                    <!-- JavaScript tarafından doldurulacak -->
                </div>
            </div>

            <!-- Hafta Sonu Tarifeleri -->
            <div class="section">
                <h2>📅 HAFTASONU TARİFELERİ</h2>
                
                <div class="form-group">
                    <label>Hafta Sonu Satılabilir Kapasite <span class="info-icon" data-tooltip="Hafta sonu günlerde satılabilir araç kapasitesi. Otomatik olarak hafta içi kapasitenin 1.5 katı olarak hesaplanır.">i</span></label>
                    <input type="number" id="weekendCapacity" value="2505" min="0" readonly 
                           style="background-color: #f0f4ff; cursor: not-allowed; font-weight: 600; color: #667eea;">
                </div>
                <div class="form-group">
                    <label>Çalışılan Gün (Aylık) <span class="info-icon" data-tooltip="Bir ayda kaç gün hafta sonu çalışıldığı. Genelde 8-9 gün kullanılır (Cmt+Paz toplam).">i</span></label>
                    <input type="number" id="weekendDays" value="8" min="0" max="31" onchange="recalculateAllRevenues()" onkeyup="recalculateAllRevenues()">
                </div>

                <div class="time-slot" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 8px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <label style="color: white; font-weight: 700;">⏰ Saat Dilimi</label>
                    <label style="color: white; font-weight: 700;">💰 Tarife</label>
                    <label style="color: white; font-weight: 700;">📊 Kullanım %</label>
                    <label style="color: white; font-weight: 700;">🚗 Park Sayısı</label>
                    <label style="color: white; font-weight: 700;">💵 Hasılat</label>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot1_hours" value="0-3" placeholder="0-3">
                    <input type="number" id="we_slot1_tariff" value="0" min="0" onchange="calculateParkingCount('we', 1)" onkeyup="calculateParkingCount('we', 1)">
                    <input type="number" id="we_slot1_usage" value="85" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 1)" onkeyup="calculateParkingCount('we', 1)">
                    <input type="number" id="we_slot1_parking" value="1828" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot1_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot2_hours" value="3-4" placeholder="3-4">
                    <input type="number" id="we_slot2_tariff" value="150" min="0" onchange="calculateParkingCount('we', 2)" onkeyup="calculateParkingCount('we', 2)">
                    <input type="number" id="we_slot2_usage" value="9" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 2)" onkeyup="calculateParkingCount('we', 2)">
                    <input type="number" id="we_slot2_parking" value="194" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot2_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot3_hours" value="4-5" placeholder="4-5">
                    <input type="number" id="we_slot3_tariff" value="175" min="0" onchange="calculateParkingCount('we', 3)" onkeyup="calculateParkingCount('we', 3)">
                    <input type="number" id="we_slot3_usage" value="3" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 3)" onkeyup="calculateParkingCount('we', 3)">
                    <input type="number" id="we_slot3_parking" value="65" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot3_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot4_hours" value="5-6" placeholder="5-6">
                    <input type="number" id="we_slot4_tariff" value="200" min="0" onchange="calculateParkingCount('we', 4)" onkeyup="calculateParkingCount('we', 4)">
                    <input type="number" id="we_slot4_usage" value="2" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 4)" onkeyup="calculateParkingCount('we', 4)">
                    <input type="number" id="we_slot4_parking" value="43" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot4_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot5_hours" value="6-12" placeholder="6-12">
                    <input type="number" id="we_slot5_tariff" value="250" min="0" onchange="calculateParkingCount('we', 5)" onkeyup="calculateParkingCount('we', 5)">
                    <input type="number" id="we_slot5_usage" value="0.5" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 5)" onkeyup="calculateParkingCount('we', 5)">
                    <input type="number" id="we_slot5_parking" value="11" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot5_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                <div class="time-slot">
                    <input type="text" id="we_slot6_hours" value="12-24" placeholder="12-24">
                    <input type="number" id="we_slot6_tariff" value="500" min="0" onchange="calculateParkingCount('we', 6)" onkeyup="calculateParkingCount('we', 6)">
                    <input type="number" id="we_slot6_usage" value="0.5" min="0" max="100" step="0.01" onchange="calculateParkingCount('we', 6)" onkeyup="calculateParkingCount('we', 6)">
                    <input type="number" id="we_slot6_parking" value="11" min="0" readonly style="background: #f0f0f0; cursor: not-allowed;">
                    <div class="revenue-display" id="we_slot6_revenue">
                        <div>Günlük: ₺0</div>
                        <small>Aylık: ₺0 | Yıllık: ₺0</small>
                    </div>
                </div>
                
                <!-- Kullanım % Uyarısı (Hafta Sonu) -->
                <div id="we_usage_warning" style="display: none; margin-top: 15px; padding: 15px; border-radius: 8px; font-size: 14px; font-weight: 500;">
                    <!-- JavaScript tarafından doldurulacak -->
                </div>
            </div>

            <!-- Hesapla Butonu -->
            <button class="calculate-btn" onclick="calculate()">📊 <span data-i18n="calculate">FİZİBİLİTE HESAPLA</span></button>

            <!-- Yazdır ve PDF Butonları -->
            <div class="action-buttons">
                <button class="action-btn" onclick="printReport()">
                    🖨️ Yazdır
                </button>
                <button class="action-btn" onclick="downloadPDF()">
                    📥 PDF İndir
                </button>
            </div>

            <!-- Yönetici Raporu Butonu -->
            <button class="manager-report-btn" id="managerReportBtn" onclick="generateManagerReport()">
                📊 Yönetici Özet Raporu Oluştur
            </button>

            <!-- Export Butonları -->
            <div id="exportButtons" style="display: none; margin-top: 15px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="export-btn excel-btn" onclick="exportToExcel()">
                    📊 <span data-i18n="exportExcel">Excel'e Aktar</span>
                </button>
                <button class="export-btn pdf-btn" onclick="exportToPDF()">
                    📄 <span data-i18n="exportPDFCharts">PDF İndir (Grafiklerle)</span>
                </button>
            </div>

            <!-- Paylaşım Butonları -->
            <div id="shareButtons" class="share-section" style="display: none;">
                <button class="share-btn whatsapp" onclick="shareViaWhatsApp()">
                    📱 WhatsApp
                </button>
                <button class="share-btn email" onclick="shareViaEmail()">
                    📧 Email
                </button>
                <button class="share-btn telegram" onclick="shareViaTelegram()">
                    ✈️ Telegram
                </button>
                <button class="share-btn copy" onclick="copyReportLink()">
                    📋 Linki Kopyala
                </button>
            </div>

            <!-- Senaryo Karşılaştırma Sonuçları -->
            <div class="comparison-container" id="comparisonResults" style="display: none; grid-column: 1 / -1;">
                <div class="comparison-header">
                    <h2>⚖️ SENARYO KARŞILAŞTIRMASI</h2>
                    <div id="winnerBadge"></div>
                </div>
                <div id="comparisonContent"></div>
            </div>

            <!-- Notlar & Varsayımlar -->
            <div class="section" style="grid-column: 1 / -1;">
                <div class="notes-section">
                    <div class="notes-header">
                        <h3 style="margin: 0; color: #1e3c72;">📝 Notlar & Varsayımlar</h3>
                        <button onclick="saveNotes()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            💾 Notu Kaydet
                        </button>
                    </div>
                    <textarea id="calculationNotes" class="notes-textarea" placeholder="Hesaplama hakkında notlarınızı, varsayımlarınızı veya özel açıklamalarınızı buraya yazabilirsiniz..."></textarea>
                    <div style="margin-top: 10px; font-size: 12px; color: #6c757d;">
                        💡 Bu notlar hesaplama ile birlikte kaydedilir ve raporlara eklenir.
                    </div>
                </div>
            </div>

            <!-- Live Dashboard -->
            <div class="dashboard-container" id="liveDashboard">
                <div class="dashboard-header">
                    <h2>📊 CANLI DASHBOARD</h2>
                    <p style="margin: 0; opacity: 0.9;">Gerçek Zamanlı Performans Göstergeleri</p>
                </div>
                <div class="dashboard-kpis" id="dashboardKPIs">
                    <!-- KPI'lar buraya gelecek -->
                </div>
            </div>

            <!-- Live Dashboard KPI Cards -->
            <div class="dashboard-container" id="dashboardContainer" style="display: none;">
                <div class="dashboard-header">
                    <h2 style="color: white; margin: 0;">⚡ CANLI GÖSTERGELER</h2>
                    <p style="color: rgba(255,255,255,0.9); margin: 5px 0 0 0; font-size: 14px;">Gerçek Zamanlı Performans Metrikleri</p>
                </div>
                <div class="kpi-grid">
                    <!-- KPI 1: Aylık Net Kar -->
                    <div class="kpi-card" onclick="showKPIDetail('profit')">
                        <div class="kpi-icon">💰</div>
                        <div class="kpi-content">
                            <div class="kpi-label">Aylık Net Kar</div>
                            <div class="kpi-value" id="kpiProfit">₺0</div>
                            <div class="kpi-trend" id="kpiProfitTrend">
                                <span class="trend-icon">↑</span>
                                <span class="trend-percent">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- KPI 2: Kapasite Kullanımı -->
                    <div class="kpi-card" onclick="showKPIDetail('capacity')">
                        <div class="kpi-icon">📊</div>
                        <div class="kpi-content">
                            <div class="kpi-label">Kapasite Kullanımı</div>
                            <div class="kpi-value" id="kpiCapacity">0%</div>
                            <div class="kpi-progress-bar">
                                <div class="kpi-progress-fill" id="kpiCapacityBar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- KPI 3: Verimlilik Skoru -->
                    <div class="kpi-card" onclick="showKPIDetail('efficiency')">
                        <div class="kpi-icon">🎯</div>
                        <div class="kpi-content">
                            <div class="kpi-label">Verimlilik Skoru</div>
                            <div class="kpi-value" id="kpiEfficiency">0/5</div>
                            <div class="kpi-stars" id="kpiStars">
                                ☆☆☆☆☆
                            </div>
                        </div>
                    </div>

                    <!-- KPI 4: ROI Hızı -->
                    <div class="kpi-card" onclick="showKPIDetail('roi')">
                        <div class="kpi-icon">⚡</div>
                        <div class="kpi-content">
                            <div class="kpi-label">ROI Geri Dönüş</div>
                            <div class="kpi-value" id="kpiROI">0 ay</div>
                            <div class="kpi-badge" id="kpiROIBadge">
                                <span>📈</span> Hesaplanıyor...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goal Tracking Widget (Issue #7) -->
            <div class="goal-widget" id="goalWidget" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: white; margin: 0;">🎯 HEDEF TAKİBİ</h3>
                    <button onclick="openGoalSetting()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        ⚙️ Hedef Ayarla
                    </button>
                </div>
                <div id="goalContent">
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: white; font-size: 14px;">Mevcut:</span>
                            <span style="color: white; font-weight: 700;" id="goalCurrent">₺0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="color: white; font-size: 14px;">Hedef:</span>
                            <span style="color: white; font-weight: 700;" id="goalTarget">₺0</span>
                        </div>
                        <div class="goal-progress-bar">
                            <div class="goal-progress-fill" id="goalProgressFill" style="width: 0%;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <span style="color: white; font-size: 20px; font-weight: 700;" id="goalPercent">0%</span>
                        </div>
                        <div id="goalMessage" style="text-align: center; margin-top: 10px; color: white; font-size: 14px; opacity: 0.9;">
                            -
                        </div>
                    </div>
                </div>
            </div>

            <!-- Executive Summary (Issue #6) -->
            <div class="executive-summary" id="executiveSummary" style="display: none;">
                <h2 style="color: #1e3c72; margin: 0 0 20px 0;">📋 YÖNETİCİ ÖZETİ</h2>

                <div class="summary-section tldr">
                    <h3>💡 TL;DR (Kısa Özet)</h3>
                    <p id="tldrText">-</p>
                </div>

                <div class="summary-grid">
                    <div class="summary-section">
                        <h3>💰 Finansal Göstergeler</h3>
                        <ul id="financialMetrics">
                            <li>-</li>
                        </ul>
                    </div>

                    <div class="summary-section">
                        <h3>✅ Öneriler</h3>
                        <ul id="recommendations">
                            <li>-</li>
                        </ul>
                    </div>

                    <div class="summary-section">
                        <h3>⚠️ Risk Faktörleri</h3>
                        <ul id="riskFactors">
                            <li>-</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Sonuçlar -->
            <div class="results" id="results" style="display: none;">
                <h2>📈 FİZİBİLİTE SONUÇLARI</h2>
                <div class="result-grid" id="resultGrid"></div>
            </div>

            <!-- Grafikler Bölümü -->
            <div class="charts-section" id="chartsSection" style="display: none;">
                <h2 style="text-align: center; color: #1e3c72; margin-bottom: 10px;">📊 GRAFİK ANALİZLER</h2>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>📊 Hafta İçi vs Hafta Sonu Hasılat</h3>
                        <div class="chart-wrapper">
                            <canvas id="revenueComparisonChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>🥧 Gider Dağılımı</h3>
                        <div class="chart-wrapper">
                            <canvas id="expenseDistributionChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>📈 Aylık Gelir vs Gider</h3>
                        <div class="chart-wrapper">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>💰 12 Aylık Kar/Zarar Projeksiyonu</h3>
                        <div class="chart-wrapper">
                            <canvas id="yearlyProjectionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Akıllı Öneriler -->
            <div class="recommendations-section" id="recommendationsSection" style="display: none;">
                <div class="recommendations-container">
                    <div class="recommendations-header">
                        <h2>🤖 AKILLI ÖNERİLER & ANALİZ</h2>
                        <p style="margin: 0; opacity: 0.9;">Yapay Zeka Destekli Kar Optimizasyonu</p>
                    </div>
                    <div class="ai-score">
                        <div class="ai-score-circle" id="profitabilityScore">
                            <div class="ai-score-value" id="scoreValue">-</div>
                            <div class="ai-score-label">Karlılık Skoru</div>
                        </div>
                    </div>
                    <div class="recommendations-grid" id="recommendationsGrid">
                        <!-- Öneriler buraya gelecek -->
                    </div>
                </div>
            </div>

            <!-- Yönetici Raporu -->
            <div class="manager-report" id="managerReport">
                <h2>📊 YÖNETİCİ ÖZET RAPORU</h2>
                <div id="managerReportContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Binlik ayraç formatı
        function formatNumberInput(input) {
            let value = input.value.replace(/\./g, '').replace(/,/g, '');
            if (value && !isNaN(value)) {
                input.value = parseInt(value).toLocaleString('tr-TR');
            }
        }


        // Personel detaylarını göster/gizle
        function toggleStaffDetails() {
            const detailsSection = document.getElementById('staffDetailsSection');
            if (detailsSection.style.display === 'none') {
                detailsSection.style.display = 'block';
            } else {
                detailsSection.style.display = 'none';
            }
        }

        // Hafta sonu kapasitesini otomatik hesapla
        function calculateWeekendCapacity() {
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = Math.round(weekdayCapacity * 1.5);
            document.getElementById('weekendCapacity').value = weekendCapacity;
            
            // Kapasite değiştiğinde tüm parklanma sayılarını yeniden hesapla
            recalculateAllParkingCounts();
        }

        // Parklanma sayısını otomatik hesapla (Kapasite × Kullanım % / 100)
        function calculateParkingCount(type, slotNumber) {
            // Kapasite al (wd=hafta içi, we=hafta sonu)
            let capacity;
            if (type === 'wd') {
                capacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            } else {
                capacity = parseFloat(document.getElementById('weekendCapacity').value) || 0;
            }
            
            // Kullanım yüzdesini al
            const usagePercent = parseFloat(document.getElementById(`${type}_slot${slotNumber}_usage`).value) || 0;
            
            // Parklanma sayısını hesapla: Kapasite × (Kullanım % / 100)
            const parkingCount = Math.round(capacity * (usagePercent / 100));
            
            // Sonucu input'a yaz
            document.getElementById(`${type}_slot${slotNumber}_parking`).value = parkingCount;
            
            // Hasılatı hesapla ve göster
            calculateSlotRevenue(type, slotNumber);
            
            // Kullanım % toplamını kontrol et
            validateUsagePercentage(type);
        }

        // Slot hasılatını hesapla ve göster (Günlük/Aylık/Yıllık)
        function calculateSlotRevenue(type, slotNumber) {
            // Tarife ve parklanma sayısını al
            const tariff = parseFloat(document.getElementById(`${type}_slot${slotNumber}_tariff`).value) || 0;
            const parkingCount = parseFloat(document.getElementById(`${type}_slot${slotNumber}_parking`).value) || 0;
            
            // Günlük hasılat: Tarife × Parklanma Sayısı
            const dailyRevenue = tariff * parkingCount;
            
            // Çalışma günlerini al
            let workingDays;
            if (type === 'wd') {
                workingDays = parseFloat(document.getElementById('workingDays').value) || 22;
            } else {
                workingDays = parseFloat(document.getElementById('weekendDays').value) || 8;
            }
            
            const workingMonths = parseFloat(document.getElementById('workingMonths').value) || 12;
            
            // Aylık hasılat: Günlük × Çalışma Günleri
            const monthlyRevenue = dailyRevenue * workingDays;
            
            // Yıllık hasılat: Aylık × Çalışma Ayları
            const yearlyRevenue = monthlyRevenue * workingMonths;
            
            // Revenue display div'ini güncelle
            const revenueDiv = document.getElementById(`${type}_slot${slotNumber}_revenue`);
            if (revenueDiv) {
                revenueDiv.innerHTML = `
                    <div class="daily">${formatCurrency(dailyRevenue)}</div>
                    <span class="period">Ay: ${formatCurrencyShort(monthlyRevenue)} • Yıl: ${formatCurrencyShort(yearlyRevenue)}</span>
                `;
            }
        }

        // Kısa para formatı (K/M için)
        function formatCurrencyShort(value) {
            if (value >= 1000000) {
                return '₺' + (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return '₺' + (value / 1000).toFixed(0) + 'K';
            }
            return formatCurrency(value);
        }

        // Kullanım % toplamını kontrol et (Toplam = 100% olmalı)
        function validateUsagePercentage(type) {
            let total = 0;
            
            // 6 slotun toplamını hesapla
            for (let i = 1; i <= 6; i++) {
                const usage = parseFloat(document.getElementById(`${type}_slot${i}_usage`).value) || 0;
                total += usage;
            }
            
            // Toplam kontrolü
            const typeName = type === 'wd' ? 'Hafta İçi' : 'Hafta Sonu';
            const usageWarning = document.getElementById(`${type}_usage_warning`);
            
            if (!usageWarning) {
                // Warning div yoksa oluştur (ilk çalıştırmada)
                return;
            }
            
            if (Math.abs(total - 100) > 0.01) { // Virgüllü sayı toleransı
                usageWarning.style.display = 'block';
                usageWarning.innerHTML = `
                    ⚠️ <strong>${typeName}</strong> kullanım oranları toplamı <strong>${total.toFixed(2)}%</strong> 
                    (Olması gereken: <strong>100%</strong>)
                `;
                usageWarning.style.background = '#fff3cd';
                usageWarning.style.color = '#856404';
                usageWarning.style.border = '2px solid #ffc107';
            } else {
                usageWarning.style.display = 'block';
                usageWarning.innerHTML = `✅ <strong>${typeName}</strong> kullanım oranları toplamı: <strong>100%</strong> - Doğru!`;
                usageWarning.style.background = '#d4edda';
                usageWarning.style.color = '#155724';
                usageWarning.style.border = '2px solid #28a745';
            }
        }

        // Tüm parklanma sayılarını yeniden hesapla (kapasite değiştiğinde)
        function recalculateAllParkingCounts() {
            // Hafta içi 6 slot
            for (let i = 1; i <= 6; i++) {
                calculateParkingCount('wd', i);
            }
            // Hafta sonu 6 slot
            for (let i = 1; i <= 6; i++) {
                calculateParkingCount('we', i);
            }
        }

        // Tüm hasılatları yeniden hesapla (çalışma günleri değiştiğinde)
        function recalculateAllRevenues() {
            // Hafta içi 6 slot
            for (let i = 1; i <= 6; i++) {
                calculateSlotRevenue('wd', i);
            }
            // Hafta sonu 6 slot
            for (let i = 1; i <= 6; i++) {
                calculateSlotRevenue('we', i);
            }
        }

        // TEMA YÖNETİMİ FONKSİYONLARI
        
        // Çeviri Veritabanı
        const translations = {
            tr: {
                // Header
                title: "PARKEXPERT FİZİBİLİTE HESAPLAMA",
                subtitle: "Otopark Lokasyonu Karlılık Analizi",
                uploadLogo: "Logo Yükle",
                saveCalculation: "Hesaplamayı Kaydet",
                savedCalculations: "Kayıtlı Hesaplamalar",
                color: "Renk",
                selectColor: "Tema Rengi Seç:",
                
                // Scenarios
                scenarioA: "Senaryo A",
                scenarioB: "Senaryo B",
                saveScenario: "Bu Senaryoyu Kaydet",
                compareScenarios: "Senaryoları Karşılaştır",
                clearScenario: "Senaryoyu Temizle",
                activeScenario: "Aktif: Senaryo",
                
                // Buttons
                calculate: "Fizibilite Hesapla",
                print: "Yazdır",
                downloadPDF: "PDF İndir",
                exportExcel: "Excel'e Aktar",
                exportPDFCharts: "PDF İndir (Grafiklerle)",
                generateReport: "Yönetici Özet Raporu Oluştur",
                
                // Sections
                generalInfo: "Genel Bilgiler",
                personnel: "PERSONEL",
                costsExpenses: "Maliyet ve Giderler",
                subscriptions: "ABONELİKLER",
                weekdayRates: "HAFTAİÇİ TARİFELERİ",
                weekendRates: "HAFTASONU TARİFELERİ",
                results: "FİZİBİLİTE SONUÇLARI",
                charts: "GRAFİK ANALİZLER",
                smartRecommendations: "AKILLI ÖNERİLER & ANALİZ",
                aiAnalysis: "Yapay Zeka Destekli Kar Optimizasyonu",
                profitabilityScore: "Karlılık Skoru",
                managerReport: "YÖNETİCİ ÖZET RAPORU"
            },
            en: {
                // Header
                title: "PARKEXPERT FEASIBILITY CALCULATOR",
                subtitle: "Parking Location Profitability Analysis",
                uploadLogo: "Upload Logo",
                saveCalculation: "Save Calculation",
                savedCalculations: "Saved Calculations",
                color: "Color",
                selectColor: "Select Theme Color:",
                
                // Scenarios
                scenarioA: "Scenario A",
                scenarioB: "Scenario B",
                saveScenario: "Save This Scenario",
                compareScenarios: "Compare Scenarios",
                clearScenario: "Clear Scenario",
                activeScenario: "Active: Scenario",
                
                // Buttons
                calculate: "Calculate Feasibility",
                print: "Print",
                downloadPDF: "Download PDF",
                exportExcel: "Export to Excel",
                exportPDFCharts: "Download PDF (with Charts)",
                generateReport: "Generate Manager Summary",
                
                // Sections
                generalInfo: "General Information",
                personnel: "PERSONNEL",
                costsExpenses: "Costs and Expenses",
                subscriptions: "SUBSCRIPTIONS",
                weekdayRates: "WEEKDAY RATES",
                weekendRates: "WEEKEND RATES",
                results: "FEASIBILITY RESULTS",
                charts: "CHART ANALYSIS",
                smartRecommendations: "SMART RECOMMENDATIONS & ANALYSIS",
                aiAnalysis: "AI-Powered Profit Optimization",
                profitabilityScore: "Profitability Score",
                managerReport: "MANAGER SUMMARY REPORT"
            }
        };

        let currentLanguage = 'tr';

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('parkexpert-language', lang);
            
            // Tüm data-i18n attribute'larını güncelle
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    // Input placeholder'lar için
                    if (element.tagName === 'INPUT' && element.placeholder) {
                        element.placeholder = translations[lang][key];
                    } 
                    // Button ve text içerikler için
                    else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Sayfa başlığını güncelle
            document.title = lang === 'tr' ? 
                'Parkexpert - Otopark Fizibilite Hesaplama' : 
                'Parkexpert - Parking Feasibility Calculator';
            
            // Başarım
            unlockAchievement('multilingual');
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('parkexpert-theme', theme);
            
            // Buton durumlarını güncelle
            document.getElementById('lightThemeBtn').classList.toggle('active', theme === 'light');
            document.getElementById('darkThemeBtn').classList.toggle('active', theme === 'dark');
            
            // Başarım
            unlockAchievement('theme_changer');
        }

        function setColor(primary, secondary) {
            document.documentElement.style.setProperty('--primary-color', primary);
            document.documentElement.style.setProperty('--secondary-color', secondary);
            
            // Rengi localStorage'a kaydet
            localStorage.setItem('parkexpert-primary-color', primary);
            localStorage.setItem('parkexpert-secondary-color', secondary);
            
            // Aktif renk seçeneğini işaretle
            document.querySelectorAll('.color-option').forEach(option => {
                const isActive = option.getAttribute('data-primary') === primary;
                option.classList.toggle('active', isActive);
            });
            
            // Menüyü kapat
            setTimeout(() => {
                document.getElementById('colorPickerMenu').classList.remove('active');
            }, 300);
        }

        function toggleColorPicker() {
            document.getElementById('colorPickerMenu').classList.toggle('active');
        }

        // Sayfa dışına tıklayınca renk seçiciyi kapat
        document.addEventListener('click', function(e) {
            const colorPicker = document.querySelector('.color-picker-container');
            if (colorPicker && !colorPicker.contains(e.target)) {
                document.getElementById('colorPickerMenu').classList.remove('active');
            }
        });

        // Personel maliyeti otomatik hesaplama (kategori bazlı)
        function calculateTotalStaffCost() {
            const minWageCount = parseFloat(document.getElementById('staffMinWage').value) || 0;
            const minWageCostFinal = 52122.42; // KDV'li + Katsayılı
            
            const staff25kCount = parseFloat(document.getElementById('staff25k').value) || 0;
            const staff25kCostFinal = 58188.24; // KDV'li + Katsayılı
            
            const managerCount = parseFloat(document.getElementById('staffManager').value) || 0;
            const managerCostFinal = 92974.20; // KDV'li + Katsayılı
            
            const totalCount = minWageCount + staff25kCount + managerCount;
            const totalCost = (minWageCount * minWageCostFinal) + (staff25kCount * staff25kCostFinal) + (managerCount * managerCostFinal);
            
            const totalCostFormatted = totalCost.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            document.getElementById('staffCountTotal').value = totalCount;
            document.getElementById('staffCostTotal').value = totalCostFormatted;
        }

        // Logo yükleme
        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const logoImg = document.getElementById('companyLogo');
                    logoImg.src = event.target.result;
                    logoImg.style.display = 'block';
                    // Logo'yu localStorage'a kaydet
                    localStorage.setItem('parkexpertLogo', event.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Sayfa yüklendiğinde logo'yu kontrol et
        // Analytics tracking function (GLOBAL - her yerden erişilebilir)
        function trackEvent(category, action, label, value) {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    'event_category': category,
                    'event_label': label,
                    'value': value
                });
            }
            // LocalStorage tracking for offline
            const events = JSON.parse(localStorage.getItem('parkexpert-analytics') || '[]');
            events.push({
                category: category,
                action: action,
                label: label,
                value: value,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('parkexpert-analytics', JSON.stringify(events));
        }

        window.addEventListener('load', function() {
            // Tema ve renk tercihlerini yükle
            const savedTheme = localStorage.getItem('parkexpert-theme') || 'light';
            const savedPrimary = localStorage.getItem('parkexpert-primary-color');
            const savedSecondary = localStorage.getItem('parkexpert-secondary-color');
            const savedLanguage = localStorage.getItem('parkexpert-language') || 'tr';
            
            setTheme(savedTheme);
            
            if (savedPrimary && savedSecondary) {
                setColor(savedPrimary, savedSecondary);
            }
            
            // Dil tercihini yükle
            document.getElementById('languageSelector').value = savedLanguage;
            changeLanguage(savedLanguage);
            
            // Logo kontrol
            const savedLogo = localStorage.getItem('parkexpertLogo');
            if (savedLogo) {
                const logoImg = document.getElementById('companyLogo');
                logoImg.src = savedLogo;
                logoImg.style.display = 'block';
            }
            
            // Personel maliyeti hesaplamasını başlat
            calculateTotalStaffCost();
            
            // Hafta sonu kapasitesini hesapla
            calculateWeekendCapacity();
            
            // Başarımları yükle
            loadAchievements();
            
            // Currency'yi yükle
            const savedCurrency = localStorage.getItem('parkexpert-currency');
            if (savedCurrency && savedCurrency !== 'TRY') {
                const symbols = { USD: '$', EUR: '€', GBP: '£' };
                changeCurrency(savedCurrency, symbols[savedCurrency]);
            }
            
            // Hatırlatıcıları kontrol et
            checkReminders();
            setInterval(checkReminders, 60000); // Her dakika kontrol et

            // Multi-user sistem başlat
            initUserSystem();

            // Branding yükle
            loadBranding();

            // PWA Service Worker Register
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('sw.js')
                        .then((registration) => {
                            console.log('✅ PWA: Service Worker registered!', registration.scope);
                            showToast('📱 App modu aktif! Offline çalışabilir', 'success');
                        })
                        .catch((error) => {
                            console.error('❌ PWA: Service Worker registration failed:', error);
                        });
                });
            }

            // Analytics Initialize
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-XXXXXXXXXX'); // Replace with your Google Analytics ID

            // Custom Analytics Events

            // Sayfa yüklendiğinde kullanım % kontrollerini yap
            setTimeout(() => {
                validateUsagePercentage('wd'); // Hafta içi kontrol
                validateUsagePercentage('we'); // Hafta sonu kontrol
                
                // Başlangıç hasılatlarını hesapla
                for (let i = 1; i <= 6; i++) {
                    calculateSlotRevenue('wd', i);
                    calculateSlotRevenue('we', i);
                }
            }, 100);

            console.log('✅ Parkexpert Fizibilite Aracı hazır!');
            
            // Mobile Detection and Setup
            if (isMobileDevice()) {
                document.body.classList.add('mobile-device');
                setupMobileOptimizations();
                console.log('📱 Mobil optimizasyonlar aktif!');
            }
        });

        // Mobile Device Detection
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                   || window.innerWidth <= 768;
        }

        // Setup Mobile Optimizations
        function setupMobileOptimizations() {
            // Disable hover effects on mobile
            document.querySelectorAll('button, .action-btn, .scenario-tab').forEach(el => {
                el.style.transition = 'transform 0.1s ease';
            });

            // Add touch feedback
            document.addEventListener('touchstart', function(e) {
                if (e.target.matches('button, .action-btn, .calculate-btn')) {
                    e.target.style.transform = 'scale(0.98)';
                }
            });

            document.addEventListener('touchend', function(e) {
                if (e.target.matches('button, .action-btn, .calculate-btn')) {
                    setTimeout(() => {
                        e.target.style.transform = 'scale(1)';
                    }, 100);
                }
            });

            // Optimize scroll performance
            let ticking = false;
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    window.requestAnimationFrame(function() {
                        // Handle scroll optimizations
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Prevent accidental zoom on input focus (already handled by font-size: 16px)
            document.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('focus', function() {
                    // Scroll input into view smoothly
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });

            // Add mobile-friendly tooltips
            document.querySelectorAll('[data-tooltip]').forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tooltip = this.getAttribute('data-tooltip');
                    showMobileTooltip(tooltip);
                });
            });
        }

        // Show mobile-friendly tooltip
        function showMobileTooltip(message) {
            showToast('💡 ' + message, 'info');
        }

        // Optimize modal for mobile
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                if (isMobileDevice()) {
                    // Prevent body scroll on mobile when modal is open
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                if (isMobileDevice()) {
                    // Re-enable body scroll
                    document.body.style.overflow = '';
                }
            }
        }

        function printReport() {
            // Önce hesaplama yapılmış mı kontrol et
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                alert('Lütfen önce fizibilite hesaplaması yapın.');
                return;
            }
            window.print();
        }

        function downloadPDF() {
            // Önce hesaplama yapılmış mı kontrol et
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                alert('Lütfen önce fizibilite hesaplaması yapın.');
                return;
            }
            
            // Kullanıcıya PDF olarak kaydetme talimatı
            alert('PDF indirmek için açılacak yazdırma penceresinden "PDF olarak kaydet" seçeneğini seçin.');
            window.print();
        }

        function calculate() {
            // Analytics Tracking
            trackEvent('Calculator', 'calculate', 'New Calculation', 1);

            // Kullanım % kontrolü yap
            let wdTotal = 0;
            let weTotal = 0;
            for (let i = 1; i <= 6; i++) {
                wdTotal += parseFloat(document.getElementById(`wd_slot${i}_usage`).value) || 0;
                weTotal += parseFloat(document.getElementById(`we_slot${i}_usage`).value) || 0;
            }
            
            // Kullanım % toplamı 100 değilse uyar
            if (Math.abs(wdTotal - 100) > 0.01 || Math.abs(weTotal - 100) > 0.01) {
                let warningMessage = '⚠️ DİKKAT:\n\n';
                if (Math.abs(wdTotal - 100) > 0.01) {
                    warningMessage += `Hafta İçi kullanım oranları toplamı: ${wdTotal.toFixed(2)}% (Olması gereken: 100%)\n`;
                }
                if (Math.abs(weTotal - 100) > 0.01) {
                    warningMessage += `Hafta Sonu kullanım oranları toplamı: ${weTotal.toFixed(2)}% (Olması gereken: 100%)\n`;
                }
                warningMessage += '\nHesaplama yapılacak ama sonuçlar hatalı olabilir. Devam etmek istiyor musunuz?';
                
                if (!confirm(warningMessage)) {
                    return; // Kullanıcı iptal ederse hesaplamayı durdur
                }
            }

            // Genel Bilgiler
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = parseFloat(document.getElementById('weekendCapacity').value) || 0;
            const devinim = parseFloat(document.getElementById('devinim').value) || 1;
            const workingDays = parseFloat(document.getElementById('workingDays').value) || 22;
            const workingMonths = parseFloat(document.getElementById('workingMonths').value) || 12;

            // Maliyetler - Yatırım maliyetini formatlanmış halinden parse et
            const investmentCostValue = document.getElementById('investmentCost').value.replace(/\./g, '').replace(/,/g, '.');
            const investmentCost = parseFloat(investmentCostValue) || 0;
            
            const operationalRate = parseFloat(document.getElementById('operationalRate').value) || 10;
            const rentRate = parseFloat(document.getElementById('rentRate').value) || 35;
            
            // Personel maliyeti - Toplam değerleri kullan
            const staffCount = parseFloat(document.getElementById('staffCountTotal').value) || 0;
            const staffCostTotalValue = document.getElementById('staffCostTotal').value.replace(/\./g, '').replace(/,/g, '.');
            const monthlyStaffCost = parseFloat(staffCostTotalValue) || 0;

            // Abonelik Hesaplamaları (Sadece Personel ve Dış)
            const personelSubs = parseFloat(document.getElementById('personelSubs').value) || 0;
            const personelPrice = parseFloat(document.getElementById('personelPrice').value) || 0;
            const externalSubs = parseFloat(document.getElementById('externalSubs').value) || 0;
            const externalPrice = parseFloat(document.getElementById('externalPrice').value) || 0;

            const monthlySubRevenue = (personelSubs * personelPrice) + (externalSubs * externalPrice);

            // Hafta İçi Saat Dilimi Hesaplamaları
            let weekdayDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`wd_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`wd_slot${i}_parking`).value) || 0;
                weekdayDailyRevenue += tariff * parking;
            }

            // Hafta Sonu Hesaplamaları
            const weekendDays = parseFloat(document.getElementById('weekendDays').value) || 8;

            // Hafta Sonu Saat Dilimi Hesaplamaları
            let weekendDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`we_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`we_slot${i}_parking`).value) || 0;
                weekendDailyRevenue += tariff * parking;
            }

            // Günlük ve Aylık Toplam Hesaplamaları
            const dailyTotalRevenue = weekdayDailyRevenue + weekendDailyRevenue;
            
            const weekdayMonthlyRevenue = (weekdayDailyRevenue * workingDays);
            const weekdayYearlyRevenue = weekdayMonthlyRevenue * workingMonths;

            const weekendMonthlyRevenue = (weekendDailyRevenue * weekendDays);
            const weekendYearlyRevenue = weekendMonthlyRevenue * workingMonths;

            const totalMonthlyRevenue = weekdayMonthlyRevenue + weekendMonthlyRevenue + monthlySubRevenue;
            const totalYearlyRevenue = totalMonthlyRevenue * workingMonths;

            // Amortisman hesaplaması
            const amortizationMonths = parseFloat(document.getElementById('amortizationMonths').value) || 36;
            const monthlyAmortization = investmentCost / amortizationMonths;
            const amortizationPercentage = totalMonthlyRevenue > 0 ? (monthlyAmortization / totalMonthlyRevenue) * 100 : 0;

            // Gider Hesaplamaları
            // monthlyStaffCost zaten toplam maliyet (kategorilerin toplamı)
            const yearlyStaffCost = monthlyStaffCost * 12;
            const staffCostPercentage = (monthlyStaffCost / totalMonthlyRevenue) * 100;

            const monthlyOperationalCost = (totalMonthlyRevenue * operationalRate) / 100;
            const yearlyOperationalCost = monthlyOperationalCost * 12;

            const monthlyRent = (totalMonthlyRevenue * rentRate) / 100;
            const yearlyRent = monthlyRent * 12;

            const totalMonthlyExpenses = monthlyStaffCost + monthlyOperationalCost + monthlyRent;
            const totalYearlyExpenses = yearlyStaffCost + yearlyOperationalCost + yearlyRent;
            const totalExpensesPercentage = (totalMonthlyExpenses / totalMonthlyRevenue) * 100;

            // Net Kar/Zarar
            const monthlyNetProfit = totalMonthlyRevenue - totalMonthlyExpenses;
            const yearlyNetProfit = totalYearlyRevenue - totalYearlyExpenses;
            const netProfitPercentage = (monthlyNetProfit / totalMonthlyRevenue) * 100;

            // Yatırım Geri Dönüş Süresi (Ay)
            const paybackPeriod = monthlyNetProfit > 0 ? investmentCost / monthlyNetProfit : 0;

            // Sonuçları Göster
            const resultsDiv = document.getElementById('results');
            const resultGrid = document.getElementById('resultGrid');
            
            resultsDiv.style.display = 'block';
            
            const profitClass = monthlyNetProfit > 0 ? 'positive' : 'negative';
            const yearlyProfitClass = yearlyNetProfit > 0 ? 'positive' : 'negative';

            resultGrid.innerHTML = `
                <div class="result-card">
                    <h3>Hafta İçi Günlük Hasılat</h3>
                    <div class="value">${formatCurrency(weekdayDailyRevenue)}</div>
                    <div class="small-text">Hafta İçi Aylık: ${formatCurrency(weekdayMonthlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Hafta Sonu Günlük Hasılat</h3>
                    <div class="value">${formatCurrency(weekendDailyRevenue)}</div>
                    <div class="small-text">Hafta Sonu Aylık: ${formatCurrency(weekendMonthlyRevenue)}</div>
                </div>
                <div class="result-card warning">
                    <h3>Günlük Toplam Hasılat</h3>
                    <div class="value">${formatCurrency(dailyTotalRevenue)}</div>
                    <div class="small-text">Aylık Toplam: ${formatCurrency(weekdayMonthlyRevenue + weekendMonthlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Abonelik Hasılatı</h3>
                    <div class="value">${formatCurrency(monthlySubRevenue)}</div>
                    <div class="small-text">Personel + Dış Abonelik</div>
                </div>
                <div class="result-card warning">
                    <h3>Aylık Toplam Hasılat</h3>
                    <div class="value">${formatCurrency(totalMonthlyRevenue)}</div>
                    <div class="small-text">Yıllık: ${formatCurrency(totalYearlyRevenue)}</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Personel Maliyeti</h3>
                    <div class="value">${formatCurrency(monthlyStaffCost)}</div>
                    <div class="small-text">${staffCount} Personel (İşverene Toplam) • %${staffCostPercentage.toFixed(1)} Oran</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Operasyonel Gider</h3>
                    <div class="value">${formatCurrency(monthlyOperationalCost)}</div>
                    <div class="small-text">%${operationalRate} Oranında</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Toplam Gider</h3>
                    <div class="value">${formatCurrency(totalMonthlyExpenses)}</div>
                    <div class="small-text">%${totalExpensesPercentage.toFixed(1)} Oran • Yıllık: ${formatCurrency(totalYearlyExpenses)}</div>
                </div>
                <div class="result-card ${paybackPeriod < 24 ? 'positive' : paybackPeriod < 48 ? 'warning' : 'negative'}">
                    <h3>Yatırım Geri Dönüş</h3>
                    <div class="value">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay' : 'Belirsiz'}</div>
                    <div class="small-text">${paybackPeriod > 0 ? (paybackPeriod/12).toFixed(1) + ' yıl' : ''}</div>
                </div>
                <div class="result-card">
                    <h3>Yatırım Maliyeti</h3>
                    <div class="value">${formatCurrency(investmentCost)}</div>
                    <div class="small-text">KDV Dahil</div>
                </div>
                <div class="result-card">
                    <h3>Aylık Amortisman Payı</h3>
                    <div class="value">${formatCurrency(monthlyAmortization)}</div>
                    <div class="small-text">${amortizationMonths} Ay • %${amortizationPercentage.toFixed(1)} Oran</div>
                </div>
                <div class="result-card">
                    <h3>Hafta İçi Kapasite</h3>
                    <div class="value">${weekdayCapacity}</div>
                    <div class="small-text">Satılabilir Park Yeri</div>
                </div>
                <div class="result-card">
                    <h3>Hafta Sonu Kapasite</h3>
                    <div class="value">${weekendCapacity}</div>
                    <div class="small-text">x1.5 Otomatik</div>
                </div>
                <div class="result-card">
                    <h3>Devinim</h3>
                    <div class="value">${devinim.toFixed(2)}</div>
                    <div class="small-text">Park Dönüş Oranı</div>
                </div>
                <div class="result-card">
                    <h3>Toplam Abone</h3>
                    <div class="value">${personelSubs + externalSubs}</div>
                    <div class="small-text">Personel + Dış Abonelik</div>
                </div>
                
                <div class="comparison-section">
                    <div class="result-card-large rent-card">
                        <h3>🏢 İşletmeye Ödenen Kira</h3>
                        <div class="value">${formatCurrency(monthlyRent)}</div>
                        <div class="small-text">%${rentRate} Oranı • Yıllık: ${formatCurrency(yearlyRent)}</div>
                    </div>
                    <div class="result-card-large profit-card ${profitClass}">
                        <h3>💼 Bize Kalan Net Kar</h3>
                        <div class="value">${formatCurrency(monthlyNetProfit)}</div>
                        <div class="small-text">${monthlyNetProfit > 0 ? '✅ Karlı' : '❌ Zararlı'} • %${Math.abs(netProfitPercentage).toFixed(1)} Oran • Yıllık: ${formatCurrency(yearlyNetProfit)}</div>
                    </div>
                </div>
            `;

            // Yönetici raporu butonunu göster
            document.getElementById('managerReportBtn').style.display = 'block';
            
            // Export butonlarını göster
            document.getElementById('exportButtons').style.display = 'flex';
            
            // Paylaşım butonlarını göster
            document.getElementById('shareButtons').style.display = 'flex';
            
            // Grafikleri göster ve oluştur
            document.getElementById('chartsSection').style.display = 'block';
            createCharts(weekdayDailyRevenue, weekdayMonthlyRevenue, weekendDailyRevenue, weekendMonthlyRevenue, 
                        monthlySubRevenue, totalMonthlyRevenue, monthlyStaffCost, monthlyOperationalCost, 
                        monthlyRent, totalMonthlyExpenses, monthlyNetProfit);

            // Akıllı öneriler oluştur
            document.getElementById('recommendationsSection').style.display = 'block';
            generateSmartRecommendations({
                totalRevenue: totalMonthlyRevenue,
                totalExpenses: totalMonthlyExpenses,
                netProfit: monthlyNetProfit,
                staffCost: monthlyStaffCost,
                staffCount: staffCount,
                opCost: monthlyOperationalCost,
                rent: monthlyRent,
                weekdayCapacity: weekdayCapacity,
                weekendCapacity: weekendCapacity,
                devinim: devinim,
                rentRate: rentRate,
                operationalRate: operationalRate
            });

            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Dashboard'u güncelle (eski)
            updateLiveDashboard({
                totalRevenue: totalMonthlyRevenue,
                netProfit: monthlyNetProfit,
                profitMargin: (monthlyNetProfit / totalMonthlyRevenue) * 100,
                capacity: weekdayCapacity,
                devinim: devinim,
                staffCount: staffCount
            });

            // Yeni Dashboard'u güncelle
            updateDashboard({
                totalRevenue: totalMonthlyRevenue,
                netProfit: monthlyNetProfit,
                profitMargin: (monthlyNetProfit / totalMonthlyRevenue) * 100,
                capacity: weekdayCapacity,
                weekendCapacity: weekendCapacity,
                devinim: devinim,
                staffCount: staffCount,
                paybackPeriod: paybackPeriod,
                totalExpenses: totalMonthlyExpenses
            });

            // Executive Summary göster
            generateExecutiveSummary({
                netProfit: monthlyNetProfit,
                totalRevenue: totalMonthlyRevenue,
                totalExpenses: totalMonthlyExpenses,
                profitMargin: (monthlyNetProfit / totalMonthlyRevenue) * 100,
                paybackPeriod: paybackPeriod,
                devinim: devinim,
                rentRate: rentRate,
                staffCost: monthlyStaffCost
            });

            // Goal Tracking Widget güncelle
            updateGoalWidget(monthlyNetProfit);

            // Profitability Score hesapla
            const profitMargin = (monthlyNetProfit / totalMonthlyRevenue) * 100;
            let profitabilityScore = 0;
            if (profitMargin > 30) profitabilityScore = 95;
            else if (profitMargin > 20) profitabilityScore = 85;
            else if (profitMargin > 15) profitabilityScore = 75;
            else if (profitMargin > 10) profitabilityScore = 65;
            else if (profitMargin > 5) profitabilityScore = 50;
            else if (profitMargin > 0) profitabilityScore = 35;
            else profitabilityScore = 15;

            // Başarımları kontrol et
            checkAchievements(monthlyNetProfit, profitabilityScore);
        }

        // CANLI DASHBOARD
        function updateLiveDashboard(data) {
            document.getElementById('liveDashboard').classList.add('active');
            
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-icon">💰</div>
                    <div class="kpi-value">${formatCurrency(data.netProfit)}</div>
                    <div class="kpi-label">Net Kar</div>
                    <div class="kpi-trend ${data.netProfit > 0 ? 'up' : 'down'}">
                        ${data.netProfit > 0 ? '↗️' : '↘️'} ${data.profitMargin.toFixed(1)}%
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">📈</div>
                    <div class="kpi-value">${formatCurrency(data.totalRevenue)}</div>
                    <div class="kpi-label">Toplam Gelir</div>
                    <div class="kpi-trend up">↗️ Aylık</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">🅿️</div>
                    <div class="kpi-value">${data.capacity}</div>
                    <div class="kpi-label">Kapasite</div>
                    <div class="kpi-trend up">🔄 x${data.devinim}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">👥</div>
                    <div class="kpi-value">${data.staffCount}</div>
                    <div class="kpi-label">Personel</div>
                    <div class="kpi-trend ${data.staffCount < 5 ? 'up' : 'down'}">
                        ${data.staffCount < 5 ? '✅ Optimal' : '⚠️ Yüksek'}
                    </div>
                </div>
            `;
            
            document.getElementById('dashboardKPIs').innerHTML = kpisHTML;
        }

        // YENİ DASHBOARD GÜNCELLEME (Issue #2)
        function updateDashboard(data) {
            // Dashboard'u göster
            const dashboardContainer = document.getElementById('dashboardContainer');
            dashboardContainer.style.display = 'block';

            // KPI 1: Aylık Net Kar
            const profitElement = document.getElementById('kpiProfit');
            animateNumber(profitElement, data.netProfit, true);

            const profitTrend = document.getElementById('kpiProfitTrend');
            const profitChange = data.profitMargin;
            profitTrend.innerHTML = `
                <span class="trend-icon">${profitChange > 0 ? '↑' : '↓'}</span>
                <span class="trend-percent">${Math.abs(profitChange).toFixed(1)}%</span>
            `;
            profitTrend.className = `kpi-trend ${profitChange > 0 ? 'up' : 'down'}`;

            // KPI 2: Kapasite Kullanımı
            const capacityPercent = Math.min((data.devinim / 3) * 100, 100); // Max 3 devinim = %100
            document.getElementById('kpiCapacity').textContent = `${capacityPercent.toFixed(0)}%`;

            const capacityBar = document.getElementById('kpiCapacityBar');
            capacityBar.style.width = `${capacityPercent}%`;
            capacityBar.className = 'kpi-progress-fill';
            if (capacityPercent < 50) capacityBar.classList.add('low');
            else if (capacityPercent < 80) capacityBar.classList.add('medium');
            else capacityBar.classList.add('high');

            // KPI 3: Verimlilik Skoru
            const efficiencyScore = calculateEfficiencyScore(data);
            document.getElementById('kpiEfficiency').textContent = `${efficiencyScore}/5`;

            const stars = '★'.repeat(efficiencyScore) + '☆'.repeat(5 - efficiencyScore);
            document.getElementById('kpiStars').textContent = stars;

            // KPI 4: ROI Hızı
            const roiMonths = Math.ceil(data.paybackPeriod);
            document.getElementById('kpiROI').textContent = `${roiMonths} ay`;

            const roiBadge = document.getElementById('kpiROIBadge');
            let badgeClass = 'kpi-badge';
            let badgeText = '';

            if (roiMonths <= 12) {
                badgeClass += ' excellent';
                badgeText = '<span>🚀</span> Mükemmel';
            } else if (roiMonths <= 24) {
                badgeClass += ' good';
                badgeText = '<span>✅</span> İyi';
            } else if (roiMonths <= 36) {
                badgeClass += '';
                badgeText = '<span>📈</span> Kabul Edilebilir';
            } else {
                badgeClass += ' poor';
                badgeText = '<span>⚠️</span> Yavaş';
            }

            roiBadge.className = badgeClass;
            roiBadge.innerHTML = badgeText;
        }

        // Verimlilik skoru hesaplama (1-5 yıldız)
        function calculateEfficiencyScore(data) {
            let score = 0;

            // Kar marjı (max 2 puan)
            if (data.profitMargin > 25) score += 2;
            else if (data.profitMargin > 15) score += 1.5;
            else if (data.profitMargin > 5) score += 1;
            else if (data.profitMargin > 0) score += 0.5;

            // Devinim (max 2 puan)
            if (data.devinim > 2.5) score += 2;
            else if (data.devinim > 1.8) score += 1.5;
            else if (data.devinim > 1.2) score += 1;
            else score += 0.5;

            // ROI hızı (max 1 puan)
            if (data.paybackPeriod <= 12) score += 1;
            else if (data.paybackPeriod <= 24) score += 0.5;

            return Math.min(Math.round(score), 5);
        }

        // Sayı animasyonu
        function animateNumber(element, targetValue, isCurrency = false) {
            const duration = 1000; // 1 saniye
            const steps = 30;
            const stepDuration = duration / steps;
            const increment = targetValue / steps;
            let currentValue = 0;

            const interval = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(interval);
                }

                if (isCurrency) {
                    element.textContent = formatCurrency(currentValue);
                } else {
                    element.textContent = Math.round(currentValue);
                }
            }, stepDuration);
        }

        // KPI Detay Modal (basit alert)
        function showKPIDetail(type) {
            const messages = {
                profit: '💰 AYLIK NET KAR\n\nToplam gelir - toplam giderler sonucu elde edilen net kar tutarı.\n\nYüksek kar marjı işletmenin sağlıklı olduğunu gösterir.',
                capacity: '📊 KAPASİTE KULLANIMI\n\nOtopark kapasitesinin ne kadar verimli kullanıldığını gösterir.\n\nYüksek devinim = daha fazla gelir.\nHedef: %80+ kullanım oranı',
                efficiency: '🎯 VERİMLİLİK SKORU\n\nKar marjı, devinim ve ROI hızına göre hesaplanan genel verimlilik puanı.\n\n5 yıldız = Mükemmel\n3-4 yıldız = İyi\n1-2 yıldız = Geliştirilmeli',
                roi: '⚡ ROI GERİ DÖNÜŞ\n\nYatırımın kendini amorti etme süresi.\n\n≤12 ay = Mükemmel\n12-24 ay = İyi\n24-36 ay = Kabul Edilebilir\n>36 ay = Risk'
            };

            alert(messages[type] || 'Bilgi bulunamadı');
        }

        // EXECUTIVE SUMMARY (Issue #6)
        function generateExecutiveSummary(data) {
            const summaryDiv = document.getElementById('executiveSummary');
            summaryDiv.style.display = 'block';

            // TL;DR
            let tldr = '';
            if (data.netProfit > 0) {
                if (data.profitMargin > 20) {
                    tldr = `🚀 YÜKSEK KARLI: Aylık ${formatCurrency(data.netProfit)} net kar ile çok karlı bir işletme. ROI ${Math.ceil(data.paybackPeriod)} ay.`;
                } else if (data.profitMargin > 10) {
                    tldr = `✅ KARLI: Aylık ${formatCurrency(data.netProfit)} net kar. Sağlıklı bir işletme. ROI ${Math.ceil(data.paybackPeriod)} ay.`;
                } else {
                    tldr = `⚠️ DÜŞÜK KARLI: Aylık ${formatCurrency(data.netProfit)} net kar. Kar marjı düşük, optimizasyon gerekli.`;
                }
            } else {
                tldr = `❌ ZARARLI: Aylık ${formatCurrency(Math.abs(data.netProfit))} zarar. Acil önlem gerekli! İşletme sürdürülebilir değil.`;
            }
            document.getElementById('tldrText').textContent = tldr;

            // Finansal Göstergeler
            const metrics = [
                `💰 Net Kar Marjı: %${data.profitMargin.toFixed(1)}`,
                `📊 Toplam Gelir: ${formatCurrency(data.totalRevenue)}`,
                `💸 Toplam Gider: ${formatCurrency(data.totalExpenses)}`,
                `⚡ ROI Süresi: ${Math.ceil(data.paybackPeriod)} ay (${(data.paybackPeriod/12).toFixed(1)} yıl)`
            ];
            document.getElementById('financialMetrics').innerHTML = metrics.map(m => `<li>${m}</li>`).join('');

            // Öneriler
            const recommendations = [];
            if (data.devinim < 1.5) {
                recommendations.push('Devinim oranını artırın: Pazarlama ve fiyatlandırma stratejileri geliştirin');
            }
            if (data.profitMargin < 15) {
                recommendations.push('Giderleri optimize edin: Personel ve operasyonel maliyetleri gözden geçirin');
            }
            if (data.rentRate > 35) {
                recommendations.push('Kira oranını düşürün: Mülk sahibi ile yeniden müzakere edin');
            }
            if (recommendations.length === 0) {
                recommendations.push('Mevcut performansı koruyun ve büyüme fırsatları arayın');
                recommendations.push('Kapasite artırımı değerlendirin');
                recommendations.push('Ek hizmetler (abonelik, valet) ekleyin');
            }
            document.getElementById('recommendations').innerHTML = recommendations.map(r => `<li>${r}</li>`).join('');

            // Risk Faktörleri
            const risks = [];
            if (data.netProfit < 0) {
                risks.push('🔴 Zarar durumu: İşletme sürdürülebilir değil');
            }
            if (data.paybackPeriod > 36) {
                risks.push('🟡 Uzun ROI süresi: Yatırım geri dönüşü yavaş');
            }
            if (data.profitMargin < 5) {
                risks.push('🟡 Düşük kar marjı: Ani maliyetlere karşı savunmasız');
            }
            if (data.staffCost / data.totalRevenue > 0.3) {
                risks.push('🟡 Yüksek personel maliyeti: Toplam gelirin %30\'undan fazla');
            }
            if (risks.length === 0) {
                risks.push('🟢 Önemli risk tespit edilmedi');
                risks.push('🟢 Finansal göstergeler sağlıklı');
                risks.push('🟢 İşletme sürdürülebilir görünüyor');
            }
            document.getElementById('riskFactors').innerHTML = risks.map(r => `<li>${r}</li>`).join('');
        }

        // GOAL TRACKING WIDGET (Issue #7)
        function updateGoalWidget(currentProfit) {
            const goalData = JSON.parse(localStorage.getItem('parkexpert-goal') || '{}');

            if (!goalData.target) {
                document.getElementById('goalWidget').style.display = 'none';
                return;
            }

            document.getElementById('goalWidget').style.display = 'block';
            document.getElementById('goalCurrent').textContent = formatCurrency(currentProfit);
            document.getElementById('goalTarget').textContent = formatCurrency(goalData.target);

            const percentage = Math.min((currentProfit / goalData.target) * 100, 100);
            document.getElementById('goalPercent').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('goalProgressFill').style.width = `${percentage}%`;

            // Mesaj
            let message = '';
            if (percentage >= 100) {
                message = '🎉 Tebrikler! Hedefinize ulaştınız!';
                // Konfeti efekti (basit)
                showToast('🎉 Hedef tamamlandı!', 'success');
            } else if (percentage >= 75) {
                message = '🔥 Harika gidiyorsunuz! Hedefe yakınsınız!';
            } else if (percentage >= 50) {
                message = '💪 İyi ilerleme! Yarı yoldasınız!';
            } else if (percentage >= 25) {
                message = '📈 İlerleme var, devam edin!';
            } else {
                message = '🎯 Hedefe ulaşmak için daha fazla çalışın!';
            }
            document.getElementById('goalMessage').textContent = message;
        }

        // AKILLI ÖNERİLER FONKSİYONU
        function generateSmartRecommendations(data) {
            const recommendations = [];
            
            // Karlılık skorunu hesapla (0-100)
            const profitMargin = (data.netProfit / data.totalRevenue) * 100;
            let profitabilityScore = 0;
            
            if (profitMargin > 30) profitabilityScore = 95;
            else if (profitMargin > 20) profitabilityScore = 85;
            else if (profitMargin > 15) profitabilityScore = 75;
            else if (profitMargin > 10) profitabilityScore = 65;
            else if (profitMargin > 5) profitabilityScore = 50;
            else if (profitMargin > 0) profitabilityScore = 35;
            else profitabilityScore = 15;
            
            // Skoru göster
            const scoreElement = document.getElementById('scoreValue');
            scoreElement.textContent = profitabilityScore;
            scoreElement.style.color = profitabilityScore >= 70 ? '#28a745' : profitabilityScore >= 50 ? '#ffc107' : '#dc3545';
            
            // 1. Personel Optimizasyonu
            const staffCostPercentage = (data.staffCost / data.totalRevenue) * 100;
            if (staffCostPercentage > 30) {
                const savings = data.staffCost * 0.1; // %10 azaltma
                const newProfit = data.netProfit + savings;
                const improvement = ((newProfit - data.netProfit) / data.netProfit * 100).toFixed(1);
                
                recommendations.push({
                    type: 'warning',
                    icon: '👥',
                    title: 'Personel Maliyeti Yüksek',
                    desc: `Personel maliyetiniz hasılatın %${staffCostPercentage.toFixed(1)}'ini oluşturuyor. Sektör ortalaması %20-25 arasıdır.`,
                    impact: `1 personeli azaltarak aylık ${formatCurrency(savings)} tasarruf edebilir, net karı %${improvement} artırabilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (staffCostPercentage < 15 && data.staffCount < 3) {
                recommendations.push({
                    type: 'positive',
                    icon: '✅',
                    title: 'Personel Maliyeti Optimal',
                    desc: `Personel maliyetiniz hasılatın %${staffCostPercentage.toFixed(1)}'i ile ideal seviyede.`,
                    impact: 'Mevcut personel yapınızı koruyun.',
                    impactType: 'positive'
                });
            }
            
            // 2. Kira Optimizasyonu
            const rentPercentage = (data.rent / data.totalRevenue) * 100;
            if (data.rentRate > 40) {
                const newRent = data.totalRevenue * 0.35;
                const savings = data.rent - newRent;
                const improvement = ((savings / data.netProfit) * 100).toFixed(1);
                
                recommendations.push({
                    type: 'critical',
                    icon: '🏢',
                    title: 'Kira Oranı Çok Yüksek',
                    desc: `%${data.rentRate} kira oranı sürdürülebilir değil. Sektör standardı %30-35 arasıdır.`,
                    impact: `Kira oranını %35'e düşürerek aylık ${formatCurrency(savings)} tasarruf edip net karı %${improvement} artırabilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (rentPercentage < 30) {
                recommendations.push({
                    type: 'positive',
                    icon: '✨',
                    title: 'Kira Maliyeti Mükemmel',
                    desc: `%${data.rentRate} kira oranı rekabetçi ve sürdürülebilir.`,
                    impact: 'Mevcut anlaşmanızı korumaya devam edin.',
                    impactType: 'positive'
                });
            }
            
            // 3. Kapasite Kullanımı
            if (data.devinim < 1.2) {
                const potentialRevenue = data.totalRevenue * 1.25;
                const improvement = potentialRevenue - data.totalRevenue;
                
                recommendations.push({
                    type: 'warning',
                    icon: '📊',
                    title: 'Düşük Kapasite Kullanımı',
                    desc: `Devinim oranınız ${data.devinim} ile düşük. Her park yeri günde daha fazla kullanılmalı.`,
                    impact: `Devrinimi 1.5'e çıkararak aylık ${formatCurrency(improvement)} ek gelir elde edebilirsiniz.`,
                    impactType: 'positive'
                });
            } else if (data.devinim > 1.8) {
                recommendations.push({
                    type: 'positive',
                    icon: '🎯',
                    title: 'Yüksek Kapasite Kullanımı',
                    desc: `Devinim oranınız ${data.devinim} ile mükemmel! Kapasiteyi verimli kullanıyorsunuz.`,
                    impact: 'Kapasite genişletme düşünebilirsiniz.',
                    impactType: 'positive'
                });
            }
            
            // 4. Karlılık Analizi
            if (data.netProfit < 0) {
                const breakeven = data.totalExpenses;
                const needed = breakeven - data.totalRevenue;
                
                recommendations.push({
                    type: 'critical',
                    icon: '⚠️',
                    title: 'Zarar Durumu - Acil Önlem Gerekli',
                    desc: `Aylık ${formatCurrency(Math.abs(data.netProfit))} zarar ediyorsunuz. İşletme sürdürülebilir değil.`,
                    impact: `Başa baş noktası için aylık ${formatCurrency(needed)} ek hasılat gerekiyor veya giderleri azaltın.`,
                    impactType: 'negative'
                });
            } else if (profitMargin > 25) {
                recommendations.push({
                    type: 'positive',
                    icon: '🚀',
                    title: 'Mükemmel Karlılık',
                    desc: `%${profitMargin.toFixed(1)} kar marjı ile sektörün üzerinde performans gösteriyorsunuz.`,
                    impact: 'Yeni lokasyon yatırımları değerlendirin!',
                    impactType: 'positive'
                });
            }
            
            // 5. Operasyonel Verimlilik
            const opPercentage = (data.opCost / data.totalRevenue) * 100;
            if (opPercentage > 15) {
                const savings = data.opCost * 0.2;
                
                recommendations.push({
                    type: 'warning',
                    icon: '⚙️',
                    title: 'Operasyonel Giderler Yüksek',
                    desc: `%${data.operationalRate} operasyonel gider oranı yüksek. Optimizasyon fırsatları var.`,
                    impact: `Enerji tasarrufu ve bakım optimizasyonu ile aylık ${formatCurrency(savings)} tasarruf potansiyeli.`,
                    impactType: 'positive'
                });
            }
            
            // 6. Hafta Sonu Potansiyeli
            const weekendPotential = data.weekendCapacity * 1.1; // %10 artış
            if (data.weekendCapacity > data.weekdayCapacity * 1.3) {
                recommendations.push({
                    type: 'positive',
                    icon: '📅',
                    title: 'Hafta Sonu Avantajı',
                    desc: `Hafta sonu kapasitesi yüksek! Bu büyük bir fırsat.`,
                    impact: 'Hafta sonu özel tarifeleri ve kampanyaları değerlendirin.',
                    impactType: 'positive'
                });
            }
            
            // Önerileri ekle
            const grid = document.getElementById('recommendationsGrid');
            grid.innerHTML = recommendations.map(rec => `
                <div class="recommendation-card ${rec.type}">
                    <div class="recommendation-icon">${rec.icon}</div>
                    <div class="recommendation-title">${rec.title}</div>
                    <div class="recommendation-desc">${rec.desc}</div>
                    <div class="recommendation-impact ${rec.impactType}">
                        ${rec.impactType === 'positive' ? '💡 ' : '⚠️ '}${rec.impact}
                    </div>
                </div>
            `).join('');
        }

        // Grafik Oluşturma Fonksiyonu
        let chartInstances = {};

        // Senaryo Yönetimi
        let currentScenario = 'A';
        let scenarioA = null;
        let scenarioB = null;
        let scenarioAResults = null;
        let scenarioBResults = null;

        // Para Birimi Yönetimi
        let currentCurrency = 'TRY';
        let currentCurrencySymbol = '₺';
        const exchangeRates = {
            TRY: 1,
            USD: 35.5,
            EUR: 38.2,
            GBP: 45.1
        };

        function createCharts(weekdayDaily, weekdayMonthly, weekendDaily, weekendMonthly, subRevenue, 
                             totalRevenue, staffCost, opCost, rent, totalExpenses, netProfit) {
            
            // Eski grafikleri temizle
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            chartInstances = {};

            // 1. Hafta İçi vs Hafta Sonu Hasılat Karşılaştırması
            const ctx1 = document.getElementById('revenueComparisonChart');
            if (ctx1) {
                chartInstances.revenueComparison = new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: ['Günlük Hasılat', 'Aylık Hasılat'],
                        datasets: [{
                            label: 'Hafta İçi',
                            data: [weekdayDaily, weekdayMonthly],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Hafta Sonu',
                            data: [weekendDaily, weekendMonthly],
                            backgroundColor: 'rgba(118, 75, 162, 0.8)',
                            borderColor: 'rgba(118, 75, 162, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 2. Gider Dağılımı (Pasta)
            const ctx2 = document.getElementById('expenseDistributionChart');
            if (ctx2) {
                chartInstances.expenseDistribution = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Personel', 'Operasyonel', 'Kira'],
                        datasets: [{
                            data: [staffCost, opCost, rent],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 206, 86, 0.8)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(value) +
                                               ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 3. Gelir vs Gider Karşılaştırması
            const ctx3 = document.getElementById('incomeExpenseChart');
            if (ctx3) {
                chartInstances.incomeExpense = new Chart(ctx3, {
                    type: 'bar',
                    data: {
                        labels: ['Aylık'],
                        datasets: [{
                            label: 'Toplam Gelir',
                            data: [totalRevenue],
                            backgroundColor: 'rgba(75, 192, 192, 0.8)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Toplam Gider',
                            data: [totalExpenses],
                            backgroundColor: 'rgba(255, 99, 132, 0.8)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Net Kar',
                            data: [netProfit],
                            backgroundColor: netProfit > 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            borderColor: netProfit > 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 4. 12 Aylık Projeksiyonu (Çizgi Grafik)
            const ctx4 = document.getElementById('yearlyProjectionChart');
            if (ctx4) {
                const months = ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara'];
                const monthlyData = months.map(() => netProfit);
                const cumulativeData = months.map((_, i) => netProfit * (i + 1));
                
                chartInstances.yearlyProjection = new Chart(ctx4, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Aylık Kar/Zarar',
                            data: monthlyData,
                            borderColor: netProfit > 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            backgroundColor: netProfit > 0 ? 'rgba(40, 167, 69, 0.1)' : 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Kümülatif Kar/Zarar',
                            data: cumulativeData,
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + 
                                               new Intl.NumberFormat('tr-TR', {style: 'currency', currency: 'TRY'}).format(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('tr-TR', {notation: 'compact', compactDisplay: 'short'}).format(value) + '₺';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function generateManagerReport() {
            // Tüm değerleri tekrar al
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const weekdayCapacity = parseFloat(document.getElementById('weekdayCapacity').value) || 0;
            const weekendCapacity = parseFloat(document.getElementById('weekendCapacity').value) || 0;
            const workingDays = parseFloat(document.getElementById('workingDays').value) || 22;
            
            // Maliyetler
            const investmentCostValue = document.getElementById('investmentCost').value.replace(/\./g, '').replace(/,/g, '.');
            const investmentCost = parseFloat(investmentCostValue) || 0;
            const amortizationMonths = parseFloat(document.getElementById('amortizationMonths').value) || 36;
            const rentRate = parseFloat(document.getElementById('rentRate').value) || 35;
            
            // Personel
            const staffCount = parseFloat(document.getElementById('staffCountTotal').value) || 0;
            const staffCostTotalValue = document.getElementById('staffCostTotal').value.replace(/\./g, '').replace(/,/g, '.');
            const monthlyStaffCost = parseFloat(staffCostTotalValue) || 0;
            
            // Hesaplamaları yeniden yap
            const personelSubs = parseFloat(document.getElementById('personelSubs').value) || 0;
            const personelPrice = parseFloat(document.getElementById('personelPrice').value) || 0;
            const externalSubs = parseFloat(document.getElementById('externalSubs').value) || 0;
            const externalPrice = parseFloat(document.getElementById('externalPrice').value) || 0;
            const monthlySubRevenue = (personelSubs * personelPrice) + (externalSubs * externalPrice);
            
            let weekdayDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`wd_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`wd_slot${i}_parking`).value) || 0;
                weekdayDailyRevenue += tariff * parking;
            }
            
            const weekendDays = parseFloat(document.getElementById('weekendDays').value) || 8;
            let weekendDailyRevenue = 0;
            for (let i = 1; i <= 6; i++) {
                const tariff = parseFloat(document.getElementById(`we_slot${i}_tariff`).value) || 0;
                const parking = parseFloat(document.getElementById(`we_slot${i}_parking`).value) || 0;
                weekendDailyRevenue += tariff * parking;
            }
            
            const weekdayMonthlyRevenue = weekdayDailyRevenue * workingDays;
            const weekendMonthlyRevenue = weekendDailyRevenue * weekendDays;
            const totalMonthlyRevenue = weekdayMonthlyRevenue + weekendMonthlyRevenue + monthlySubRevenue;
            const totalYearlyRevenue = totalMonthlyRevenue * 12;
            
            const operationalRate = parseFloat(document.getElementById('operationalRate').value) || 10;
            const monthlyOperationalCost = (totalMonthlyRevenue * operationalRate) / 100;
            const monthlyRent = (totalMonthlyRevenue * rentRate) / 100;
            const totalMonthlyExpenses = monthlyStaffCost + monthlyOperationalCost + monthlyRent;
            const monthlyNetProfit = totalMonthlyRevenue - totalMonthlyExpenses;
            const yearlyNetProfit = monthlyNetProfit * 12;
            const netProfitPercentage = totalMonthlyRevenue > 0 ? (monthlyNetProfit / totalMonthlyRevenue) * 100 : 0;
            const paybackPeriod = monthlyNetProfit > 0 ? investmentCost / monthlyNetProfit : 0;
            
            // Rapor içeriğini oluştur
            const profitStatus = monthlyNetProfit > 0 ? '✅ KARLI' : '❌ ZARARLI';
            const profitColor = monthlyNetProfit > 0 ? '#28a745' : '#dc3545';
            
            const reportContent = `
                <div class="manager-summary">
                    <h3>🎯 GENEL DEĞERLENDİRME</h3>
                    <p><strong>${locationName}</strong> lokasyonu için yapılan fizibilite çalışması sonucunda:</p>
                    <p>▪ Aylık Net Kar: <span class="highlight" style="color: ${profitColor}; font-size: 20px;">${formatCurrency(monthlyNetProfit)} (${profitStatus})</span></p>
                    <p>▪ Yıllık Net Kar: <span class="highlight" style="color: ${profitColor}; font-size: 20px;">${formatCurrency(yearlyNetProfit)}</span></p>
                    <p>▪ Kar Marjı: <span class="highlight">${Math.abs(netProfitPercentage).toFixed(1)}%</span></p>
                    <p>▪ Yatırım Geri Dönüş: <span class="highlight">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay (' + (paybackPeriod/12).toFixed(1) + ' yıl)' : 'Belirsiz'}</span></p>
                </div>
                
                <div class="manager-summary">
                    <h3>💰 HASILAT ANALİZİ</h3>
                    <p>▪ Hafta İçi Günlük: ${formatCurrency(weekdayDailyRevenue)} → Aylık: ${formatCurrency(weekdayMonthlyRevenue)}</p>
                    <p>▪ Hafta Sonu Günlük: ${formatCurrency(weekendDailyRevenue)} → Aylık: ${formatCurrency(weekendMonthlyRevenue)}</p>
                    <p>▪ Abonelik Geliri: ${formatCurrency(monthlySubRevenue)}</p>
                    <p>▪ <strong>Toplam Aylık Hasılat: <span class="highlight">${formatCurrency(totalMonthlyRevenue)}</span></strong></p>
                    <p>▪ <strong>Toplam Yıllık Hasılat: <span class="highlight">${formatCurrency(totalYearlyRevenue)}</span></strong></p>
                </div>
                
                <div class="manager-summary">
                    <h3>💸 GİDER ANALİZİ</h3>
                    <p>▪ Personel Maliyeti: ${formatCurrency(monthlyStaffCost)} (${staffCount} Personel - KDV'li + Katsayılı)</p>
                    <p>▪ Operasyonel Gider: ${formatCurrency(monthlyOperationalCost)} (%${operationalRate})</p>
                    <p>▪ İşletmeye Kira: ${formatCurrency(monthlyRent)} (%${rentRate})</p>
                    <p>▪ <strong>Toplam Aylık Gider: <span class="highlight">${formatCurrency(totalMonthlyExpenses)}</span></strong></p>
                </div>
                
                <div class="manager-report-grid">
                    <div class="manager-report-card">
                        <h4>Hafta İçi Kapasite</h4>
                        <div class="value">${weekdayCapacity}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Hafta Sonu Kapasite</h4>
                        <div class="value">${weekendCapacity}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Personel</h4>
                        <div class="value">${staffCount}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Aylık Hasılat</h4>
                        <div class="value">${formatCurrency(totalMonthlyRevenue)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Aylık Gider</h4>
                        <div class="value">${formatCurrency(totalMonthlyExpenses)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Net Kar (Aylık)</h4>
                        <div class="value" style="color: ${profitColor};">${formatCurrency(monthlyNetProfit)}</div>
                    </div>
                    <div class="manager-report-card">
                        <h4>Geri Dönüş</h4>
                        <div class="value">${paybackPeriod > 0 ? paybackPeriod.toFixed(1) + ' ay' : '-'}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('managerReportContent').innerHTML = reportContent;
            document.getElementById('managerReport').style.display = 'block';
            document.getElementById('managerReport').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // KAYDETME/YÜKLEME FONKSİYONLARI
        function getAllFormData() {
            const data = {
                // Genel bilgiler
                locationName: document.getElementById('locationName').value,
                devinim: document.getElementById('devinim').value,
                workingMonths: document.getElementById('workingMonths').value,
                
                // Kapasite
                weekdayCapacity: document.getElementById('weekdayCapacity').value,
                weekendCapacity: document.getElementById('weekendCapacity').value,
                workingDays: document.getElementById('workingDays').value,
                weekendDays: document.getElementById('weekendDays').value,
                
                // Personel
                staffMinWage: document.getElementById('staffMinWage').value,
                staff25k: document.getElementById('staff25k').value,
                staffManager: document.getElementById('staffManager').value,
                
                // Maliyet
                investmentCost: document.getElementById('investmentCost').value,
                amortizationMonths: document.getElementById('amortizationMonths').value,
                operationalRate: document.getElementById('operationalRate').value,
                rentRate: document.getElementById('rentRate').value,
                
                // Abonelik
                personelSubs: document.getElementById('personelSubs').value,
                personelPrice: document.getElementById('personelPrice').value,
                externalSubs: document.getElementById('externalSubs').value,
                externalPrice: document.getElementById('externalPrice').value,
                
                // Hafta içi tarifeler
                weekdaySlots: [],
                // Hafta sonu tarifeler
                weekendSlots: []
            };
            
            // Hafta içi saat dilimlerini topla
            for (let i = 1; i <= 6; i++) {
                data.weekdaySlots.push({
                    hours: document.getElementById(`wd_slot${i}_hours`).value,
                    tariff: document.getElementById(`wd_slot${i}_tariff`).value,
                    usage: document.getElementById(`wd_slot${i}_usage`).value,
                    parking: document.getElementById(`wd_slot${i}_parking`).value
                });
            }
            
            // Hafta sonu saat dilimlerini topla
            for (let i = 1; i <= 6; i++) {
                data.weekendSlots.push({
                    hours: document.getElementById(`we_slot${i}_hours`).value,
                    tariff: document.getElementById(`we_slot${i}_tariff`).value,
                    usage: document.getElementById(`we_slot${i}_usage`).value,
                    parking: document.getElementById(`we_slot${i}_parking`).value
                });
            }
            
            return data;
        }

        function setAllFormData(data) {
            // Genel bilgiler
            document.getElementById('locationName').value = data.locationName || '';
            document.getElementById('devinim').value = data.devinim || '1.5';
            document.getElementById('workingMonths').value = data.workingMonths || '12';
            
            // Kapasite
            document.getElementById('weekdayCapacity').value = data.weekdayCapacity || '1670';
            document.getElementById('weekendCapacity').value = data.weekendCapacity || '2505';
            document.getElementById('workingDays').value = data.workingDays || '22';
            document.getElementById('weekendDays').value = data.weekendDays || '8';
            
            // Personel
            document.getElementById('staffMinWage').value = data.staffMinWage || '0';
            document.getElementById('staff25k').value = data.staff25k || '0';
            document.getElementById('staffManager').value = data.staffManager || '0';
            
            // Maliyet
            document.getElementById('investmentCost').value = data.investmentCost || '1.074.165';
            document.getElementById('amortizationMonths').value = data.amortizationMonths || '36';
            document.getElementById('operationalRate').value = data.operationalRate || '10';
            document.getElementById('rentRate').value = data.rentRate || '35';
            
            // Abonelik
            document.getElementById('personelSubs').value = data.personelSubs || '0';
            document.getElementById('personelPrice').value = data.personelPrice || '0';
            document.getElementById('externalSubs').value = data.externalSubs || '0';
            document.getElementById('externalPrice').value = data.externalPrice || '0';
            
            // Hafta içi tarifeler
            if (data.weekdaySlots) {
                data.weekdaySlots.forEach((slot, i) => {
                    const index = i + 1;
                    document.getElementById(`wd_slot${index}_hours`).value = slot.hours || '';
                    document.getElementById(`wd_slot${index}_tariff`).value = slot.tariff || '0';
                    document.getElementById(`wd_slot${index}_usage`).value = slot.usage || '0';
                    document.getElementById(`wd_slot${index}_parking`).value = slot.parking || '0';
                });
            }
            
            // Hafta sonu tarifeler
            if (data.weekendSlots) {
                data.weekendSlots.forEach((slot, i) => {
                    const index = i + 1;
                    document.getElementById(`we_slot${index}_hours`).value = slot.hours || '';
                    document.getElementById(`we_slot${index}_tariff`).value = slot.tariff || '0';
                    document.getElementById(`we_slot${index}_usage`).value = slot.usage || '0';
                    document.getElementById(`we_slot${index}_parking`).value = slot.parking || '0';
                });
            }
            
            // Otomatik hesaplamaları tetikle
            calculateTotalStaffCost();
            calculateWeekendCapacity();
        }

        function saveCalculation() {
            document.getElementById('saveModal').style.display = 'block';
            document.getElementById('saveName').value = document.getElementById('locationName').value || '';
        }

        function closeSaveModal() {
            document.getElementById('saveModal').style.display = 'none';
        }

        function confirmSave() {
            const saveName = document.getElementById('saveName').value.trim();
            if (!saveName) {
                alert('Lütfen bir kayıt adı girin!');
                return;
            }
            
            const data = getAllFormData();
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            
            const calculation = {
                id: Date.now(),
                name: saveName,
                data: data,
                savedAt: new Date().toISOString()
            };
            
            savedCalculations.push(calculation);
            localStorage.setItem('parkexpertCalculations', JSON.stringify(savedCalculations));
            
            closeSaveModal();
            alert('✅ Hesaplama başarıyla kaydedildi!');
            
            // Başarımları kontrol et
            if (savedCalculations.length >= 5) {
                unlockAchievement('saver');
            }
        }

        function showLoadModal() {
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            const listContainer = document.getElementById('savedCalculationsList');
            
            if (savedCalculations.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📂</div>
                        <h3>Henüz kayıtlı hesaplama yok</h3>
                        <p>Hesaplamalarınızı kaydetmek için "💾 Hesaplamayı Kaydet" butonunu kullanın.</p>
                    </div>
                `;
            } else {
                listContainer.innerHTML = savedCalculations.reverse().map(calc => {
                    const date = new Date(calc.savedAt);
                    const dateStr = date.toLocaleDateString('tr-TR', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    return `
                        <div class="saved-calculation">
                            <h3>${calc.name}</h3>
                            <div class="saved-calculation-info">
                                <span>📅 ${dateStr}</span>
                                <span>📍 ${calc.data.locationName || 'Belirtilmemiş'}</span>
                                <span>🚗 ${calc.data.weekdayCapacity || 0} Kapasite</span>
                            </div>
                            <div class="saved-calculation-actions">
                                <button class="btn-load" onclick="loadCalculation(${calc.id})">
                                    📂 Yükle
                                </button>
                                <button class="btn-delete" onclick="deleteCalculation(${calc.id})">
                                    🗑️ Sil
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('loadModal').style.display = 'block';
        }

        function closeLoadModal() {
            document.getElementById('loadModal').style.display = 'none';
        }

        function loadCalculation(id) {
            const savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            const calculation = savedCalculations.find(c => c.id === id);
            
            if (calculation) {
                setAllFormData(calculation.data);
                closeLoadModal();
                alert('✅ Hesaplama yüklendi!');
                
                // Sayfayı en üste kaydır
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function deleteCalculation(id) {
            if (!confirm('Bu hesaplamayı silmek istediğinizden emin misiniz?')) {
                return;
            }
            
            let savedCalculations = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            savedCalculations = savedCalculations.filter(c => c.id !== id);
            localStorage.setItem('parkexpertCalculations', JSON.stringify(savedCalculations));
            
            showLoadModal(); // Listeyi yenile
            alert('✅ Hesaplama silindi!');
        }

        // EXPORT FONKSİYONLARI

        function exportToExcel() {
            const data = getAllFormData();
            const locationName = document.getElementById('locationName').value || 'Fizibilite';
            
            // Excel dosyası için worksheetler
            const wb = XLSX.utils.book_new();
            
            // 1. Genel Bilgiler Sayfası
            const generalData = [
                ['PARKEXPERT FİZİBİLİTE RAPORU'],
                [''],
                ['Lokasyon:', data.locationName],
                ['Tarih:', new Date().toLocaleDateString('tr-TR')],
                [''],
                ['KAPASITE BİLGİLERİ'],
                ['Hafta İçi Kapasite:', data.weekdayCapacity],
                ['Hafta Sonu Kapasite:', data.weekendCapacity],
                ['Devinim:', data.devinim],
                [''],
                ['ÇALIŞMA SÜRELERİ'],
                ['Hafta İçi Çalışılan Gün (Aylık):', data.workingDays],
                ['Hafta Sonu Çalışılan Gün (Aylık):', data.weekendDays],
                ['Çalışılan Ay (Yıllık):', data.workingMonths]
            ];
            const ws1 = XLSX.utils.aoa_to_sheet(generalData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Genel Bilgiler');
            
            // 2. Personel Sayfası
            const personnelData = [
                ['PERSONEL BİLGİLERİ'],
                [''],
                ['Kategori', 'Sayı', 'Birim Maliyet', 'Toplam'],
                ['Asgari Ücretli', data.staffMinWage, '52.122,42 ₺', (parseInt(data.staffMinWage) * 52122.42).toFixed(2) + ' ₺'],
                ['25.000₺ Ücretli', data.staff25k, '58.188,24 ₺', (parseInt(data.staff25k) * 58188.24).toFixed(2) + ' ₺'],
                ['Yönetici', data.staffManager, '92.974,20 ₺', (parseInt(data.staffManager) * 92974.20).toFixed(2) + ' ₺'],
                [''],
                ['TOPLAM PERSONEL:', parseInt(data.staffMinWage) + parseInt(data.staff25k) + parseInt(data.staffManager)],
                ['TOPLAM AYLIK MALİYET:', document.getElementById('staffCostTotal').value + ' ₺']
            ];
            const ws2 = XLSX.utils.aoa_to_sheet(personnelData);
            XLSX.utils.book_append_sheet(wb, ws2, 'Personel');
            
            // 3. Maliyet ve Giderler
            const costData = [
                ['MALİYET VE GİDERLER'],
                [''],
                ['Yatırım Maliyeti (KDV Dahil):', data.investmentCost + ' ₺'],
                ['Amortisman Süresi:', data.amortizationMonths + ' Ay'],
                ['Operasyonel Gider Oranı:', '%' + data.operationalRate],
                ['Kira Oranı:', '%' + data.rentRate]
            ];
            const ws3 = XLSX.utils.aoa_to_sheet(costData);
            XLSX.utils.book_append_sheet(wb, ws3, 'Maliyetler');
            
            // 4. Abonelikler
            const subscriptionData = [
                ['ABONELİKLER'],
                [''],
                ['Tip', 'Sayı', 'Fiyat', 'Aylık Toplam'],
                ['Personel Abone', data.personelSubs, data.personelPrice + ' ₺', (parseInt(data.personelSubs) * parseInt(data.personelPrice)) + ' ₺'],
                ['Dış Abonelik', data.externalSubs, data.externalPrice + ' ₺', (parseInt(data.externalSubs) * parseInt(data.externalPrice)) + ' ₺']
            ];
            const ws4 = XLSX.utils.aoa_to_sheet(subscriptionData);
            XLSX.utils.book_append_sheet(wb, ws4, 'Abonelikler');
            
            // 5. Hafta İçi Tarifeler
            const weekdayTariffsData = [
                ['HAFTA İÇİ TARİFELER'],
                [''],
                ['Saat Dilimi', 'Tarife (₺)', 'Kullanım %', 'Park/Gün']
            ];
            data.weekdaySlots.forEach(slot => {
                weekdayTariffsData.push([slot.hours, slot.tariff, slot.usage, slot.parking]);
            });
            const ws5 = XLSX.utils.aoa_to_sheet(weekdayTariffsData);
            XLSX.utils.book_append_sheet(wb, ws5, 'Hafta İçi');
            
            // 6. Hafta Sonu Tarifeler
            const weekendTariffsData = [
                ['HAFTA SONU TARİFELER'],
                [''],
                ['Saat Dilimi', 'Tarife (₺)', 'Kullanım %', 'Park/Gün']
            ];
            data.weekendSlots.forEach(slot => {
                weekendTariffsData.push([slot.hours, slot.tariff, slot.usage, slot.parking]);
            });
            const ws6 = XLSX.utils.aoa_to_sheet(weekendTariffsData);
            XLSX.utils.book_append_sheet(wb, ws6, 'Hafta Sonu');
            
            // Excel dosyasını indir
            const fileName = `Parkexpert_Fizibilite_${locationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('✅ Excel dosyası başarıyla indirildi!');
            
            // Başarım
            unlockAchievement('exporter');
        }

        async function exportToPDF() {
            const locationName = document.getElementById('locationName').value || 'Fizibilite Raporu';
            
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                let yPosition = 20;
                
                // Başlık
                pdf.setFontSize(20);
                pdf.setTextColor(30, 60, 114);
                pdf.text('🅿️ PARKEXPERT FİZİBİLİTE RAPORU', pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 10;
                pdf.setFontSize(16);
                pdf.setTextColor(102, 126, 234);
                pdf.text(locationName, pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 8;
                pdf.setFontSize(10);
                pdf.setTextColor(108, 117, 125);
                pdf.text('Tarih: ' + new Date().toLocaleDateString('tr-TR', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }), pageWidth / 2, yPosition, { align: 'center' });
                
                yPosition += 15;
                
                // Sonuçlar bölümünü yazdır
                const resultsElement = document.getElementById('results');
                if (resultsElement && resultsElement.style.display !== 'none') {
                    const canvas = await html2canvas(resultsElement, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const imgWidth = pageWidth - 20;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    // Yeni sayfa gerekiyorsa ekle
                    if (yPosition + imgHeight > pageHeight - 20) {
                        pdf.addPage();
                        yPosition = 20;
                    }
                    
                    pdf.addImage(imgData, 'JPEG', 10, yPosition, imgWidth, imgHeight);
                    yPosition += imgHeight + 10;
                }
                
                // Grafikleri ekle
                const chartsSection = document.getElementById('chartsSection');
                if (chartsSection && chartsSection.style.display !== 'none') {
                    pdf.addPage();
                    yPosition = 20;
                    
                    pdf.setFontSize(16);
                    pdf.setTextColor(30, 60, 114);
                    pdf.text('📊 Grafik Analizler', pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 15;
                    
                    const chartContainers = chartsSection.querySelectorAll('.chart-container');
                    
                    for (let i = 0; i < chartContainers.length; i++) {
                        const chartContainer = chartContainers[i];
                        
                        const canvas = await html2canvas(chartContainer, {
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff'
                        });
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        const imgWidth = (pageWidth - 30) / 2;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        const xPosition = (i % 2 === 0) ? 10 : pageWidth / 2 + 5;
                        
                        if (i % 2 === 0 && i > 0) {
                            yPosition += imgHeight + 10;
                        }
                        
                        if (yPosition + imgHeight > pageHeight - 20) {
                            pdf.addPage();
                            yPosition = 20;
                        }
                        
                        pdf.addImage(imgData, 'JPEG', xPosition, yPosition, imgWidth, imgHeight);
                        
                        if (i === chartContainers.length - 1 && i % 2 === 0) {
                            yPosition += imgHeight + 10;
                        }
                    }
                }
                
                // Yönetici raporunu ekle
                const managerReport = document.getElementById('managerReport');
                if (managerReport && managerReport.style.display !== 'none') {
                    pdf.addPage();
                    yPosition = 20;
                    
                    const canvas = await html2canvas(managerReport, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#667eea'
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const imgWidth = pageWidth - 20;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'JPEG', 10, yPosition, imgWidth, imgHeight);
                }
                
                // PDF'i kaydet
                const fileName = `Parkexpert_Fizibilite_${locationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);
                
                alert('✅ PDF dosyası başarıyla indirildi!');
            } catch (error) {
                console.error('PDF oluşturma hatası:', error);
                alert('❌ PDF oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
            }
        }

        // TEMPLATE SİSTEMİ
        const templates = {
            avm: {
                name: 'AVM - Alışveriş Merkezi',
                locationName: 'Olivium AVM Otopark',
                weekdayCapacity: 2000,
                devinim: 2.5,
                workingDays: 22,
                weekendDays: 8,
                staffMinWage: 4,
                staff25k: 2,
                staffManager: 1,
                investmentCost: 5000000,
                amortizationMonths: 60,
                operationalRate: 12,
                rentRate: 35,
                personelSubs: 150,
                personelPrice: 800,
                externalSubs: 50,
                externalPrice: 1200,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 40, usage: 85, parking: Math.round(2000 * 0.85) },
                    { hours: '12:00-18:00', tariff: 50, usage: 95, parking: Math.round(2000 * 0.95) },
                    { hours: '18:00-22:00', tariff: 45, usage: 90, parking: Math.round(2000 * 0.90) },
                    { hours: '22:00-08:00', tariff: 30, usage: 20, parking: Math.round(2000 * 0.20) }
                ]
            },
            plaza: {
                name: 'Plaza / Ofis Binası',
                locationName: 'Zorlu Plaza Otopark',
                weekdayCapacity: 800,
                devinim: 1.8,
                workingDays: 22,
                weekendDays: 8,
                staffMinWage: 2,
                staff25k: 1,
                staffManager: 1,
                investmentCost: 2000000,
                amortizationMonths: 48,
                operationalRate: 10,
                rentRate: 30,
                personelSubs: 300,
                personelPrice: 600,
                externalSubs: 20,
                externalPrice: 1000,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 35, usage: 95, parking: Math.round(800 * 0.95) },
                    { hours: '12:00-18:00', tariff: 40, usage: 90, parking: Math.round(800 * 0.90) },
                    { hours: '18:00-22:00', tariff: 30, usage: 40, parking: Math.round(800 * 0.40) },
                    { hours: '22:00-08:00', tariff: 20, usage: 10, parking: Math.round(800 * 0.10) }
                ]
            },
            hastane: {
                name: 'Hastane',
                locationName: 'Acıbadem Hastanesi Otopark',
                weekdayCapacity: 1200,
                devinim: 3.0,
                workingDays: 30,
                weekendDays: 0,
                staffMinWage: 6,
                staff25k: 2,
                staffManager: 1,
                investmentCost: 3000000,
                amortizationMonths: 60,
                operationalRate: 15,
                rentRate: 25,
                personelSubs: 200,
                personelPrice: 500,
                externalSubs: 0,
                externalPrice: 0,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 50, usage: 90, parking: Math.round(1200 * 0.90) },
                    { hours: '12:00-18:00', tariff: 55, usage: 85, parking: Math.round(1200 * 0.85) },
                    { hours: '18:00-22:00', tariff: 45, usage: 70, parking: Math.round(1200 * 0.70) },
                    { hours: '22:00-08:00', tariff: 35, usage: 40, parking: Math.round(1200 * 0.40) }
                ]
            },
            otel: {
                name: 'Otel',
                locationName: 'Hilton Otel Otopark',
                weekdayCapacity: 500,
                devinim: 1.2,
                workingDays: 30,
                weekendDays: 0,
                staffMinWage: 2,
                staff25k: 1,
                staffManager: 1,
                investmentCost: 1500000,
                amortizationMonths: 48,
                operationalRate: 12,
                rentRate: 20,
                personelSubs: 50,
                personelPrice: 0,
                externalSubs: 100,
                externalPrice: 1500,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 60, usage: 60, parking: Math.round(500 * 0.60) },
                    { hours: '12:00-18:00', tariff: 70, usage: 75, parking: Math.round(500 * 0.75) },
                    { hours: '18:00-22:00', tariff: 80, usage: 85, parking: Math.round(500 * 0.85) },
                    { hours: '22:00-08:00', tariff: 100, usage: 90, parking: Math.round(500 * 0.90) }
                ]
            },
            stadyum: {
                name: 'Stadyum / Etkinlik Alanı',
                locationName: 'Ülker Stadyumu Otopark',
                weekdayCapacity: 3000,
                devinim: 1.5,
                workingDays: 10,
                weekendDays: 8,
                staffMinWage: 10,
                staff25k: 3,
                staffManager: 2,
                investmentCost: 8000000,
                amortizationMonths: 72,
                operationalRate: 15,
                rentRate: 40,
                personelSubs: 50,
                personelPrice: 1000,
                externalSubs: 200,
                externalPrice: 2000,
                weekdaySlots: [
                    { hours: '08:00-12:00', tariff: 30, usage: 20, parking: Math.round(3000 * 0.20) },
                    { hours: '12:00-18:00', tariff: 100, usage: 95, parking: Math.round(3000 * 0.95) },
                    { hours: '18:00-22:00', tariff: 150, usage: 100, parking: Math.round(3000 * 1.00) },
                    { hours: '22:00-08:00', tariff: 50, usage: 80, parking: Math.round(3000 * 0.80) }
                ]
            }
        };

        function applyTemplate(templateKey) {
            if (templateKey === 'custom') {
                // Sıfırla
                document.getElementById('locationName').value = '';
                document.getElementById('weekdayCapacity').value = '1670';
                document.getElementById('devinim').value = '1.5';
                document.getElementById('workingDays').value = '22';
                document.getElementById('weekendDays').value = '8';
                document.getElementById('staffMinWage').value = '0';
                document.getElementById('staff25k').value = '0';
                document.getElementById('staffManager').value = '0';
                calculateTotalStaffCost();
                calculateWeekendCapacity();
                alert('✅ Form sıfırlandı. Kendi değerlerinizi girebilirsiniz.');
                return;
            }

            const template = templates[templateKey];
            if (!template) return;

            // Form alanlarını doldur
            document.getElementById('locationName').value = template.locationName;
            document.getElementById('weekdayCapacity').value = template.weekdayCapacity;
            document.getElementById('devinim').value = template.devinim;
            document.getElementById('workingDays').value = template.workingDays;
            document.getElementById('weekendDays').value = template.weekendDays;
            
            // Personel
            document.getElementById('staffMinWage').value = template.staffMinWage;
            document.getElementById('staff25k').value = template.staff25k;
            document.getElementById('staffManager').value = template.staffManager;
            
            // Maliyetler
            document.getElementById('investmentCost').value = template.investmentCost;
            document.getElementById('amortizationMonths').value = template.amortizationMonths;
            document.getElementById('operationalRate').value = template.operationalRate;
            document.getElementById('rentRate').value = template.rentRate;
            
            // Abonelikler
            document.getElementById('personelSubs').value = template.personelSubs;
            document.getElementById('personelPrice').value = template.personelPrice;
            document.getElementById('externalSubs').value = template.externalSubs;
            document.getElementById('externalPrice').value = template.externalPrice;
            
            // Hafta içi tarifeler
            template.weekdaySlots.forEach((slot, index) => {
                document.getElementById(`weekdayTariff${index + 1}`).value = slot.tariff;
                document.getElementById(`weekdayUsage${index + 1}`).value = slot.usage;
            });
            
            // Hesaplamaları tetikle
            calculateTotalStaffCost();
            calculateWeekendCapacity();
            
            alert(`✅ ${template.name} şablonu yüklendi!\n\nVerileri inceleyip ihtiyacınıza göre düzenleyebilirsiniz.`);
            
            // Başarım
            unlockAchievement('template_user');
            
            // Scroll to form
            document.querySelector('.section').scrollIntoView({ behavior: 'smooth' });
        }

        // PARA BİRİMİ YÖNETİMİ
        function toggleCurrencyMenu() {
            const menu = document.getElementById('currencyMenu');
            menu.classList.toggle('active');
        }

        function changeCurrency(code, symbol) {
            currentCurrency = code;
            currentCurrencySymbol = symbol;
            
            // UI'ı güncelle
            document.getElementById('currentCurrencyCode').textContent = code;
            document.getElementById('currentCurrencySymbol').textContent = symbol;
            
            // Aktif butonu işaretle
            document.querySelectorAll('.currency-option-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(code)) {
                    btn.classList.add('active');
                }
            });
            
            // Menüyü kapat
            document.getElementById('currencyMenu').classList.remove('active');
            
            // Eğer sonuçlar varsa yeniden formatla
            if (document.getElementById('results').style.display !== 'none') {
                updateCurrencyDisplay();
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem('parkexpert-currency', code);
            
            // Animasyon
            const badge = document.getElementById('currencyBadge');
            badge.style.animation = 'pulse 0.5s ease-out';
            setTimeout(() => {
                badge.style.animation = '';
            }, 500);
        }

        function updateCurrencyDisplay() {
            const rate = exchangeRates[currentCurrency];
            
            // Tüm sonuç kartlarını güncelle
            document.querySelectorAll('.result-card .value').forEach(el => {
                const originalText = el.textContent;
                const numbers = originalText.match(/[\d.,]+/g);
                
                if (numbers) {
                    numbers.forEach(num => {
                        const value = parseFloat(num.replace(/\./g, '').replace(',', '.'));
                        if (!isNaN(value)) {
                            const converted = value / rate;
                            const formatted = new Intl.NumberFormat('tr-TR', {
                                minimumFractionDigits: 0,
                                maximumFractionDigits: 0
                            }).format(converted);
                            el.textContent = originalText.replace(num, formatted).replace('₺', currentCurrencySymbol);
                        }
                    });
                }
            });
        }

        // NOTLAR YÖNETİMİ
        function saveNotes() {
            const notes = document.getElementById('calculationNotes').value;
            const locationName = document.getElementById('locationName').value || 'Genel';
            
            // LocalStorage'a kaydet
            const notesData = JSON.parse(localStorage.getItem('parkexpert-notes') || '{}');
            notesData[locationName] = {
                notes: notes,
                date: new Date().toISOString(),
                timestamp: Date.now()
            };
            localStorage.setItem('parkexpert-notes', JSON.stringify(notesData));
            
            // Başarı mesajı
            showToast('✅ Notlar kaydedildi!', 'success');
        }

        function loadNotes(locationName) {
            const notesData = JSON.parse(localStorage.getItem('parkexpert-notes') || '{}');
            if (notesData[locationName]) {
                document.getElementById('calculationNotes').value = notesData[locationName].notes;
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 9999;
                animation: slideInUp 0.3s ease-out;
                font-weight: 600;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInUp 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // MULTI-USER SYSTEM
        let currentUser = null;

        function initUserSystem() {
            // Kullanıcıları yükle veya default oluştur
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            
            // Eğer hiç kullanıcı yoksa, demo admin ekle
            if (users.length === 0) {
                const demoAdmin = {
                    id: 'admin-' + Date.now(),
                    name: 'Demo Admin',
                    email: 'admin@parkexpert.com',
                    password: hashPassword('admin123'),
                    role: 'admin',
                    company: 'Parkexpert Demo',
                    createdAt: new Date().toISOString()
                };
                users.push(demoAdmin);
                localStorage.setItem('parkexpert-users', JSON.stringify(users));
            }
            
            // Session'ı kontrol et
            const sessionUser = localStorage.getItem('parkexpert-session');
            if (sessionUser) {
                currentUser = JSON.parse(sessionUser);
                updateUserUI();
                document.getElementById('loginModal').classList.add('hidden');
            } else {
                // Login modal'ı göster
                document.getElementById('loginModal').classList.remove('hidden');
            }
        }

        function hashPassword(password) {
            // Basit hash (production'da bcrypt kullanılmalı)
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        function switchLoginTab(tab) {
            return; // Artık sadece login
        }

        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast('⚠️ Email ve şifre gerekli!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const user = users.find(u => u.email === email && u.password === hashPassword(password));
            
            if (user) {
                currentUser = {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role,
                    company: user.company
                };
                
                localStorage.setItem('parkexpert-session', JSON.stringify(currentUser));
                document.getElementById('loginModal').classList.add('hidden');
                updateUserUI();
                showToast(`✅ Hoşgeldin ${user.name}!`, 'success');
                
                if (user.role === 'admin') {
                    document.getElementById('adminPanelBtn').style.display = 'flex';
                }
            } else {
                showToast('❌ Email veya şifre hatalı!', 'error');
            }
        }

        // ADMIN PANEL
        function openAdminPanel() {
            if (currentUser.role !== 'admin') {
                showToast('⚠️ Sadece admin!', 'error');
                return;
            }
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('adminPanelOverlay').classList.add('active');
            toggleUserDropdown();
            loadUsersList();
            updateAdminStats();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('adminPanelOverlay').classList.remove('active');
        }

        function switchAdminTab(tab) {
            document.getElementById('adminUsersTab').classList.toggle('active', tab === 'users');
            document.getElementById('adminAddTab').classList.toggle('active', tab === 'add');
            document.getElementById('adminSettingsTab').classList.toggle('active', tab === 'settings');
            document.getElementById('adminUsersSection').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('adminAddSection').style.display = tab === 'add' ? 'block' : 'none';
            document.getElementById('adminSettingsSection').style.display = tab === 'settings' ? 'block' : 'none';
        }

        function loadUsersList() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const listHTML = users.map(user => `
                <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <div style="font-weight: 700;">${user.role === 'admin' ? '👑' : user.role === 'manager' ? '👨‍💼' : '👁️'} ${user.name}</div>
                            <div style="font-size: 12px; color: #6c757d;">📧 ${user.email} | 🏢 ${user.company}</div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editUser('${user.id}')" style="padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">✏️</button>
                            ${user.id !== currentUser.id ? `<button onclick="deleteUser('${user.id}')" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">🗑️</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('usersList').innerHTML = listHTML;
        }

        function generatePassword() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789!@#$%&*';
            let pwd = '';
            for (let i = 0; i < 12; i++) pwd += chars.charAt(Math.floor(Math.random() * chars.length));
            document.getElementById('newUserPassword').value = pwd;
            showToast('🎲 Şifre: ' + pwd, 'success');
        }

        function createUser() {
            const name = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const company = document.getElementById('newUserCompany').value.trim() || 'Parkexpert';
            const role = document.getElementById('newUserRole').value;
            
            if (!name || !email || !password) {
                showToast('⚠️ Tüm alanlar gerekli!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            if (users.some(u => u.email === email)) {
                showToast('⚠️ Email kayıtlı!', 'error');
                return;
            }
            
            users.push({
                id: 'user-' + Date.now(),
                name, email,
                password: hashPassword(password),
                role, company,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('parkexpert-users', JSON.stringify(users));
            
            alert(`✅ KULLANICI OLUŞTURULDU!\n\n👤 ${name}\n📧 ${email}\n🔒 ${password}\n👔 ${role}\n\nBu bilgileri kullanıcıya ilet!`);
            
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserEmail').value = '';
            document.getElementById('newUserPassword').value = '';
            switchAdminTab('users');
            loadUsersList();
        }

        function editUser(userId) {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const user = users.find(u => u.id === userId);
            const newRole = prompt(`Yeni rol? (viewer/manager/admin)\nŞu an: ${user.role}`, user.role);
            if (newRole && ['viewer', 'manager', 'admin'].includes(newRole)) {
                user.role = newRole;
                localStorage.setItem('parkexpert-users', JSON.stringify(users));
                loadUsersList();
                showToast('✅ Rol güncellendi!', 'success');
            }
        }

        function deleteUser(userId) {
            if (!confirm('Silmek emin misin?')) return;
            let users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            users = users.filter(u => u.id !== userId);
            localStorage.setItem('parkexpert-users', JSON.stringify(users));
            loadUsersList();
            showToast('✅ Silindi!', 'success');
        }

        // Misafir modu güvenlik nedeniyle kaldırıldı

        function toggleApproval() {
            localStorage.setItem('parkexpert-require-approval', document.getElementById('requireApproval').checked);
        }

        function updateAdminStats() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            const calcs = JSON.parse(localStorage.getItem('parkexpertCalculations') || '[]');
            document.getElementById('adminStats').innerHTML = `
                👥 Kullanıcı: ${users.length} (👑 Admin: ${users.filter(u => u.role === 'admin').length}, 👨‍💼 Manager: ${users.filter(u => u.role === 'manager').length}, 👁️ Viewer: ${users.filter(u => u.role === 'viewer').length})<br>
                📊 Toplam Hesaplama: ${calcs.length}<br>
                🕒 Son Güncelleme: ${new Date().toLocaleString('tr-TR')}
            `;
        }

        function updateUserUI() {
            if (!currentUser) return;
            
            // Avatar initials
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userInitials').textContent = initials;
            
            // User info
            document.getElementById('currentUserName').textContent = currentUser.name;
            
            // Role badge
            const roleBadge = document.getElementById('currentUserRole');
            roleBadge.className = `user-role ${currentUser.role}`;
            roleBadge.textContent = {
                'admin': '👑 Admin',
                'manager': '👨‍💼 Manager',
                'viewer': '👁️ Viewer'
            }[currentUser.role];
            
            // Role-based UI restrictions
            applyRoleRestrictions();
        }

        function applyRoleRestrictions() {
            if (!currentUser) return;
            
            const isViewer = currentUser.role === 'viewer';
            const isGuest = currentUser.id.startsWith('guest-');
            
            if (isViewer || isGuest) {
                // Viewer'lar için kısıtlamalar
                // Kaydetme butonu gizle
                const saveButtons = document.querySelectorAll('.save-load-btn, .scenario-btn.save');
                saveButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.onclick = () => showToast('⚠️ Düzenleme yetkiniz yok!', 'error');
                });
            }
        }

        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('active');
        }

        function showUserProfile() {
            const profile = `
👤 PROFİL BİLGİLERİ

📛 Ad: ${currentUser.name}
📧 Email: ${currentUser.email}
👔 Rol: ${currentUser.role}
🏢 Şirket: ${currentUser.company}
🆔 ID: ${currentUser.id}
            `.trim();
            
            alert(profile);
            toggleUserDropdown();
        }

        function showTeamMembers() {
            const users = JSON.parse(localStorage.getItem('parkexpert-users') || '[]');
            
            if (currentUser.role !== 'admin') {
                showToast('⚠️ Sadece admin görebilir!', 'error');
                return;
            }
            
            let message = '👥 EKIP ÜYELERİ\n\n';
            users.forEach((user, index) => {
                message += `${index + 1}. ${user.name}\n`;
                message += `   📧 ${user.email}\n`;
                message += `   👔 ${user.role}\n`;
                message += `   🏢 ${user.company}\n\n`;
            });
            
            alert(message);
            toggleUserDropdown();
        }

        function showSettings() {
            alert('⚙️ AYARLAR\n\nYakında eklenecek...');
            toggleUserDropdown();
        }

        function logout() {
            if (confirm('🚪 Çıkış yapmak istediğinizden emin misiniz?')) {
                localStorage.removeItem('parkexpert-session');
                currentUser = null;
                location.reload();
            }
        }

        // Sayfa dışına tıklayınca dropdown'ları kapat
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('active');
            }
        });

        // GAMİFİCATION SİSTEMİ
        const achievements = [
            { id: 'first_calc', icon: '🎯', title: 'İlk Hesaplama', desc: 'İlk fizibilite hesaplamanı yaptın!', unlocked: false },
            { id: 'profitable', icon: '💰', title: 'Karlı İşletme', desc: 'Pozitif karlılık elde ettin!', unlocked: false },
            { id: 'scenario_master', icon: '⚖️', title: 'Senaryo Ustası', desc: '2 senaryoyu karşılaştırdın!', unlocked: false },
            { id: 'saver', icon: '💾', title: 'Kayıtçı', desc: '5 hesaplama kaydettin!', unlocked: false },
            { id: 'template_user', icon: '💼', title: 'Şablon Kullanıcısı', desc: 'Hazır şablon kullandın!', unlocked: false },
            { id: 'exporter', icon: '📊', title: 'Veri Ustası', desc: 'Excel veya PDF export yaptın!', unlocked: false },
            { id: 'theme_changer', icon: '🎨', title: 'Stil Sahibi', desc: 'Temayı değiştirdin!', unlocked: false },
            { id: 'multilingual', icon: '🌍', title: 'Poliglot', desc: 'Dil değiştirdin!', unlocked: false },
            { id: 'power_user', icon: '⚡', title: 'Pro Kullanıcı', desc: '10 hesaplama yaptın!', unlocked: false },
            { id: 'perfect_score', icon: '🏆', title: 'Mükemmellik', desc: '90+ karlılık skoru aldın!', unlocked: false }
        ];

        function loadAchievements() {
            const saved = localStorage.getItem('parkexpert-achievements');
            if (saved) {
                const unlocked = JSON.parse(saved);
                achievements.forEach(ach => {
                    if (unlocked.includes(ach.id)) {
                        ach.unlocked = true;
                    }
                });
            }
            updateAchievementsList();
        }

        function unlockAchievement(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                
                // LocalStorage'a kaydet
                const unlocked = achievements.filter(a => a.unlocked).map(a => a.id);
                localStorage.setItem('parkexpert-achievements', JSON.stringify(unlocked));
                
                // Popup göster
                showAchievementPopup(achievement);
                
                // Konfeti efekti
                createConfetti();
                
                // Listeyi güncelle
                updateAchievementsList();
            }
        }

        function showAchievementPopup(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-title">${achievement.title}</div>
                <div class="achievement-desc">${achievement.desc}</div>
            `;
            document.body.appendChild(popup);
            
            setTimeout(() => {
                popup.style.animation = 'slideInUp 0.5s ease-out reverse';
                setTimeout(() => popup.remove(), 500);
            }, 4000);
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#FFD700', '#FFA500', '#FF6B6B'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    top: ${Math.random() * 100}%;
                    left: ${Math.random() * 100}%;
                    animation: confetti ${1 + Math.random()}s ease-out forwards;
                    z-index: 10000;
                    border-radius: 50%;
                `;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        function toggleAchievements() {
            document.getElementById('achievementsPanel').classList.toggle('active');
        }

        function updateAchievementsList() {
            const list = document.getElementById('achievementsList');
            list.innerHTML = achievements.map(ach => `
                <div class="achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}">
                    <div style="font-size: 32px;">${ach.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: #1e3c72;">${ach.title}</div>
                        <div style="font-size: 12px; color: #6c757d;">${ach.desc}</div>
                    </div>
                    ${ach.unlocked ? '<div style="color: #28a745; font-size: 24px;">✓</div>' : '<div style="color: #6c757d; font-size: 24px;">🔒</div>'}
                </div>
            `).join('');
        }

        // CHATBOT SİSTEMİ
        function toggleChatbot() {
            document.getElementById('chatbotWindow').classList.toggle('active');
        }

        function askChatbot(question) {
            const messagesDiv = document.getElementById('chatbotMessages');
            
            // Kullanıcı mesajını ekle
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = getQuestionText(question);
            messagesDiv.appendChild(userMsg);
            
            // Bot cevabını ekle
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'chat-message bot';
                botMsg.innerHTML = getBotResponse(question);
                messagesDiv.appendChild(botMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getQuestionText(type) {
            const questions = {
                'nasıl': 'Aracı nasıl kullanırım?',
                'öneri': 'Bana öneri verir misin?',
                'şablon': 'Hangi şablonu kullanmalıyım?',
                'karlılık': 'Karlılığı nasıl artırırım?'
            };
            return questions[type] || type;
        }

        function getBotResponse(question) {
            const responses = {
                'nasıl': `
                    <strong>Kullanım Adımları:</strong><br>
                    1️⃣ Yukarıdan bir şablon seç (AVM, Plaza, vb.)<br>
                    2️⃣ Veya manuel olarak bilgileri gir<br>
                    3️⃣ "Fizibilite Hesapla" butonuna tıkla<br>
                    4️⃣ Sonuçları incele ve export et!<br><br>
                    💡 İpucu: Senaryo karşılaştırması için 2 farklı hesaplama yap!
                `,
                'öneri': `
                    <strong>Akıllı Öneriler:</strong><br>
                    📊 Hesaplama yaptıktan sonra "Akıllı Öneriler" bölümünde:<br>
                    • Personel optimizasyonu<br>
                    • Kira önerileri<br>
                    • Kapasite kullanımı<br>
                    • Karlılık artırma stratejileri bulabilirsin!
                `,
                'şablon': `
                    <strong>Şablon Seçimi:</strong><br>
                    🏬 <strong>AVM:</strong> Yüksek trafik, hafta sonu yoğun<br>
                    🏢 <strong>Plaza:</strong> Hafta içi yoğun, abonelik odaklı<br>
                    🏥 <strong>Hastane:</strong> 7/24 aktif, yüksek devir<br>
                    🏨 <strong>Otel:</strong> Gece saatleri yoğun<br>
                    🏟️ <strong>Stadyum:</strong> Etkinlik bazlı, yüksek kapasite<br><br>
                    💡 İhtiyacına en yakın olanı seç!
                `,
                'karlılık': `
                    <strong>Karlılık Artırma İpuçları:</strong><br>
                    💰 Devrinim oranını artır (günlük park başına daha fazla araç)<br>
                    👥 Personel sayısını optimize et<br>
                    📈 Yoğun saatlerde tarife artır<br>
                    🔄 Abonelik sistemini genişlet<br>
                    ⚙️ Operasyonel giderleri azalt<br>
                    🏢 Kira oranını %35'in altında tut<br><br>
                    📊 Akıllı önerilere bak!
                `
            };
            return responses[question] || 'Size nasıl yardımcı olabilirim? Yukarıdaki hızlı yanıt butonlarından birini seçebilirsiniz.';
        }

        function checkAchievements(netProfit, profitabilityScore) {
            // İlk hesaplama
            const calcCount = parseInt(localStorage.getItem('parkexpert-calc-count') || '0') + 1;
            localStorage.setItem('parkexpert-calc-count', calcCount);
            
            if (calcCount === 1) {
                unlockAchievement('first_calc');
            }
            
            if (calcCount >= 10) {
                unlockAchievement('power_user');
            }
            
            // Karlı işletme
            if (netProfit > 0) {
                unlockAchievement('profitable');
            }
            
            // Mükemmel skor
            if (profitabilityScore >= 90) {
                unlockAchievement('perfect_score');
            }
        }

        // SCREENSHOT FONKSİYONU
        async function takeScreenshot() {
            try {
                showToast('📸 Screenshot alınıyor...', 'success');
                
                const element = document.querySelector('.container');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                // PNG olarak indir
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Parkexpert_Screenshot_${new Date().toISOString().split('T')[0]}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                });
                
                showToast('✅ Screenshot indirildi!', 'success');
                unlockAchievement('exporter');
            } catch (error) {
                showToast('❌ Screenshot alınamadı', 'error');
            }
        }

        // FİNANSMAN HESAPLAYICI
        function openFinancing() {
            document.getElementById('financingModal').classList.add('active');
            document.getElementById('modalOverlay').classList.add('active');
            
            // Yatırım tutarını doldur
            const investCost = document.getElementById('investmentCost').value;
            if (investCost) {
                document.getElementById('loanAmount').value = investCost;
            }
        }

        function calculateLoan() {
            const principal = parseFloat(document.getElementById('loanAmount').value) || 0;
            const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const termMonths = parseInt(document.getElementById('loanTerm').value) || 0;
            
            if (principal === 0 || termMonths === 0) {
                alert('⚠️ Lütfen tüm alanları doldurun!');
                return;
            }
            
            // Aylık faiz oranı
            const monthlyRate = (annualRate / 100) / 12;
            
            // Aylık taksit hesaplama (eşit taksit formülü)
            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, termMonths)) / 
                                   (Math.pow(1 + monthlyRate, termMonths) - 1);
            
            const totalPayment = monthlyPayment * termMonths;
            const totalInterest = totalPayment - principal;
            
            // Sonuçları göster
            const resultsDiv = document.getElementById('loanResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">Aylık Taksit</div>
                    <div style="font-size: 32px; font-weight: 700; color: #667eea;">${formatCurrency(monthlyPayment)}</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #6c757d;">Toplam Ödeme</div>
                        <div style="font-size: 18px; font-weight: 600; color: #1e3c72;">${formatCurrency(totalPayment)}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #6c757d;">Toplam Faiz</div>
                        <div style="font-size: 18px; font-weight: 600; color: #dc3545;">${formatCurrency(totalInterest)}</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #667eea;">
                    <strong>💡 Finansman Önerisi:</strong><br>
                    ${monthlyPayment > 0 && totalPayment > 0 ? `
                        • Aylık ödemeniz hasılatınızın <strong>%${((monthlyPayment / (document.getElementById('results').style.display !== 'none' ? parseFloat(document.querySelector('.result-card-large .value')?.textContent.replace(/[^\d]/g, '') || 1000000) : 1000000)) * 100).toFixed(1)}</strong>'ini oluşturuyor.<br>
                        • ${monthlyPayment < 100000 ? '✅ Makul bir ödeme planı.' : '⚠️ Yüksek ödeme - vadeyi uzatmayı düşünün.'}<br>
                        • Faiz oranı: <strong>%${annualRate}</strong> ${annualRate < 3 ? '(İyi)' : annualRate < 5 ? '(Orta)' : '(Yüksek)'}
                    ` : ''}
                </div>
            `;
        }

        // HEDEF BELIRLEME
        function openGoalSetting() {
            const currentProfit = document.getElementById('results').style.display !== 'none' 
                ? parseFloat(document.querySelector('.result-card-large .value')?.textContent.replace(/[^\d,-]/g, '').replace(',', '.') || 0)
                : 0;
            
            const goal = prompt(`🎯 Aylık Kar Hedefiniz?\n\n${currentProfit > 0 ? `Şu anki karınız: ${formatCurrency(currentProfit)}` : 'Önce hesaplama yapmalısınız!'}\n\nHedef tutarı girin (₺):`);
            
            if (goal) {
                const targetProfit = parseFloat(goal);
                if (currentProfit > 0) {
                    const difference = targetProfit - currentProfit;
                    const percentChange = ((difference / currentProfit) * 100).toFixed(1);
                    
                    let message = `🎯 **HEDEF BELİRLENDİ**\n\n`;
                    message += `📊 Mevcut Kar: ${formatCurrency(currentProfit)}\n`;
                    message += `🎯 Hedef Kar: ${formatCurrency(targetProfit)}\n`;
                    message += `📈 Fark: ${formatCurrency(Math.abs(difference))} (${percentChange}%)\n\n`;
                    
                    if (difference > 0) {
                        message += `💡 **Hedefe Ulaşmak İçin:**\n`;
                        message += `• Devrinimi ${(1.5 * (1 + difference / currentProfit / 2)).toFixed(1)}'e çıkar\n`;
                        message += `• Veya tarifeleri %${(difference / currentProfit * 50).toFixed(0)} artır\n`;
                        message += `• Veya giderleri %${(difference / currentProfit * 30).toFixed(0)} azalt`;
                    } else {
                        message += `✅ Hedefinizi şu an aşıyorsunuz! Tebrikler! 🎉`;
                    }
                    
                    alert(message);
                    
                    // LocalStorage'a kaydet
                    localStorage.setItem('parkexpert-goal', JSON.stringify({
                        target: targetProfit,
                        current: currentProfit,
                        date: new Date().toISOString()
                    }));
                } else {
                    alert('⚠️ Önce bir hesaplama yapmalısınız!');
                }
            }
        }

        // HATIRLATICI SİSTEMİ
        function setReminder() {
            const message = prompt('🔔 Hatırlatıcı Mesajı:\n\nÖrnek: "Aylık raporu kontrol et"');
            
            if (message) {
                const days = prompt('📅 Kaç gün sonra hatırlatsın?\n\n(Örn: 7 = 1 hafta sonra)');
                
                if (days) {
                    const reminderDate = new Date();
                    reminderDate.setDate(reminderDate.getDate() + parseInt(days));
                    
                    const reminder = {
                        message: message,
                        date: reminderDate.toISOString(),
                        created: new Date().toISOString()
                    };
                    
                    // LocalStorage'a kaydet
                    const reminders = JSON.parse(localStorage.getItem('parkexpert-reminders') || '[]');
                    reminders.push(reminder);
                    localStorage.setItem('parkexpert-reminders', JSON.stringify(reminders));
                    
                    alert(`✅ Hatırlatıcı ayarlandı!\n\n📅 ${reminderDate.toLocaleDateString('tr-TR')}\n💬 ${message}`);
                }
            }
        }

        function checkReminders() {
            const reminders = JSON.parse(localStorage.getItem('parkexpert-reminders') || '[]');
            const now = new Date();
            
            reminders.forEach((reminder, index) => {
                const reminderDate = new Date(reminder.date);
                if (reminderDate <= now) {
                    showToast(`🔔 Hatırlatma: ${reminder.message}`, 'success');
                    
                    // Gösterilen hatırlatıcıyı sil
                    reminders.splice(index, 1);
                    localStorage.setItem('parkexpert-reminders', JSON.stringify(reminders));
                }
            });
        }

        function closeAllModals() {
            document.querySelectorAll('.modal, .financing-modal').forEach(modal => {
                modal.classList.remove('active');
            });
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // QR CODE GENERATOR (Issue #3)
        function generateQRCode() {
            // Hesaplama yapılmış mı kontrol et
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                showToast('⚠️ Önce hesaplama yapın!', 'warning');
                return;
            }

            // Mevcut hesaplama verilerini topla
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const weekdayCapacity = document.getElementById('weekdayCapacity').value;
            const weekendCapacity = document.getElementById('weekendCapacity').value;

            // Sonuç verilerini al (basitleştirilmiş)
            const qrData = {
                location: locationName,
                weekdayCapacity: weekdayCapacity,
                weekendCapacity: weekendCapacity,
                date: new Date().toLocaleDateString('tr-TR'),
                url: window.location.href
            };

            // QR modal'ı göster
            document.getElementById('qrModalOverlay').classList.add('active');
            document.getElementById('qrModal').classList.add('active');

            // Canvas'a basit QR pattern çiz
            drawSimpleQR(JSON.stringify(qrData));
        }

        function drawSimpleQR(data) {
            const canvas = document.getElementById('qrCodeCanvas');
            const ctx = canvas.getContext('2d');
            const size = 256;

            // Arka plan
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, size, size);

            // Basit QR pattern (dekoratif)
            ctx.fillStyle = '#1e3c72';
            const moduleSize = 8;
            const modules = size / moduleSize;

            // Rastgele ama deterministik pattern oluştur
            let seed = 0;
            for (let char of data) {
                seed += char.charCodeAt(0);
            }

            function seededRandom() {
                seed = (seed * 9301 + 49297) % 233280;
                return seed / 233280;
            }

            // QR benzeri pattern çiz
            for (let row = 0; row < modules; row++) {
                for (let col = 0; col < modules; col++) {
                    // Köşe marker'ları
                    const isCorner = (row < 7 && col < 7) ||
                                    (row < 7 && col >= modules - 7) ||
                                    (row >= modules - 7 && col < 7);

                    if (isCorner) {
                        if ((row === 0 || row === 6 || col === 0 || col === 6) ||
                            (row >= 2 && row <= 4 && col >= 2 && col <= 4)) {
                            ctx.fillRect(col * moduleSize, row * moduleSize, moduleSize, moduleSize);
                        }
                    } else if (seededRandom() > 0.5) {
                        ctx.fillRect(col * moduleSize, row * moduleSize, moduleSize, moduleSize);
                    }
                }
            }

            // Ortaya logo/text ekle
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(size/2 - 30, size/2 - 30, 60, 60);
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('P', size/2, size/2);
        }

        function downloadQR() {
            const canvas = document.getElementById('qrCodeCanvas');
            const link = document.createElement('a');
            link.download = `parkexpert-qr-${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showToast('✅ QR kod indirildi!', 'success');
        }

        function closeQRModal() {
            document.getElementById('qrModalOverlay').classList.remove('active');
            document.getElementById('qrModal').classList.remove('active');
        }

        // RANDOM SCENARIO GENERATOR (Issue #5)
        function randomScenario() {
            const scenarios = [
                {
                    name: 'AVM Yoğun',
                    capacity: 500,
                    devinim: 2.5,
                    tariff: 25,
                    staff: 6,
                    desc: 'Yüksek trafikli AVM otoparkı senaryosu'
                },
                {
                    name: 'Plaza Normal',
                    capacity: 300,
                    devinim: 1.5,
                    tariff: 15,
                    staff: 4,
                    desc: 'Orta ölçekli plaza otoparkı senaryosu'
                },
                {
                    name: 'Hastane Yüksek',
                    capacity: 400,
                    devinim: 3.0,
                    tariff: 30,
                    staff: 8,
                    desc: 'Yoğun hastane otoparkı senaryosu'
                },
                {
                    name: 'Otel Gece',
                    capacity: 200,
                    devinim: 1.2,
                    tariff: 10,
                    staff: 3,
                    desc: 'Düşük devinimli otel otoparkı senaryosu'
                },
                {
                    name: 'Stadyum Maç',
                    capacity: 800,
                    devinim: 4.0,
                    tariff: 50,
                    staff: 10,
                    desc: 'Etkinlik bazlı stadyum otoparkı senaryosu'
                }
            ];

            // Rastgele senaryo seç
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];

            // Form alanlarını doldur
            document.getElementById('locationName').value = scenario.name;
            document.getElementById('weekdayCapacity').value = scenario.capacity;
            document.getElementById('weekendCapacity').value = Math.round(scenario.capacity * 1.5);
            document.getElementById('devinim').value = scenario.devinim;

            // Tüm saat dilimlerine tarife uygula
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`wd_slot${i}_tariff`).value = scenario.tariff;
                document.getElementById(`wd_slot${i}_parking`).value = Math.round(scenario.capacity * scenario.devinim / 6);
                document.getElementById(`we_slot${i}_tariff`).value = scenario.tariff;
                document.getElementById(`we_slot${i}_parking`).value = Math.round(scenario.capacity * scenario.devinim * 1.5 / 6);
            }

            // Personel
            document.getElementById('staffCountTotal').value = scenario.staff;
            document.getElementById('staffCostTotal').value = (scenario.staff * 17000).toLocaleString('tr-TR');

            // Toast mesajı
            showToast(`🎲 ${scenario.name} senaryosu yüklendi!`, 'success');

            // Pulse animasyonu ekle
            const container = document.querySelector('.container');
            container.style.animation = 'pulse 0.5s ease-in-out';
            setTimeout(() => {
                container.style.animation = '';
            }, 500);
        }

        // CUSTOM BRANDING SYSTEM (Issue #4)
        function toggleBranding() {
            const panel = document.getElementById('brandingControls');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function updateBranding() {
            const primary = document.getElementById('primaryColor').value;
            const secondary = document.getElementById('secondaryColor').value;
            const header = document.getElementById('headerColor').value;

            // CSS değişkenlerini güncelle
            document.documentElement.style.setProperty('--primary-color', primary);
            document.documentElement.style.setProperty('--secondary-color', secondary);
            document.documentElement.style.setProperty('--text-color', header);

            // Gradient'leri güncelle
            const headerBg = `linear-gradient(135deg, ${header} 0%, ${primary} 100%)`;
            document.documentElement.style.setProperty('--header-bg', headerBg);

            // LocalStorage'a kaydet
            localStorage.setItem('parkexpert-branding', JSON.stringify({
                primary: primary,
                secondary: secondary,
                header: header
            }));

            showToast('🎨 Branding güncellendi!', 'success');
        }

        function resetBranding() {
            // Varsayılan değerler
            document.getElementById('primaryColor').value = '#667eea';
            document.getElementById('secondaryColor').value = '#764ba2';
            document.getElementById('headerColor').value = '#1e3c72';

            // CSS'i sıfırla
            document.documentElement.style.setProperty('--primary-color', '#667eea');
            document.documentElement.style.setProperty('--secondary-color', '#764ba2');
            document.documentElement.style.setProperty('--text-color', '#1e3c72');
            document.documentElement.style.setProperty('--header-bg', 'linear-gradient(135deg, #1e3c72 0%, #667eea 100%)');

            // LocalStorage'dan sil
            localStorage.removeItem('parkexpert-branding');

            showToast('🔄 Branding sıfırlandı!', 'success');
        }

        function loadBranding() {
            const saved = localStorage.getItem('parkexpert-branding');
            if (saved) {
                const branding = JSON.parse(saved);
                document.getElementById('primaryColor').value = branding.primary;
                document.getElementById('secondaryColor').value = branding.secondary;
                document.getElementById('headerColor').value = branding.header;

                // CSS'i uygula
                document.documentElement.style.setProperty('--primary-color', branding.primary);
                document.documentElement.style.setProperty('--secondary-color', branding.secondary);
                document.documentElement.style.setProperty('--text-color', branding.header);
                const headerBg = `linear-gradient(135deg, ${branding.header} 0%, ${branding.primary} 100%)`;
                document.documentElement.style.setProperty('--header-bg', headerBg);
            }
        }

        // PAYLAŞIM FONKSİYONLARI
        function generateReportSummary() {
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const resultsDiv = document.getElementById('results');
            
            if (resultsDiv.style.display === 'none') {
                return null;
            }
            
            // Sonuçları çek
            const resultCards = document.querySelectorAll('.result-card');
            let summary = `🅿️ PARKEXPERT FİZİBİLİTE RAPORU\n`;
            summary += `📍 Lokasyon: ${locationName}\n`;
            summary += `📅 Tarih: ${new Date().toLocaleDateString('tr-TR')}\n\n`;
            summary += `📊 SONUÇLAR:\n`;
            
            resultCards.forEach(card => {
                const title = card.querySelector('h3')?.textContent || '';
                const value = card.querySelector('.value')?.textContent || '';
                if (title && value) {
                    summary += `• ${title}: ${value}\n`;
                }
            });
            
            return summary;
        }

        function shareViaWhatsApp() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const text = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            const url = `https://wa.me/?text=${text}`;
            window.open(url, '_blank');
        }

        function shareViaEmail() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            const subject = encodeURIComponent(`Parkexpert Fizibilite Raporu - ${locationName}`);
            const body = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function shareViaTelegram() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            const text = encodeURIComponent(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href);
            const url = `https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${text}`;
            window.open(url, '_blank');
        }

        function copyReportLink() {
            const summary = generateReportSummary();
            if (!summary) {
                alert('⚠️ Önce hesaplama yapmalısınız!');
                return;
            }
            
            // Özet metni panoya kopyala
            navigator.clipboard.writeText(summary + '\n\n🔗 Detaylı rapor için: ' + window.location.href)
                .then(() => {
                    alert('✅ Rapor özeti panoya kopyalandı!');
                })
                .catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = summary;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('✅ Rapor özeti panoya kopyalandı!');
                });
        }

        // Modal dışına tıklayınca kapat
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // SENARYO YÖNETİMİ FONKSİYONLARI
        function switchScenario(scenario) {
            currentScenario = scenario;
            
            // Tab görünümlerini güncelle
            document.getElementById('tabA').classList.toggle('active', scenario === 'A');
            document.getElementById('tabB').classList.toggle('active', scenario === 'B');
            
            // İndikatörü güncelle
            document.getElementById('scenarioIndicator').textContent = `📊 Aktif: Senaryo ${scenario}`;
            
            // Eğer kaydedilmiş senaryo varsa yükle
            const savedScenario = scenario === 'A' ? scenarioA : scenarioB;
            if (savedScenario) {
                setAllFormData(savedScenario);
                
                // Eğer sonuçlar varsa göster
                const savedResults = scenario === 'A' ? scenarioAResults : scenarioBResults;
                if (savedResults) {
                    // Sonuçları yeniden göster (calculate'i tekrar çağırmadan)
                    document.getElementById('results').style.display = 'block';
                }
            } else {
                // Yeni senaryo için formu temizle
                clearFormForNewScenario();
            }
        }

        function saveCurrentScenario() {
            const data = getAllFormData();
            const locationName = document.getElementById('locationName').value || 'İsimsiz Senaryo';
            
            if (currentScenario === 'A') {
                scenarioA = data;
                alert(`✅ Senaryo A kaydedildi: ${locationName}`);
            } else {
                scenarioB = data;
                alert(`✅ Senaryo B kaydedildi: ${locationName}`);
            }
            
            // Hesaplama yapılmışsa sonuçları da kaydet
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display !== 'none') {
                // Sonuçları kaydet (basitleştirilmiş)
                const results = extractCurrentResults();
                if (currentScenario === 'A') {
                    scenarioAResults = results;
                } else {
                    scenarioBResults = results;
                }
            }
        }

        function clearScenario() {
            if (!confirm(`Senaryo ${currentScenario}'yı temizlemek istediğinizden emin misiniz?`)) {
                return;
            }
            
            if (currentScenario === 'A') {
                scenarioA = null;
                scenarioAResults = null;
            } else {
                scenarioB = null;
                scenarioBResults = null;
            }
            
            clearFormForNewScenario();
            alert(`✅ Senaryo ${currentScenario} temizlendi!`);
        }

        function clearFormForNewScenario() {
            // Formu default değerlere döndür
            document.getElementById('locationName').value = '';
            document.getElementById('weekdayCapacity').value = '1670';
            document.getElementById('weekendCapacity').value = '2505';
            document.getElementById('devinim').value = '1.5';
            document.getElementById('workingDays').value = '22';
            document.getElementById('weekendDays').value = '8';
            document.getElementById('workingMonths').value = '12';
            
            // Personel
            document.getElementById('staffMinWage').value = '0';
            document.getElementById('staff25k').value = '0';
            document.getElementById('staffManager').value = '0';
            
            // Sonuçları gizle
            document.getElementById('results').style.display = 'none';
            document.getElementById('chartsSection').style.display = 'none';
            document.getElementById('managerReport').style.display = 'none';
            
            calculateTotalStaffCost();
            calculateWeekendCapacity();
        }

        function extractCurrentResults() {
            // Mevcut sonuçları çıkar
            const locationName = document.getElementById('locationName').value || 'Lokasyon';
            
            // Result grid'den değerleri çek
            const resultCards = document.querySelectorAll('.result-card');
            const results = {
                locationName: locationName,
                values: {}
            };
            
            resultCards.forEach(card => {
                const title = card.querySelector('h3')?.textContent || '';
                const value = card.querySelector('.value')?.textContent || '';
                results.values[title] = value;
            });
            
            return results;
        }

        function compareScenarios() {
            if (!scenarioA || !scenarioB) {
                alert('⚠️ Her iki senaryoyu da kaydetmeniz gerekiyor!\n\n1. Senaryo A\'yı doldurun ve "Bu Senaryoyu Kaydet" tıklayın\n2. Senaryo B\'ye geçin\n3. Senaryo B\'yi doldurun ve kaydedin\n4. Tekrar "Senaryoları Karşılaştır" tıklayın');
                return;
            }
            
            if (!scenarioAResults || !scenarioBResults) {
                alert('⚠️ Her iki senaryo için de hesaplama yapmanız gerekiyor!\n\nHer senaryo için "Fizibilite Hesapla" butonuna tıklayın.');
                return;
            }
            
            // Karşılaştırma tablosu oluştur
            createComparisonTable();
            
            // Karşılaştırma sonuçlarına scroll
            document.getElementById('comparisonResults').style.display = 'block';
            document.getElementById('comparisonResults').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Başarım
            unlockAchievement('scenario_master');
        }

        function createComparisonTable() {
            const resultsA = scenarioAResults.values;
            const resultsB = scenarioBResults.values;
            
            // Net karı bul (string'den sayıya çevir)
            const netProfitA = parseFloat(resultsA['Net Kar']?.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            const netProfitB = parseFloat(resultsB['Net Kar']?.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            
            const winner = netProfitA > netProfitB ? 'A' : (netProfitB > netProfitA ? 'B' : 'Eşit');
            
            // Winner badge
            const winnerBadge = document.getElementById('winnerBadge');
            if (winner !== 'Eşit') {
                winnerBadge.innerHTML = `<div class="winner-badge">🏆 KAZANAN: SENARYO ${winner}</div>`;
            } else {
                winnerBadge.innerHTML = `<div class="winner-badge" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">⚖️ SENARYOLAR EŞİT</div>`;
            }
            
            // Senaryo bilgileri
            const scenarioInfoHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="scenario-info-box">
                        <h3>📊 Senaryo A</h3>
                        <p><strong>Lokasyon:</strong> ${scenarioAResults.locationName}</p>
                        <p><strong>Hafta İçi Kapasite:</strong> ${scenarioA.weekdayCapacity}</p>
                        <p><strong>Hafta Sonu Kapasite:</strong> ${scenarioA.weekendCapacity}</p>
                    </div>
                    <div class="scenario-info-box">
                        <h3>📊 Senaryo B</h3>
                        <p><strong>Lokasyon:</strong> ${scenarioBResults.locationName}</p>
                        <p><strong>Hafta İçi Kapasite:</strong> ${scenarioB.weekdayCapacity}</p>
                        <p><strong>Hafta Sonu Kapasite:</strong> ${scenarioB.weekendCapacity}</p>
                    </div>
                </div>
            `;
            
            // Karşılaştırma tablosu
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th class="metric-name">Metrik</th>
                            <th>Senaryo A</th>
                            <th>Senaryo B</th>
                            <th>Fark</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // Tüm metrikleri karşılaştır
            const allMetrics = new Set([...Object.keys(resultsA), ...Object.keys(resultsB)]);
            
            allMetrics.forEach(metric => {
                const valueA = resultsA[metric] || '-';
                const valueB = resultsB[metric] || '-';
                
                // Sayısal değerleri karşılaştır
                const numA = parseFloat(valueA.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
                const numB = parseFloat(valueB.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
                
                let classA = '';
                let classB = '';
                let diff = '-';
                
                if (numA !== 0 && numB !== 0) {
                    if (metric.includes('Gider') || metric.includes('Maliyet')) {
                        // Giderler için düşük olanı yeşil
                        classA = numA < numB ? 'better' : (numA > numB ? 'worse' : '');
                        classB = numB < numA ? 'better' : (numB > numA ? 'worse' : '');
                    } else {
                        // Gelir/Kar için yüksek olanı yeşil
                        classA = numA > numB ? 'better' : (numA < numB ? 'worse' : '');
                        classB = numB > numA ? 'better' : (numB < numA ? 'worse' : '');
                    }
                    
                    const difference = Math.abs(numA - numB);
                    const percentage = ((difference / Math.max(numA, numB)) * 100).toFixed(1);
                    diff = `${new Intl.NumberFormat('tr-TR').format(difference)} ₺ (${percentage}%)`;
                }
                
                tableHTML += `
                    <tr>
                        <td class="metric-name">${metric}</td>
                        <td class="${classA}">${valueA}</td>
                        <td class="${classB}">${valueB}</td>
                        <td>${diff}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            document.getElementById('comparisonContent').innerHTML = scenarioInfoHTML + tableHTML;
        }

        // Enter tuşu ile hesaplama
        // ⌨️ KEYBOARD SHORTCUTS SYSTEM
        document.addEventListener('keydown', function(e) {
            // Ignore if typing in input/textarea
            if (e.target.matches('input, textarea, select')) {
                // Only Enter key works in inputs
                if (e.key === 'Enter' && !e.target.matches('textarea')) {
                    calculate();
                }
                return;
            }

            // Ctrl/Cmd combinations
            if (e.ctrlKey || e.metaKey) {
                switch(e.key.toLowerCase()) {
                    case 's': // Ctrl+S: Save calculation
                        e.preventDefault();
                        saveCalculation();
                        showToast('💾 Hesaplama kaydedildi!', 'success');
                        break;
                    case 'p': // Ctrl+P: Print
                        e.preventDefault();
                        printReport();
                        break;
                    case 'k': // Ctrl+K: Open shortcuts help
                        e.preventDefault();
                        showKeyboardShortcuts();
                        break;
                    case 'l': // Ctrl+L: Load calculations
                        e.preventDefault();
                        openLoadModal();
                        break;
                    case 'e': // Ctrl+E: Export to Excel
                        e.preventDefault();
                        exportToExcel();
                        break;
                    case 'd': // Ctrl+D: Download PDF
                        e.preventDefault();
                        downloadPDF();
                        break;
                    case 'h': // Ctrl+H: Show help/tutorial
                        e.preventDefault();
                        startTutorial();
                        break;
                }
            }
            // Single key shortcuts
            else {
                switch(e.key.toLowerCase()) {
                    case 'escape':
                    case 'esc':
                        // Close any open modal
                        closeAllModals();
                        break;
                    case 'c': // C: Calculate
                        calculate();
                        break;
                    case 'r': // R: Random scenario
                        randomScenario();
                        break;
                    case '?': // ?: Show shortcuts
                        showKeyboardShortcuts();
                        break;
                    case 't': // T: Toggle theme
                        const currentTheme = localStorage.getItem('parkexpert-theme') || 'light';
                        setTheme(currentTheme === 'light' ? 'dark' : 'light');
                        break;
                }
            }
        });

        // Show keyboard shortcuts modal
        function showKeyboardShortcuts() {
            const shortcuts = `
                <div style="padding: 20px;">
                    <h2 style="margin: 0 0 20px 0; color: #1e3c72;">⌨️ Klavye Kısayolları</h2>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">C</kbd>
                            <span>Fizibilite Hesapla</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+S</kbd>
                            <span>Hesaplamayı Kaydet</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+L</kbd>
                            <span>Kayıtlı Hesaplamaları Aç</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+P</kbd>
                            <span>Yazdır</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+E</kbd>
                            <span>Excel'e Aktar</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+D</kbd>
                            <span>PDF İndir</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">R</kbd>
                            <span>Rastgele Senaryo</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">T</kbd>
                            <span>Tema Değiştir</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Esc</kbd>
                            <span>Modal'ları Kapat</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">?</kbd>
                            <span>Bu Yardımı Göster</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: center;">
                            <kbd style="padding: 5px 10px; background: #f0f4ff; border: 2px solid #667eea; border-radius: 5px; font-weight: 600;">Ctrl+H</kbd>
                            <span>Rehber Turu Başlat</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #6c757d;">
                        💡 <strong>İpucu:</strong> Mac kullanıcıları Ctrl yerine ⌘ (Cmd) kullanabilir
                    </div>
                    
                    <button onclick="closeAllModals()" style="width: 100%; margin-top: 20px; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Anladım
                    </button>
                </div>
            `;
            
            showCustomModal('Klavye Kısayolları', shortcuts);
        }

        // Custom modal for keyboard shortcuts
        function showCustomModal(title, content) {
            // Create modal if doesn't exist
            let modal = document.getElementById('customModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'customModal';
                modal.className = 'modal';
                modal.style.cssText = 'display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;';
                
                const modalContent = document.createElement('div');
                modalContent.className = 'modal-content';
                modalContent.style.cssText = 'background: white; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;';
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
                // Click outside to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeAllModals();
                    }
                });
            }
            
            const modalContent = modal.querySelector('.modal-content');
            modalContent.innerHTML = content;
            modal.style.display = 'flex';
        }

        // Close all modals function
        function closeAllModals() {
            document.querySelectorAll('.modal, .modal-overlay, .financing-modal').forEach(modal => {
                modal.classList.remove('active');
                modal.style.display = 'none';
            });
            
            // Re-enable body scroll
            if (isMobileDevice()) {
                document.body.style.overflow = '';
            }
        }

        // 🎓 ONBOARDING TUTORIAL SYSTEM
        let currentTutorialStep = 0;
        const tutorialSteps = [
            {
                element: '#locationName',
                title: '🏢 Lokasyon Bilgisi',
                description: 'Öncelikle otopark lokasyonunun adını girin. Örn: "Olivium AVM", "Zorlu Center"',
                position: 'bottom'
            },
            {
                element: '#weekdayCapacity',
                title: '🚗 Kapasite Belirleme',
                description: 'Hafta içi satılabilir araç kapasitesini girin. Bu sayı, hafta sonu kapasitesini otomatik hesaplar.',
                position: 'bottom'
            },
            {
                element: '.time-slot',
                title: '⏰ Tarife Dilimleri',
                description: 'Saat dilimlerine göre tarife ve kullanım oranlarını girin. Kullanım % toplamı 100 olmalı!',
                position: 'top'
            },
            {
                element: '#staffCountTotal',
                title: '👥 Personel Bilgileri',
                description: 'Personel sayısı ve maliyet bilgilerini girin. Detaylı personel bilgileri için "Detayları Göster" butonunu kullanabilirsiniz.',
                position: 'bottom'
            },
            {
                element: '.calculate-btn',
                title: '📊 Hesaplama',
                description: 'Tüm bilgileri girdikten sonra bu butona tıklayarak fizibilite analizi yapabilirsiniz. Klavyeden "C" tuşuna basarak da hesaplayabilirsiniz!',
                position: 'top'
            },
            {
                element: '.theme-controls',
                title: '🎨 Özelleştirme',
                description: 'Tema rengini değiştirebilir, karanlık modu aktifleştirebilir ve dil seçimi yapabilirsiniz.',
                position: 'bottom'
            },
            {
                element: '.user-menu',
                title: '👤 Kullanıcı Menüsü',
                description: 'Profiliniz, ayarlarınız ve çıkış yapma seçenekleri burada. Admin kullanıcılar için admin paneli de erişilebilir.',
                position: 'bottom'
            }
        ];

        function startTutorial() {
            // Check if tutorial was completed before
            if (localStorage.getItem('parkexpert-tutorial-completed')) {
                if (!confirm('Rehber turu tekrar başlatmak ister misiniz?')) {
                    return;
                }
            }

            // Show welcome screen
            showTutorialWelcome();
        }

        function showTutorialWelcome() {
            const welcome = document.createElement('div');
            welcome.className = 'tutorial-welcome';
            welcome.innerHTML = `
                <h2>👋 Hoş Geldiniz!</h2>
                <p style="font-size: 16px;">
                    <strong>Parkexpert Fizibilite Hesaplama</strong> aracına hoş geldiniz! 
                    Size hızlı bir tur atmak ister misiniz?
                </p>
                <p style="font-size: 14px; margin-top: 15px;">
                    Rehber turunda aracın temel özelliklerini ve nasıl kullanılacağını öğreneceksiniz.
                    Yaklaşık <strong>1-2 dakika</strong> sürecektir.
                </p>
                <div class="tutorial-welcome-buttons">
                    <button class="tutorial-btn tutorial-btn-secondary" onclick="skipTutorial()">
                        Atla
                    </button>
                    <button class="tutorial-btn tutorial-btn-primary" onclick="beginTutorial()">
                        🚀 Turu Başlat
                    </button>
                </div>
            `;

            // Add overlay
            const overlay = document.createElement('div');
            overlay.className = 'tutorial-overlay active';
            overlay.id = 'tutorialOverlay';

            document.body.appendChild(overlay);
            document.body.appendChild(welcome);
        }

        function skipTutorial() {
            localStorage.setItem('parkexpert-tutorial-completed', 'true');
            closeTutorial();
            showToast('ℹ️ Rehber turunu istediğiniz zaman Ctrl+H ile başlatabilirsiniz', 'info');
        }

        function beginTutorial() {
            const welcome = document.querySelector('.tutorial-welcome');
            if (welcome) welcome.remove();
            
            currentTutorialStep = 0;
            showTutorialStep(currentTutorialStep);
        }

        function showTutorialStep(step) {
            if (step >= tutorialSteps.length) {
                completeTutorial();
                return;
            }

            const stepData = tutorialSteps[step];
            const element = document.querySelector(stepData.element);
            
            if (!element) {
                // Element not found, skip to next
                currentTutorialStep++;
                showTutorialStep(currentTutorialStep);
                return;
            }

            // Scroll element into view
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Create or update spotlight
            setTimeout(() => {
                createSpotlight(element);
                createTooltip(element, stepData, step);
            }, 300);
        }

        function createSpotlight(element) {
            // Remove existing spotlight
            const existingSpotlight = document.querySelector('.tutorial-spotlight');
            if (existingSpotlight) existingSpotlight.remove();

            const rect = element.getBoundingClientRect();
            const spotlight = document.createElement('div');
            spotlight.className = 'tutorial-spotlight';
            spotlight.style.top = (rect.top + window.scrollY - 5) + 'px';
            spotlight.style.left = (rect.left + window.scrollX - 5) + 'px';
            spotlight.style.width = (rect.width + 10) + 'px';
            spotlight.style.height = (rect.height + 10) + 'px';

            document.body.appendChild(spotlight);
        }

        function createTooltip(element, stepData, step) {
            // Remove existing tooltip
            const existingTooltip = document.querySelector('.tutorial-tooltip');
            if (existingTooltip) existingTooltip.remove();

            const rect = element.getBoundingClientRect();
            const tooltip = document.createElement('div');
            tooltip.className = 'tutorial-tooltip';
            
            tooltip.innerHTML = `
                <h3>
                    ${stepData.title}
                </h3>
                <p>${stepData.description}</p>
                <div class="tutorial-buttons">
                    <div class="tutorial-progress">${step + 1} / ${tutorialSteps.length}</div>
                    <div style="display: flex; gap: 10px;">
                        ${step > 0 ? '<button class="tutorial-btn tutorial-btn-secondary" onclick="previousTutorialStep()">◀ Geri</button>' : ''}
                        ${step < tutorialSteps.length - 1 ? 
                            '<button class="tutorial-btn tutorial-btn-primary" onclick="nextTutorialStep()">İleri ▶</button>' :
                            '<button class="tutorial-btn tutorial-btn-primary" onclick="completeTutorial()">🎉 Tamamla</button>'
                        }
                    </div>
                </div>
            `;

            // Position tooltip
            if (stepData.position === 'bottom') {
                tooltip.style.top = (rect.bottom + window.scrollY + 20) + 'px';
                tooltip.style.left = (rect.left + window.scrollX) + 'px';
            } else {
                tooltip.style.bottom = (window.innerHeight - rect.top - window.scrollY + 20) + 'px';
                tooltip.style.left = (rect.left + window.scrollX) + 'px';
            }

            // Ensure tooltip is within viewport
            document.body.appendChild(tooltip);
            const tooltipRect = tooltip.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
                tooltip.style.left = (window.innerWidth - tooltipRect.width - 20) + 'px';
            }
            if (tooltipRect.left < 0) {
                tooltip.style.left = '20px';
            }
        }

        function nextTutorialStep() {
            currentTutorialStep++;
            showTutorialStep(currentTutorialStep);
        }

        function previousTutorialStep() {
            if (currentTutorialStep > 0) {
                currentTutorialStep--;
                showTutorialStep(currentTutorialStep);
            }
        }

        function completeTutorial() {
            localStorage.setItem('parkexpert-tutorial-completed', 'true');
            closeTutorial();
            
            // Show completion message
            showToast('🎉 Tebrikler! Rehber turu tamamladınız!', 'success');
            
            // Unlock achievement
            unlockAchievement('tutorial_completed');
        }

        function closeTutorial() {
            const overlay = document.getElementById('tutorialOverlay');
            const spotlight = document.querySelector('.tutorial-spotlight');
            const tooltip = document.querySelector('.tutorial-tooltip');
            const welcome = document.querySelector('.tutorial-welcome');

            if (overlay) overlay.remove();
            if (spotlight) spotlight.remove();
            if (tooltip) tooltip.remove();
            if (welcome) welcome.remove();
        }

        // 💰 INVESTMENT COST BREAKDOWN FUNCTIONS
        
        // Open investment breakdown modal
        function openInvestmentBreakdown() {
            const modal = document.getElementById('investmentBreakdownModal');
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
                
                // Load existing values if any
                loadInvestmentBreakdownValues();
                
                // Calculate initial total
                calculateTotalInvestment();
            }
        }

        // Close investment breakdown modal
        function closeInvestmentBreakdown() {
            const modal = document.getElementById('investmentBreakdownModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
            }
        }

        // Calculate total investment from breakdown
        function calculateTotalInvestment() {
            const setup = parseFormattedNumber(document.getElementById('cost_setup').value);
            const pts = parseFormattedNumber(document.getElementById('cost_pts').value);
            const infrastructure = parseFormattedNumber(document.getElementById('cost_infrastructure').value);
            const cabin = parseFormattedNumber(document.getElementById('cost_cabin').value);
            const signage = parseFormattedNumber(document.getElementById('cost_signage').value);
            const labor = parseFormattedNumber(document.getElementById('cost_labor').value);
            const financing = parseFormattedNumber(document.getElementById('cost_financing').value);

            const total = setup + pts + infrastructure + cabin + signage + labor + financing;

            // Display formatted total
            const displayEl = document.getElementById('totalInvestmentDisplay');
            if (displayEl) {
                displayEl.textContent = formatCurrency(total);
            }

            return total;
        }

        // Apply breakdown and transfer to main form
        function applyInvestmentBreakdown() {
            const total = calculateTotalInvestment();
            
            // Format and set to main investment cost input
            const investmentInput = document.getElementById('investmentCost');
            if (investmentInput) {
                investmentInput.value = total.toLocaleString('tr-TR');
            }

            // Save breakdown values to localStorage
            saveInvestmentBreakdownValues();

            // Close modal
            closeInvestmentBreakdown();

            // Show success message
            showToast('✅ Yatırım maliyeti güncellendi: ' + formatCurrency(total), 'success');

            // Unlock achievement
            unlockAchievement('investment_breakdown');
        }

        // Save breakdown values to localStorage
        function saveInvestmentBreakdownValues() {
            const breakdown = {
                setup: document.getElementById('cost_setup').value,
                pts: document.getElementById('cost_pts').value,
                infrastructure: document.getElementById('cost_infrastructure').value,
                cabin: document.getElementById('cost_cabin').value,
                signage: document.getElementById('cost_signage').value,
                labor: document.getElementById('cost_labor').value,
                financing: document.getElementById('cost_financing').value
            };
            localStorage.setItem('parkexpert-investment-breakdown', JSON.stringify(breakdown));
        }

        // Load breakdown values from localStorage
        function loadInvestmentBreakdownValues() {
            const saved = localStorage.getItem('parkexpert-investment-breakdown');
            if (saved) {
                try {
                    const breakdown = JSON.parse(saved);
                    if (breakdown.setup) document.getElementById('cost_setup').value = breakdown.setup;
                    if (breakdown.pts) document.getElementById('cost_pts').value = breakdown.pts;
                    if (breakdown.infrastructure) document.getElementById('cost_infrastructure').value = breakdown.infrastructure;
                    if (breakdown.cabin) document.getElementById('cost_cabin').value = breakdown.cabin;
                    if (breakdown.signage) document.getElementById('cost_signage').value = breakdown.signage;
                    if (breakdown.labor) document.getElementById('cost_labor').value = breakdown.labor;
                    if (breakdown.financing) document.getElementById('cost_financing').value = breakdown.financing;
                } catch (e) {
                    console.log('Breakdown yüklenemedi:', e);
                }
            }
        }

        // Parse formatted number (with dots and commas)
        function parseFormattedNumber(value) {
            if (!value) return 0;
            // Remove dots (thousand separators) and replace comma with dot
            const cleaned = value.toString().replace(/\./g, '').replace(',', '.');
            const parsed = parseFloat(cleaned) || 0;
            return parsed;
        }

        // Auto-start tutorial for first-time users
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (!localStorage.getItem('parkexpert-tutorial-completed')) {
                    if (!localStorage.getItem('parkexpert-session')) {
                        // Brand new user
                        startTutorial();
                    }
                }
            }, 1000);
        });
    </script>

    <!-- 💰 Detaylı Yatırım Maliyeti Modal -->
    <div id="investmentBreakdownModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>💰 Detaylı Yatırım Maliyeti Breakdown</h2>
                <button class="close-modal" onclick="closeInvestmentBreakdown()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: #6c757d; margin-bottom: 20px;">
                    Aşağıdaki maliyet kalemlerini doldurun. Toplam otomatik hesaplanacak ve ana forma aktarılacaktır.
                </p>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">1️⃣ Kuruluş Maliyetleri (Ruhsat, Şube Açılış, Sigorta) - TAHMİNİ</label>
                    <input type="text" id="cost_setup" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 50.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Ruhsat, şube açılış, sigorta ve yasal işlemler</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">2️⃣ PTS Yazılım-Donanım Maliyeti</label>
                    <input type="text" id="cost_pts" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 250.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Park Tahsilat Sistemi yazılım ve donanım</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">3️⃣ Altyapı Maliyeti</label>
                    <input type="text" id="cost_infrastructure" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 150.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Elektrik, kablolama, network altyapısı</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">4️⃣ Ödeme Kabini (MOBO Zemin ve Giydirme)</label>
                    <input type="text" id="cost_cabin" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 100.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Ödeme kabini, MOBO zemin ve giydirme maliyeti</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">5️⃣ Yatay/Düşey İşaretleme (İletişim, Tanıtım, Bilgilendirme)</label>
                    <input type="text" id="cost_signage" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 75.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Yönlendirme tabelaları, led ekranlar, bilgilendirme panoları</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">6️⃣ İşçilik Maliyeti</label>
                    <input type="text" id="cost_labor" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 120.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Montaj, kurulum ve devreye alma işçiliği</div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 700; color: #1e3c72;">7️⃣ Finansman Maliyeti</label>
                    <input type="text" id="cost_financing" value="0" 
                           onkeyup="formatNumberInput(this); calculateTotalInvestment()" 
                           onblur="formatNumberInput(this); calculateTotalInvestment()"
                           placeholder="Örn: 50.000">
                    <div class="small-text" style="margin-top: 5px; color: #6c757d;">Kredi faizi, finansman giderleri</div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #e7f3ff, #f0f8ff); border: 3px solid #667eea; border-radius: 12px;">
                    <h3 style="margin: 0 0 15px 0; color: #1e3c72; font-size: 18px;">
                        💰 Toplam Yatırım Maliyeti (KDV Dahil)
                    </h3>
                    <div id="totalInvestmentDisplay" style="font-size: 32px; font-weight: 700; color: #28a745; text-align: center;">
                        ₺0
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button onclick="closeInvestmentBreakdown()" class="action-btn" 
                            style="flex: 1; background: #6c757d; color: white;">
                        ❌ İptal
                    </button>
                    <button onclick="applyInvestmentBreakdown()" class="action-btn" 
                            style="flex: 2; background: linear-gradient(135deg, #28a745, #20c997); color: white;">
                        ✅ Uygula ve Aktar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Kayıtlı Hesaplamalar Modal -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📂 Kayıtlı Hesaplamalar</h2>
                <button class="close-modal" onclick="closeLoadModal()">&times;</button>
            </div>
            <div class="modal-body" id="savedCalculationsList">
                <!-- Buraya JavaScript ile liste gelecek -->
            </div>
        </div>
    </div>

    <!-- Kaydet Modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💾 Hesaplamayı Kaydet</h2>
                <button class="close-modal" onclick="closeSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label style="font-size: 16px; font-weight: 600; margin-bottom: 10px; display: block;">Kayıt Adı</label>
                    <input type="text" id="saveName" placeholder="Örn: Olivium AVM - Ocak 2025" 
                           style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-load" onclick="confirmSave()" style="flex: 1;">
                        💾 Kaydet
                    </button>
                    <button class="btn-delete" onclick="closeSaveModal()" style="flex: 1; background: #6c757d;">
                        ❌ İptal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Para Birimi Seçici -->
    <div class="currency-badge" onclick="toggleCurrencyMenu()" id="currencyBadge">
        <span id="currentCurrencySymbol">₺</span>
        <span id="currentCurrencyCode" style="font-weight: 600;">TRY</span>
    </div>
    
    <div class="currency-menu" id="currencyMenu">
        <div style="font-weight: 600; margin-bottom: 10px; color: #1e3c72;">💱 Para Birimi Seç:</div>
        <button class="currency-option-btn active" onclick="changeCurrency('TRY', '₺')">
            🇹🇷 Türk Lirası (₺)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('USD', '$')">
            🇺🇸 US Dollar ($)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('EUR', '€')">
            🇪🇺 Euro (€)
        </button>
        <button class="currency-option-btn" onclick="changeCurrency('GBP', '£')">
            🇬🇧 British Pound (£)
        </button>
    </div>

    <!-- Achievements Badge -->
    <div class="achievements-badge" onclick="toggleAchievements()" title="Başarımlar">
        🏆
    </div>

    <div class="achievements-panel" id="achievementsPanel">
        <h3 style="margin: 0 0 20px 0; color: #1e3c72; text-align: center;">🏆 BAŞARIMLAR</h3>
        <div id="achievementsList"></div>
    </div>

    <!-- Chatbot -->
    <div class="chatbot-button" onclick="toggleChatbot()" title="AI Asistan">
        🤖
    </div>

    <div class="chatbot-window" id="chatbotWindow">
        <div class="chatbot-header">
            <div>
                <div style="font-weight: 700;">🤖 Parkexpert Asistan</div>
                <div style="font-size: 12px; opacity: 0.9;">Size nasıl yardımcı olabilirim?</div>
            </div>
            <button onclick="toggleChatbot()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">×</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chat-message bot">
                Merhaba! 👋 Ben Parkexpert AI asistanınızım. Size nasıl yardımcı olabilirim?
            </div>
        </div>
        <div class="chat-quick-replies">
            <button class="quick-reply-btn" onclick="askChatbot('nasıl')">Nasıl kullanırım?</button>
            <button class="quick-reply-btn" onclick="askChatbot('öneri')">Öneri al</button>
            <button class="quick-reply-btn" onclick="askChatbot('şablon')">Şablon öner</button>
            <button class="quick-reply-btn" onclick="askChatbot('karlılık')">Karlılık arttır</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h2 style="text-align: center; color: #1e3c72; margin: 0 0 10px 0;">🅿️ Parkexpert</h2>
            <p style="text-align: center; color: #6c757d; margin: 0 0 30px 0; font-size: 14px;">
                🔒 Güvenli Giriş - Sadece Kayıtlı Kullanıcılar
            </p>

            <!-- Login Form Only -->
            <div class="login-form active">
                <input type="email" class="form-input" id="loginEmail" placeholder="📧 Email" autocomplete="email">
                <input type="password" class="form-input" id="loginPassword" placeholder="🔒 Şifre" autocomplete="current-password">
                <button class="login-btn" onclick="handleLogin()">
                    🔓 Giriş Yap
                </button>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <small style="color: #6c757d;">
                        💡 Hesap oluşturmak için admin ile iletişime geçin
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal-overlay" id="adminPanelOverlay" onclick="closeAdminPanel()"></div>
    <div class="financing-modal" id="adminPanel">
        <h2 style="color: #1e3c72; margin: 0 0 20px 0;">👑 ADMİN PANELİ</h2>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #e7f3ff; border-radius: 10px; border-left: 4px solid #667eea;">
            <strong>🎯 Hoşgeldin Admin!</strong><br>
            <small style="color: #6c757d;">Kullanıcıları buradan yönetebilirsin</small>
        </div>

        <!-- Tabs -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e9ecef;">
            <button class="login-tab active" onclick="switchAdminTab('users')" id="adminUsersTab">
                👥 Kullanıcılar
            </button>
            <button class="login-tab" onclick="switchAdminTab('add')" id="adminAddTab">
                ➕ Yeni Kullanıcı
            </button>
            <button class="login-tab" onclick="switchAdminTab('settings')" id="adminSettingsTab">
                ⚙️ Ayarlar
            </button>
        </div>

        <!-- Users List -->
        <div id="adminUsersSection" class="admin-section active">
            <div id="usersList" style="max-height: 400px; overflow-y: auto;">
                <!-- Kullanıcı listesi buraya gelecek -->
            </div>
        </div>

        <!-- Add User -->
        <div id="adminAddSection" class="admin-section" style="display: none;">
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">👤 Ad Soyad</label>
                <input type="text" id="newUserName" class="form-input" placeholder="Örn: Ahmet Yılmaz">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">📧 Email</label>
                <input type="email" id="newUserEmail" class="form-input" placeholder="ahmet@parkexpert.com">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">🔒 Şifre</label>
                <input type="text" id="newUserPassword" class="form-input" placeholder="Güçlü şifre belirleyin">
                <button onclick="generatePassword()" style="margin-top: 5px; padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    🎲 Rastgele Şifre Oluştur
                </button>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">🏢 Şirket</label>
                <input type="text" id="newUserCompany" class="form-input" placeholder="Parkexpert">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; display: block; margin-bottom: 5px;">👔 Yetki Seviyesi</label>
                <select id="newUserRole" class="form-select">
                    <option value="viewer">👁️ Viewer - Sadece Görüntüleme</option>
                    <option value="manager">👨‍💼 Manager - Düzenleme İzni</option>
                    <option value="admin">👑 Admin - Tam Yetki (DİKKAT!)</option>
                </select>
            </div>
            <button onclick="createUser()" class="login-btn">
                ✨ Kullanıcı Oluştur
            </button>
        </div>

        <!-- Settings -->
        <div id="adminSettingsSection" class="admin-section" style="display: none;">
            <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3 style="margin: 0 0 15px 0; color: #1e3c72;">⚙️ Sistem Ayarları</h3>
                <div style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <strong>🔒 Güvenlik:</strong><br>
                    <small style="color: #856404;">Misafir girişi kapatıldı. Sadece kayıtlı kullanıcılar erişebilir.</small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="requireApproval" onchange="toggleApproval()">
                        <span>Yeni kullanıcılar onay beklesin</span>
                    </label>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                    <strong>📊 İstatistikler:</strong><br>
                    <div id="adminStats" style="margin-top: 10px; color: #6c757d;">
                        <!-- Stats buraya gelecek -->
                    </div>
                </div>
            </div>
        </div>

        <button onclick="closeAdminPanel()" style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
            Kapat
        </button>
    </div>

    <!-- QR Code Modal (Issue #3) -->
    <div class="modal-overlay" id="qrModalOverlay" onclick="closeQRModal()"></div>
    <div class="financing-modal" id="qrModal" style="max-width: 400px;">
        <h2 style="color: #1e3c72; margin: 0 0 15px 0; text-align: center;">📱 QR KOD</h2>
        <p style="text-align: center; color: #6c757d; font-size: 14px; margin-bottom: 20px;">
            Hesaplama detaylarınızı QR kod ile paylaşın
        </p>

        <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
            <canvas id="qrCodeCanvas" width="256" height="256" style="border: 2px solid #e9ecef; border-radius: 10px; max-width: 100%;"></canvas>
        </div>

        <div style="margin-top: 20px; font-size: 12px; color: #6c757d; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
            ℹ️ QR kodu okutarak hesaplama bilgilerine ulaşabilirsiniz
        </div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="downloadQR()" style="flex: 1; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                💾 İndir
            </button>
            <button onclick="closeQRModal()" style="flex: 1; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                ❌ Kapat
            </button>
        </div>
    </div>

    <!-- Branding Controls (Issue #4) -->
    <div class="branding-controls" id="brandingControls" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #1e3c72; font-size: 16px;">🎨 Branding</h3>
            <button onclick="toggleBranding()" style="background: none; border: none; font-size: 20px; cursor: pointer;">✕</button>
        </div>

        <div class="color-picker-group">
            <label>Ana Renk</label>
            <input type="color" id="primaryColor" value="#667eea" onchange="updateBranding()">
        </div>

        <div class="color-picker-group">
            <label>İkinci Renk</label>
            <input type="color" id="secondaryColor" value="#764ba2" onchange="updateBranding()">
        </div>

        <div class="color-picker-group">
            <label>Başlık Rengi</label>
            <input type="color" id="headerColor" value="#1e3c72" onchange="updateBranding()">
        </div>

        <button onclick="resetBranding()" style="width: 100%; padding: 8px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin-top: 10px;">
            🔄 Varsayılana Dön
        </button>
    </div>

    <!-- Tools Menu -->
    <div class="tools-menu">
        <button class="tool-btn" onclick="takeScreenshot()" title="📸 Screenshot">📸</button>
        <button class="tool-btn" onclick="window.print()" title="🖨️ Print">🖨️</button>
        <button class="tool-btn" onclick="generateQRCode()" title="📱 QR Kod">📱</button>
        <button class="tool-btn" onclick="randomScenario()" title="🎲 Rastgele Senaryo">🎲</button>
        <button class="tool-btn" onclick="toggleBranding()" title="🎨 Branding">🎨</button>
        <button class="tool-btn" onclick="openFinancing()" title="💳 Finansman">💳</button>
        <button class="tool-btn" onclick="openGoalSetting()" title="🎯 Hedef">🎯</button>
        <button class="tool-btn" onclick="setReminder()" title="🔔 Hatırlatıcı">🔔</button>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeAllModals()"></div>

    <!-- Financing Modal -->
    <div class="financing-modal" id="financingModal">
        <h2 style="color: #1e3c72; margin: 0 0 20px 0;">💳 FİNANSMAN HESAPLAYfour</h2>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Kredi Tutarı (₺)</label>
            <input type="number" id="loanAmount" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;" placeholder="Örn: 5000000">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Faiz Oranı (Yıllık %)</label>
            <input type="number" id="interestRate" value="2.5" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Vade (Ay)</label>
            <input type="number" id="loanTerm" value="60" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
        </div>
        <button onclick="calculateLoan()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 15px;">
            💰 Hesapla
        </button>
        <div id="loanResults" style="display: none; padding: 20px; background: #f8f9fa; border-radius: 12px;">
            <!-- Results will be shown here -->
        </div>
        <button onclick="closeAllModals()" style="width: 100%; padding: 10px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">
            Kapat
        </button>
    </div>

</body>
</html>
